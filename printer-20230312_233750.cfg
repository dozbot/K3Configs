# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

[temperature_sensor enclosure]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.033624, -0.029557, -0.027447, -0.036608, -0.042726, -0.044464, -0.048417, -0.052991, -0.056085, -0.049474, -0.046260, -0.044926, -0.042853, -0.043239, -0.046991, -0.050478, -0.047327, -0.043173, -0.037717, -0.030609, -0.034143, -0.029589, -0.018250, -0.023331, -0.022345
#*# 	  -0.020036, -0.029338, -0.030499, -0.026843, -0.031529, -0.035188, -0.045747, -0.056928, -0.059691, -0.048239, -0.043817, -0.045097, -0.046110, -0.041474, -0.041248, -0.042221, -0.041359, -0.039940, -0.034517, -0.033627, -0.036670, -0.030826, -0.031134, -0.032917, -0.028055
#*# 	  -0.013808, -0.021712, -0.029862, -0.030370, -0.034309, -0.040304, -0.044177, -0.047019, -0.051040, -0.049775, -0.051253, -0.049790, -0.042985, -0.029352, -0.036587, -0.044075, -0.048419, -0.046188, -0.039067, -0.036895, -0.031621, -0.031398, -0.026477, -0.022038, -0.016908
#*# 	  -0.019225, -0.025871, -0.028049, -0.028960, -0.034192, -0.036846, -0.033473, -0.033817, -0.037540, -0.045831, -0.048022, -0.037406, -0.024685, -0.024976, -0.040622, -0.040818, -0.039335, -0.036903, -0.028878, -0.024826, -0.026843, -0.026180, -0.026677, -0.023061, -0.013025
#*# 	  -0.020957, -0.027682, -0.019422, -0.013657, -0.015182, -0.018581, -0.018730, -0.016825, -0.013609, -0.028045, -0.032008, -0.025764, -0.021570, -0.026536, -0.036874, -0.035774, -0.035909, -0.035423, -0.027210, -0.027400, -0.031298, -0.025802, -0.030691, -0.024440, -0.012553
#*# 	  -0.015258, -0.015238, -0.005435, -0.006747, -0.019804, -0.024940, -0.028348, -0.018348, -0.007059, -0.019370, -0.026472, -0.023249, -0.023481, -0.029318, -0.031739, -0.034371, -0.039093, -0.033598, -0.024293, -0.027579, -0.029847, -0.026385, -0.022297, -0.017505, -0.011778
#*# 	  0.004870, 0.003472, -0.001645, -0.012340, -0.022315, -0.024716, -0.026613, -0.018002, -0.013708, -0.014786, -0.021277, -0.024724, -0.028563, -0.037704, -0.035675, -0.035988, -0.038551, -0.034428, -0.025759, -0.025427, -0.025381, -0.023171, -0.019977, -0.014138, -0.011445
#*# 	  0.002009, -0.002017, -0.008424, -0.022105, -0.027554, -0.012252, -0.017722, -0.018485, -0.016801, -0.015807, -0.017564, -0.017139, -0.032818, -0.048496, -0.036721, -0.035274, -0.034549, -0.033969, -0.027523, -0.027899, -0.023040, -0.021001, -0.021931, -0.019205, -0.008682
#*# 	  -0.001960, -0.009932, -0.018029, -0.025708, -0.013747, -0.009781, -0.023480, -0.015425, -0.006203, -0.017805, -0.014998, -0.007527, -0.020769, -0.043017, -0.032875, -0.032052, -0.030389, -0.025216, -0.019144, -0.018943, -0.015583, -0.013443, -0.011963, -0.008255, 0.004926
#*# 	  -0.010753, -0.020033, -0.025666, -0.025345, -0.000523, -0.012313, -0.028190, -0.013011, -0.004701, -0.018141, -0.027771, -0.010167, -0.006707, -0.020988, -0.030927, -0.029034, -0.024175, -0.018429, -0.011312, -0.007426, -0.009453, -0.013540, -0.013277, -0.002476, 0.006080
#*# 	  -0.008515, -0.001262, 0.004299, 0.006263, 0.012856, -0.001170, 0.000195, 0.005884, 0.001973, -0.002735, -0.019025, -0.014580, -0.009896, -0.012078, -0.020037, -0.014682, -0.011178, -0.011222, -0.012548, -0.008560, -0.006953, -0.008973, -0.009861, 0.000098, 0.003605
#*# 	  0.012558, 0.019125, 0.021234, 0.018327, 0.013101, 0.007782, 0.013506, 0.012382, 0.004438, 0.000210, -0.009933, -0.012165, -0.010782, -0.007627, -0.009046, -0.009310, -0.015578, -0.016678, -0.005236, -0.004376, -0.013779, -0.006732, -0.004738, -0.000721, 0.006758
#*# 	  0.019218, 0.018891, 0.013368, 0.006746, 0.009065, 0.016403, 0.015921, 0.009547, 0.000344, -0.004782, -0.010550, -0.016404, -0.011963, -0.003224, -0.008274, -0.021939, -0.027064, -0.018709, -0.004961, -0.007292, -0.008904, -0.005251, -0.003684, 0.002690, 0.007113
#*# 	  0.005647, 0.012985, -0.006827, -0.016209, 0.005132, 0.014941, 0.006757, -0.005541, -0.025668, -0.025502, -0.022348, -0.038565, -0.024884, -0.011581, -0.021169, -0.032854, -0.025298, -0.016217, -0.012844, -0.013551, -0.011748, -0.013501, -0.008676, 0.000601, 0.003658
#*# 	  -0.007266, 0.004376, -0.006427, -0.010701, 0.007934, 0.017248, 0.006597, -0.011421, -0.034672, -0.025036, -0.017423, -0.035305, -0.030060, -0.012062, -0.018152, -0.024987, -0.022552, -0.018960, -0.020235, -0.017318, -0.015752, -0.017474, -0.011391, -0.001898, 0.003307
#*# 	  0.007003, 0.007370, 0.001929, -0.001231, -0.000230, 0.010396, 0.009821, 0.000494, -0.009382, -0.009350, -0.009388, -0.017944, -0.017161, -0.008435, -0.021395, -0.025918, -0.022537, -0.021510, -0.022330, -0.016864, -0.011762, -0.012478, -0.009759, -0.000408, 0.003677
#*# 	  -0.001395, 0.007291, 0.006681, 0.000988, 0.001623, 0.013215, 0.011268, 0.002501, -0.004508, -0.008944, -0.006406, -0.010775, -0.010926, -0.015365, -0.029490, -0.023754, -0.019126, -0.023194, -0.024924, -0.017531, -0.010004, -0.012273, -0.008587, 0.002107, 0.007980
#*# 	  -0.004195, -0.000376, -0.002104, -0.008423, 0.005665, 0.016420, -0.001705, -0.025299, -0.026542, -0.016491, -0.022684, -0.033042, -0.027436, -0.023126, -0.020705, -0.013241, -0.017094, -0.027971, -0.024417, -0.013319, -0.009138, -0.013701, -0.005572, 0.003119, 0.010707
#*# 	  -0.001660, 0.001166, 0.002546, -0.006827, 0.000261, 0.014156, 0.000658, -0.017238, -0.017632, -0.011672, -0.022172, -0.032213, -0.032108, -0.023151, -0.012921, -0.006390, -0.012073, -0.018572, -0.013310, -0.004740, -0.004961, -0.008382, -0.002511, 0.005307, 0.016809
#*# 	  -0.011712, -0.004734, -0.005188, -0.011848, -0.010017, 0.008041, 0.006791, -0.001729, -0.005664, -0.015037, -0.018057, -0.020017, -0.021740, -0.019492, -0.013269, -0.006858, -0.010582, -0.008395, -0.003251, -0.003222, 0.000060, 0.003997, 0.008521, 0.014048, 0.023361
#*# 	  -0.009798, -0.010480, -0.006916, 0.000569, 0.005889, 0.010658, 0.008775, 0.002711, -0.000674, -0.010417, -0.012465, -0.014961, -0.015732, -0.015990, -0.010899, -0.008052, -0.007478, -0.006248, -0.006753, -0.000271, 0.010220, 0.013533, 0.014377, 0.014777, 0.012330
#*# 	  -0.008772, -0.009658, 0.002489, 0.006942, 0.006229, 0.003504, 0.001535, -0.002978, -0.004942, -0.010971, -0.014635, -0.017503, -0.019508, -0.018543, -0.015657, -0.010218, -0.005135, -0.007446, -0.004704, 0.001327, 0.003306, -0.000655, 0.000328, 0.004430, -0.007785
#*# 	  -0.001175, 0.004020, 0.006687, 0.005246, 0.001257, -0.005045, -0.007600, -0.010953, -0.014039, -0.017723, -0.020598, -0.023403, -0.026696, -0.027244, -0.021961, -0.009361, -0.006818, -0.017181, -0.015082, -0.012123, -0.019358, -0.020090, -0.012112, -0.004931, -0.002643
#*# 	  -0.003765, -0.003536, -0.003430, -0.010958, -0.014834, -0.019109, -0.021781, -0.022844, -0.026580, -0.029553, -0.030366, -0.033433, -0.037276, -0.035471, -0.027397, -0.012893, -0.013753, -0.024368, -0.018629, -0.014090, -0.018808, -0.014650, -0.016381, -0.017795, -0.008608
#*# 	  -0.010463, -0.018924, -0.019485, -0.021732, -0.023417, -0.026635, -0.027556, -0.025659, -0.026066, -0.026887, -0.027071, -0.027346, -0.028919, -0.032186, -0.028249, -0.018455, -0.020473, -0.023054, -0.013999, -0.015723, -0.020658, -0.016368, -0.017345, -0.013336, -0.006482
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.16500
