# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

[temperature_sensor enclosure]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.045187, -0.036626, -0.033890, -0.045211, -0.051643, -0.051273, -0.053109, -0.057253, -0.058722, -0.052835, -0.049854, -0.049825, -0.047969, -0.048111, -0.054021, -0.059415, -0.056823, -0.053047, -0.048732, -0.041876, -0.045718, -0.043427, -0.032038, -0.040741, -0.042807
#*# 	  -0.029162, -0.036357, -0.034318, -0.031850, -0.036811, -0.041365, -0.049245, -0.061850, -0.063812, -0.051485, -0.046381, -0.048059, -0.048987, -0.046187, -0.046293, -0.049536, -0.047287, -0.046460, -0.041308, -0.043253, -0.048194, -0.041952, -0.043654, -0.048788, -0.047996
#*# 	  -0.020472, -0.027468, -0.034378, -0.031440, -0.036398, -0.040370, -0.045549, -0.049996, -0.054256, -0.051934, -0.051669, -0.052622, -0.046500, -0.034103, -0.041599, -0.049519, -0.054869, -0.050795, -0.045806, -0.044836, -0.043439, -0.044745, -0.042052, -0.039391, -0.038484
#*# 	  -0.025397, -0.029167, -0.031181, -0.032862, -0.038359, -0.041285, -0.037974, -0.039868, -0.042987, -0.050014, -0.052111, -0.042218, -0.029183, -0.027996, -0.045100, -0.047120, -0.046557, -0.043446, -0.036241, -0.032630, -0.036529, -0.036683, -0.038849, -0.038987, -0.034346
#*# 	  -0.025065, -0.031946, -0.023511, -0.018182, -0.018917, -0.021828, -0.021319, -0.019701, -0.019159, -0.034040, -0.036984, -0.028235, -0.023898, -0.029800, -0.041905, -0.041384, -0.041067, -0.040711, -0.034890, -0.036032, -0.040387, -0.036104, -0.044395, -0.040366, -0.032404
#*# 	  -0.023006, -0.021451, -0.007490, -0.008480, -0.019680, -0.024433, -0.027747, -0.018212, -0.007498, -0.020905, -0.027802, -0.025248, -0.024763, -0.029946, -0.035370, -0.038437, -0.045084, -0.038591, -0.030566, -0.034017, -0.038878, -0.036128, -0.033942, -0.033492, -0.031683
#*# 	  -0.001155, -0.000712, -0.003486, -0.013531, -0.024043, -0.027774, -0.028985, -0.020965, -0.014182, -0.017729, -0.024335, -0.025684, -0.029944, -0.038719, -0.037944, -0.039342, -0.042830, -0.040525, -0.031441, -0.033108, -0.035444, -0.034369, -0.033114, -0.031720, -0.032816
#*# 	  -0.000958, -0.004428, -0.007880, -0.020722, -0.026518, -0.012424, -0.017470, -0.017898, -0.017393, -0.016678, -0.018196, -0.018419, -0.033984, -0.048069, -0.038965, -0.038380, -0.038679, -0.038828, -0.032727, -0.033421, -0.031046, -0.029391, -0.032625, -0.032847, -0.028520
#*# 	  -0.002644, -0.008413, -0.014569, -0.024853, -0.015797, -0.009234, -0.022415, -0.014244, -0.007676, -0.017891, -0.014275, -0.008045, -0.022610, -0.044838, -0.035470, -0.035189, -0.034385, -0.030039, -0.024609, -0.026967, -0.025193, -0.022867, -0.023490, -0.024214, -0.015435
#*# 	  -0.009989, -0.019819, -0.026044, -0.025662, -0.000408, -0.011786, -0.027694, -0.013012, -0.002418, -0.017421, -0.025708, -0.008004, -0.005607, -0.022418, -0.031699, -0.032388, -0.028520, -0.022976, -0.016541, -0.014708, -0.017436, -0.022791, -0.024958, -0.018407, -0.015083
#*# 	  -0.010589, -0.005228, -0.000833, 0.001431, 0.011606, -0.001887, -0.002938, 0.003928, 0.002661, -0.002959, -0.019630, -0.012727, -0.006400, -0.011101, -0.020222, -0.016902, -0.015185, -0.014930, -0.016281, -0.013489, -0.013645, -0.018042, -0.020888, -0.017077, -0.015618
#*# 	  0.011627, 0.018632, 0.023368, 0.021650, 0.015163, 0.008266, 0.014213, 0.013814, 0.006430, 0.002619, -0.007883, -0.009938, -0.010010, -0.007520, -0.010214, -0.011777, -0.018300, -0.019164, -0.010027, -0.010888, -0.020886, -0.014286, -0.015884, -0.015377, -0.011909
#*# 	  0.021789, 0.021070, 0.018506, 0.011403, 0.011701, 0.017795, 0.017999, 0.013059, 0.005883, -0.001501, -0.007674, -0.012703, -0.008115, -0.000953, -0.007753, -0.022400, -0.030582, -0.023530, -0.009632, -0.013295, -0.016493, -0.013065, -0.016525, -0.014882, -0.014044
#*# 	  0.009691, 0.015115, -0.001020, -0.012022, 0.007817, 0.016651, 0.010636, -0.001292, -0.019464, -0.019273, -0.017016, -0.032183, -0.022568, -0.009459, -0.019745, -0.034552, -0.029271, -0.018741, -0.016172, -0.018371, -0.018205, -0.022079, -0.020062, -0.015203, -0.016489
#*# 	  -0.007033, 0.005807, -0.006990, -0.011560, 0.009578, 0.017875, 0.008519, -0.009732, -0.035895, -0.025225, -0.016860, -0.035364, -0.029642, -0.011705, -0.018553, -0.028645, -0.025935, -0.023051, -0.024222, -0.022087, -0.021893, -0.026528, -0.022667, -0.017620, -0.018860
#*# 	  0.006222, 0.008099, 0.002441, 0.001949, 0.002689, 0.013132, 0.010933, -0.000256, -0.010824, -0.009708, -0.009516, -0.017600, -0.018933, -0.008599, -0.022084, -0.030050, -0.027891, -0.026158, -0.027295, -0.022193, -0.020034, -0.022534, -0.022384, -0.019536, -0.018281
#*# 	  0.001347, 0.008873, 0.009155, 0.003618, 0.002249, 0.012562, 0.013938, 0.005086, -0.002820, -0.007400, -0.005529, -0.009203, -0.010789, -0.014554, -0.030430, -0.027647, -0.024307, -0.026898, -0.029540, -0.024000, -0.017687, -0.021142, -0.021057, -0.016071, -0.012157
#*# 	  -0.007442, -0.000153, -0.002698, -0.008152, 0.004541, 0.015293, 0.000306, -0.023876, -0.027820, -0.017113, -0.022634, -0.032480, -0.028135, -0.024538, -0.024546, -0.019074, -0.021762, -0.032636, -0.030245, -0.019823, -0.016475, -0.021523, -0.017505, -0.013146, -0.008896
#*# 	  -0.003710, -0.001756, 0.000481, -0.008406, 0.000754, 0.012539, -0.001459, -0.022265, -0.024222, -0.016696, -0.028179, -0.037260, -0.036652, -0.028113, -0.017849, -0.012396, -0.018965, -0.025898, -0.020405, -0.012422, -0.013911, -0.018023, -0.015707, -0.012141, -0.004794
#*# 	  -0.014667, -0.005988, -0.006711, -0.014711, -0.014874, 0.004661, 0.003186, -0.006442, -0.011037, -0.018797, -0.022969, -0.026896, -0.027911, -0.025643, -0.019313, -0.014320, -0.018768, -0.015251, -0.010734, -0.011998, -0.010224, -0.007551, -0.005218, -0.003992, 0.002250
#*# 	  -0.013414, -0.012948, -0.010401, -0.004057, 0.001231, 0.008127, 0.007101, -0.000855, -0.005285, -0.016866, -0.018485, -0.020388, -0.021821, -0.021126, -0.016532, -0.014208, -0.013726, -0.012342, -0.013910, -0.008479, -0.000122, 0.002454, 0.000345, -0.001275, -0.006125
#*# 	  -0.015048, -0.016885, -0.003568, 0.003161, 0.001837, 0.000309, -0.001959, -0.007028, -0.009518, -0.016948, -0.021933, -0.023711, -0.025488, -0.024814, -0.023226, -0.018148, -0.013751, -0.015161, -0.012686, -0.007555, -0.005773, -0.009206, -0.011915, -0.011856, -0.026488
#*# 	  -0.008173, -0.004371, 0.001790, -0.000595, -0.003999, -0.009283, -0.012904, -0.017249, -0.020696, -0.025035, -0.027692, -0.031669, -0.034678, -0.034691, -0.030257, -0.019005, -0.016182, -0.025740, -0.023706, -0.023694, -0.031686, -0.032906, -0.027322, -0.022351, -0.023035
#*# 	  -0.010954, -0.008448, -0.008566, -0.014755, -0.019274, -0.024199, -0.027087, -0.029613, -0.033066, -0.036634, -0.037321, -0.041361, -0.045654, -0.042720, -0.035717, -0.021631, -0.023416, -0.034049, -0.027856, -0.024814, -0.030972, -0.026637, -0.031278, -0.035012, -0.029119
#*# 	  -0.020668, -0.027694, -0.029007, -0.031739, -0.033346, -0.035810, -0.037463, -0.036090, -0.036939, -0.038509, -0.037922, -0.039437, -0.041498, -0.043679, -0.039287, -0.029877, -0.032063, -0.035168, -0.025272, -0.027212, -0.033352, -0.030232, -0.032436, -0.031648, -0.026144
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.12000
