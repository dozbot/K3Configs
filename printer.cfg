# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

[temperature_sensor enclosure]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.022560, -0.015632, -0.019977, -0.034443, -0.037119, -0.037816, -0.038667, -0.041785, -0.043831, -0.041734, -0.045912, -0.043652, -0.039297, -0.041520, -0.049227, -0.051506, -0.049869, -0.045995, -0.043357, -0.038381, -0.041648, -0.034609, -0.026132, -0.030388, -0.027948
#*# 	  -0.010818, -0.013900, -0.013068, -0.017640, -0.021323, -0.026731, -0.036975, -0.045886, -0.047082, -0.036745, -0.034485, -0.036591, -0.036787, -0.035085, -0.038633, -0.038959, -0.037031, -0.033321, -0.030064, -0.030238, -0.033158, -0.027596, -0.028566, -0.033537, -0.031946
#*# 	  0.001058, -0.010544, -0.011971, -0.011401, -0.017182, -0.021585, -0.029428, -0.035900, -0.039931, -0.035560, -0.038377, -0.040458, -0.034458, -0.022019, -0.031422, -0.036766, -0.038971, -0.034168, -0.034673, -0.033817, -0.031401, -0.030105, -0.030031, -0.026219, -0.023711
#*# 	  -0.003411, -0.006390, -0.009524, -0.014505, -0.019694, -0.024574, -0.023193, -0.025052, -0.027368, -0.034092, -0.037903, -0.030167, -0.016464, -0.015922, -0.032032, -0.034674, -0.034358, -0.028151, -0.022082, -0.020228, -0.020252, -0.020542, -0.019243, -0.018715, -0.017039
#*# 	  -0.002550, -0.008400, -0.004492, -0.001927, -0.003356, -0.006563, -0.004096, -0.004658, -0.007980, -0.023178, -0.023677, -0.014085, -0.009244, -0.016713, -0.028316, -0.026122, -0.023477, -0.022424, -0.015707, -0.021300, -0.020934, -0.021199, -0.026784, -0.020968, -0.013129
#*# 	  -0.006925, 0.000528, 0.012083, 0.008395, 0.000712, -0.004232, -0.006610, 0.003594, 0.009678, -0.007771, -0.012153, -0.009491, -0.009471, -0.016089, -0.020931, -0.026653, -0.026956, -0.021867, -0.012985, -0.019957, -0.019972, -0.017772, -0.015747, -0.015725, -0.012741
#*# 	  0.016710, 0.017414, 0.015618, 0.003732, -0.006414, -0.010804, -0.013170, -0.000765, 0.004553, -0.003293, -0.010581, -0.011767, -0.015895, -0.021489, -0.021329, -0.024293, -0.025460, -0.019064, -0.014434, -0.018439, -0.018210, -0.015750, -0.014151, -0.011313, -0.012681
#*# 	  0.019673, 0.016283, 0.011291, -0.003096, -0.004893, 0.002820, -0.001515, 0.000614, 0.001138, 0.002310, -0.005317, -0.006837, -0.020393, -0.029483, -0.023237, -0.024257, -0.023913, -0.020821, -0.015642, -0.015366, -0.012758, -0.011675, -0.014273, -0.011923, -0.012092
#*# 	  0.015895, 0.012300, 0.004198, -0.007806, 0.001125, 0.008052, -0.001358, 0.006339, 0.007660, 0.002933, 0.003088, 0.005241, -0.017062, -0.029661, -0.019570, -0.018965, -0.016861, -0.012214, -0.010935, -0.011870, -0.007855, -0.005198, -0.008398, -0.006746, 0.002518
#*# 	  0.007799, -0.001100, -0.008623, -0.003985, 0.016905, 0.000823, -0.010776, 0.007656, 0.013445, -0.002895, -0.004507, 0.008935, 0.002090, -0.012946, -0.018729, -0.018444, -0.013201, -0.007192, -0.001401, -0.000364, -0.002393, -0.005216, -0.005327, 0.000939, 0.005624
#*# 	  0.004266, 0.006865, 0.007234, 0.011234, 0.024124, 0.009497, 0.009669, 0.018402, 0.017514, 0.008174, -0.005786, 0.003735, 0.007801, 0.000365, -0.009701, -0.004549, -0.001232, 0.000324, -0.002027, 0.001840, 0.000784, -0.003884, -0.005833, 0.000585, 0.002440
#*# 	  0.023061, 0.031419, 0.036774, 0.034445, 0.030330, 0.023360, 0.029688, 0.026313, 0.021848, 0.014451, 0.002853, 0.000365, 0.003331, 0.002633, 0.001270, 0.002120, -0.000810, -0.000889, 0.004046, -0.000002, -0.004113, 0.000648, 0.000130, 0.002267, 0.004476
#*# 	  0.035584, 0.037801, 0.033693, 0.028658, 0.028585, 0.030355, 0.033127, 0.025292, 0.019105, 0.012831, 0.001920, -0.000890, 0.005037, 0.010603, 0.002033, -0.008604, -0.013846, -0.007087, 0.004002, -0.001433, -0.003834, -0.000381, -0.002945, 0.001804, 0.001120
#*# 	  0.025783, 0.028055, 0.014854, 0.011677, 0.026721, 0.032057, 0.023647, 0.012530, -0.003330, -0.002442, -0.009930, -0.018195, -0.006743, 0.002636, -0.010936, -0.021517, -0.014412, -0.004742, -0.003560, -0.007259, -0.006800, -0.008668, -0.005890, -0.001224, -0.002200
#*# 	  0.008249, 0.020249, -0.000207, 0.001863, 0.029177, 0.031430, 0.019540, -0.002154, -0.025760, -0.013044, -0.013979, -0.029286, -0.015589, 0.000162, -0.011514, -0.018563, -0.011444, -0.009395, -0.012909, -0.011581, -0.014581, -0.015429, -0.010072, -0.005583, -0.005827
#*# 	  0.015049, 0.018507, 0.012981, 0.014193, 0.023246, 0.030276, 0.022565, 0.008830, -0.004456, 0.001891, -0.003197, -0.014692, -0.009040, 0.002257, -0.010603, -0.015807, -0.013000, -0.014324, -0.015702, -0.012998, -0.012121, -0.013893, -0.011203, -0.007668, -0.008389
#*# 	  0.018514, 0.026213, 0.023288, 0.018048, 0.017296, 0.027506, 0.027215, 0.018614, 0.012156, 0.007141, 0.005327, 0.000842, 0.003254, -0.001764, -0.018630, -0.015191, -0.011274, -0.014314, -0.017253, -0.013963, -0.009242, -0.011729, -0.009981, -0.006454, -0.001991
#*# 	  0.004183, 0.014471, 0.009851, 0.006599, 0.021353, 0.028201, 0.014701, -0.004816, -0.007000, -0.001346, -0.006483, -0.015179, -0.011130, -0.012325, -0.014294, -0.008076, -0.011460, -0.020028, -0.019323, -0.009997, -0.009060, -0.012764, -0.007695, -0.003907, -0.000314
#*# 	  0.010247, 0.012964, 0.012857, 0.006990, 0.019684, 0.026383, 0.008003, -0.015510, -0.011912, -0.003811, -0.018899, -0.025732, -0.021169, -0.012700, -0.005338, -0.002615, -0.009648, -0.016654, -0.011543, -0.004630, -0.007147, -0.011274, -0.007429, -0.004314, 0.001757
#*# 	  -0.000164, 0.007734, 0.005210, -0.003756, -0.000715, 0.019715, 0.013470, 0.004206, 0.001897, -0.003561, -0.010160, -0.015978, -0.017655, -0.012680, -0.005905, -0.002747, -0.006332, -0.004666, -0.000928, -0.002130, -0.002206, -0.002233, -0.000547, 0.001453, 0.008338
#*# 	  -0.000726, 0.002292, 0.001929, 0.006491, 0.010392, 0.020853, 0.017126, 0.011297, 0.004814, -0.005466, -0.006649, -0.009277, -0.009901, -0.009073, -0.004514, -0.004698, -0.003866, -0.002023, -0.003518, -0.000492, 0.005800, 0.006578, 0.004281, 0.003218, 0.001606
#*# 	  -0.003525, -0.003579, 0.007835, 0.014160, 0.015580, 0.015826, 0.013390, 0.008179, 0.005304, -0.001675, -0.006805, -0.011068, -0.011732, -0.012369, -0.010373, -0.006501, -0.003125, -0.005408, -0.003057, 0.002107, 0.003482, -0.000591, -0.002626, -0.007565, -0.021222
#*# 	  0.004569, 0.008357, 0.014423, 0.013614, 0.010285, 0.006814, 0.003091, -0.001532, -0.003428, -0.007712, -0.013335, -0.017385, -0.020372, -0.021930, -0.017975, -0.008856, -0.008879, -0.013637, -0.013927, -0.017157, -0.022369, -0.025536, -0.021614, -0.018870, -0.021151
#*# 	  0.004098, 0.007588, 0.007576, 0.001559, -0.001398, -0.006132, -0.008639, -0.011396, -0.015529, -0.018335, -0.021482, -0.026946, -0.031318, -0.029340, -0.023674, -0.011609, -0.016011, -0.025113, -0.020411, -0.020361, -0.025642, -0.022966, -0.026790, -0.029927, -0.024458
#*# 	  -0.004669, -0.009189, -0.010977, -0.015666, -0.016524, -0.019563, -0.020721, -0.019555, -0.023097, -0.024114, -0.025875, -0.028303, -0.030720, -0.033140, -0.028188, -0.017834, -0.021457, -0.024758, -0.018226, -0.021915, -0.026685, -0.025419, -0.031835, -0.032750, -0.025845
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = 0.13500
