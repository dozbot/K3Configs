# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.500
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.02

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.37
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.75
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

#[temperature_sensor enclosure]
#sensor_type: ATC Semitec 104NT-4-R025H42G
#sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 600
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.579
#*# pid_ki = 1.616
#*# pid_kd = 72.020
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 25.713
#*# pid_ki = 1.804
#*# pid_kd = 91.604
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.027030, -0.031386, -0.034200, -0.036584, -0.037629, -0.038584, -0.038965, -0.040596, -0.042363, -0.042997, -0.043379, -0.041665, -0.039425, -0.038273, -0.035811, -0.032564, -0.030840, -0.029540, -0.027845, -0.025263, -0.024077, -0.021952, -0.020202, -0.017275, -0.013267
#*# 	  -0.018631, -0.022671, -0.024082, -0.026419, -0.026871, -0.026780, -0.027609, -0.028183, -0.029253, -0.030273, -0.030852, -0.029181, -0.027892, -0.025589, -0.023732, -0.021111, -0.020514, -0.019067, -0.017667, -0.015145, -0.013497, -0.012258, -0.010440, -0.009186, -0.007008
#*# 	  -0.012629, -0.014899, -0.015548, -0.017016, -0.018973, -0.019572, -0.021582, -0.024741, -0.026854, -0.028378, -0.027889, -0.025717, -0.022741, -0.022153, -0.022906, -0.020875, -0.018719, -0.016738, -0.014918, -0.011591, -0.010457, -0.008677, -0.006829, -0.005680, -0.004835
#*# 	  -0.012302, -0.014067, -0.017439, -0.020253, -0.019815, -0.021403, -0.023123, -0.023976, -0.025884, -0.026491, -0.026807, -0.024345, -0.023083, -0.020628, -0.019004, -0.016452, -0.012269, -0.009321, -0.007587, -0.003858, -0.002646, -0.002425, -0.002088, -0.002185, -0.001586
#*# 	  -0.007427, -0.010246, -0.012010, -0.014317, -0.013431, -0.014597, -0.015282, -0.016955, -0.018264, -0.019405, -0.019560, -0.018040, -0.017192, -0.016778, -0.014653, -0.011358, -0.009952, -0.007620, -0.005656, -0.002855, -0.001934, -0.001698, -0.002221, -0.001715, 0.000184
#*# 	  -0.005990, -0.009128, -0.011454, -0.013689, -0.014151, -0.016303, -0.018418, -0.019738, -0.022325, -0.022569, -0.022161, -0.022460, -0.020327, -0.019686, -0.018783, -0.016242, -0.014344, -0.012549, -0.009809, -0.006214, -0.005445, -0.005117, -0.004950, -0.003797, -0.002726
#*# 	  -0.001841, -0.005294, -0.007384, -0.010437, -0.010446, -0.012826, -0.015291, -0.017968, -0.021175, -0.022100, -0.023505, -0.023175, -0.021756, -0.021055, -0.019471, -0.017246, -0.015389, -0.012684, -0.010206, -0.006847, -0.006592, -0.004918, -0.005484, -0.004389, -0.004650
#*# 	  -0.000955, -0.004585, -0.006315, -0.009131, -0.009913, -0.010195, -0.012404, -0.014217, -0.016681, -0.018781, -0.018421, -0.017157, -0.016086, -0.015331, -0.013687, -0.012311, -0.009414, -0.007303, -0.004660, -0.001737, -0.000753, -0.000166, -0.000555, 0.000112, -0.000108
#*# 	  -0.001199, -0.002956, -0.006285, -0.008332, -0.008406, -0.008732, -0.011040, -0.013726, -0.015188, -0.015928, -0.017255, -0.016126, -0.015619, -0.014112, -0.012855, -0.011565, -0.009366, -0.006434, -0.003565, -0.001020, -0.000183, 0.000904, 0.000894, 0.001621, 0.001717
#*# 	  -0.000154, -0.001245, -0.003306, -0.005673, -0.006096, -0.007178, -0.009062, -0.011809, -0.012584, -0.013905, -0.014310, -0.013580, -0.013252, -0.012795, -0.011401, -0.009879, -0.007335, -0.005490, -0.002918, -0.000249, 0.001325, 0.002277, 0.002058, 0.004062, 0.003587
#*# 	  0.004270, 0.002780, -0.000098, -0.002664, -0.002084, -0.002462, -0.004950, -0.006718, -0.008700, -0.009287, -0.011444, -0.010616, -0.009299, -0.008881, -0.008405, -0.007420, -0.006970, -0.004713, -0.002307, 0.000071, 0.000855, 0.001037, 0.001287, 0.003050, 0.003028
#*# 	  0.007375, 0.004139, 0.002155, -0.000946, -0.001223, -0.003246, -0.005894, -0.007556, -0.008887, -0.010309, -0.012215, -0.011882, -0.010494, -0.008704, -0.009170, -0.008608, -0.007856, -0.006990, -0.004241, -0.000427, 0.000030, 0.002368, 0.003313, 0.006303, 0.008158
#*# 	  0.014574, 0.013287, 0.009379, 0.006159, 0.005115, 0.003779, 0.003185, 0.000939, 0.000142, -0.001526, -0.003018, -0.001531, -0.000196, 0.000801, 0.001714, 0.001602, 0.001465, 0.001859, 0.003883, 0.005775, 0.007212, 0.009789, 0.011238, 0.013311, 0.014667
#*# 	  0.020336, 0.019718, 0.015882, 0.012853, 0.011857, 0.009340, 0.007968, 0.004785, 0.002969, 0.000065, -0.001126, -0.002201, -0.000512, -0.000668, -0.001291, -0.001943, -0.002177, -0.002164, -0.000057, 0.001819, 0.003398, 0.004417, 0.006124, 0.008031, 0.008562
#*# 	  0.014977, 0.013279, 0.010692, 0.007871, 0.006284, 0.004613, 0.000919, -0.002971, -0.004611, -0.007113, -0.008999, -0.008286, -0.007841, -0.006931, -0.007292, -0.007096, -0.005922, -0.005888, -0.004379, -0.002207, -0.001032, 0.000519, 0.002397, 0.003473, 0.004765
#*# 	  0.019162, 0.018545, 0.018012, 0.015428, 0.015042, 0.011943, 0.008319, 0.003030, -0.000967, -0.003737, -0.005220, -0.005483, -0.004737, -0.003260, -0.003473, -0.003229, -0.002727, -0.002276, -0.000498, 0.001235, 0.003330, 0.005490, 0.006843, 0.008575, 0.009396
#*# 	  0.016527, 0.017478, 0.016401, 0.014786, 0.013988, 0.011277, 0.007513, 0.001771, -0.001014, -0.004411, -0.007244, -0.007054, -0.006028, -0.004807, -0.003988, -0.002067, -0.000897, -0.001537, -0.000177, 0.001991, 0.002937, 0.005307, 0.007434, 0.009089, 0.011138
#*# 	  0.012417, 0.013376, 0.012405, 0.008788, 0.006965, 0.004133, 0.001717, -0.002518, -0.005419, -0.008306, -0.009954, -0.010826, -0.009985, -0.008735, -0.006610, -0.006971, -0.006128, -0.006120, -0.005340, -0.003845, -0.002225, 0.000058, 0.002478, 0.005585, 0.006821
#*# 	  0.014572, 0.014014, 0.011785, 0.007816, 0.005454, 0.003053, 0.000137, -0.002361, -0.004543, -0.007286, -0.008748, -0.009088, -0.008125, -0.006412, -0.005678, -0.004245, -0.002794, -0.003246, -0.001957, -0.000444, 0.000694, 0.002826, 0.004517, 0.007779, 0.010016
#*# 	  0.013390, 0.012626, 0.009352, 0.002591, 0.002132, 0.000098, -0.001845, -0.004842, -0.005684, -0.007756, -0.008983, -0.009203, -0.008083, -0.005805, -0.004686, -0.003212, -0.001846, -0.001033, -0.000130, 0.000677, 0.001852, 0.004205, 0.007373, 0.011150, 0.014105
#*# 	  0.013435, 0.008729, 0.002773, -0.003048, -0.003025, -0.004025, -0.005115, -0.008298, -0.009426, -0.011012, -0.012319, -0.012219, -0.011746, -0.010817, -0.009214, -0.007570, -0.005996, -0.005836, -0.004639, -0.003079, -0.002516, 0.000011, 0.001818, 0.006053, 0.008968
#*# 	  0.010513, 0.008375, 0.001488, -0.004955, -0.004784, -0.005869, -0.007124, -0.009927, -0.012270, -0.013719, -0.014636, -0.015115, -0.014318, -0.013961, -0.011998, -0.009967, -0.009803, -0.008446, -0.007279, -0.006006, -0.005059, -0.003502, -0.001411, 0.002276, 0.006126
#*# 	  0.011721, 0.008697, 0.003252, -0.003800, -0.003614, -0.005211, -0.006308, -0.009556, -0.011354, -0.013063, -0.014323, -0.014764, -0.013761, -0.011447, -0.009604, -0.007977, -0.007433, -0.007195, -0.006109, -0.004809, -0.004410, -0.002047, 0.000315, 0.004272, 0.006586
#*# 	  0.004808, 0.001962, -0.003669, -0.008050, -0.008193, -0.008038, -0.008928, -0.012033, -0.013676, -0.016058, -0.017210, -0.017410, -0.017438, -0.014668, -0.012811, -0.012173, -0.011284, -0.011491, -0.010667, -0.008462, -0.007674, -0.004186, -0.002223, 0.002326, 0.004280
#*# 	  -0.001346, -0.003533, -0.007004, -0.009426, -0.009336, -0.010021, -0.010614, -0.014211, -0.016566, -0.018522, -0.020864, -0.022128, -0.021163, -0.018112, -0.016653, -0.015301, -0.014130, -0.013198, -0.013045, -0.011627, -0.010465, -0.007035, -0.004099, -0.000543, 0.003111
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.37500
