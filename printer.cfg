# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

#[temperature_sensor enclosure]
#sensor_type: ATC Semitec 104NT-4-R025H42G
#sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.021811, -0.018133, -0.017826, -0.032091, -0.038957, -0.039682, -0.040173, -0.039956, -0.040809, -0.036600, -0.037499, -0.038011, -0.034941, -0.034665, -0.039050, -0.043427, -0.039731, -0.034846, -0.031717, -0.025402, -0.031246, -0.026104, -0.016270, -0.022507, -0.023284
#*# 	  -0.010607, -0.016827, -0.014957, -0.019232, -0.024893, -0.029109, -0.037510, -0.045333, -0.047098, -0.036139, -0.031747, -0.032816, -0.032993, -0.029290, -0.030652, -0.032216, -0.029659, -0.027203, -0.022399, -0.023662, -0.029224, -0.023574, -0.024918, -0.029914, -0.031255
#*# 	  0.000147, -0.010642, -0.017437, -0.016055, -0.021038, -0.024155, -0.030940, -0.035904, -0.041230, -0.037230, -0.036543, -0.037247, -0.031654, -0.019817, -0.027284, -0.033221, -0.037774, -0.033008, -0.029762, -0.029147, -0.027589, -0.027865, -0.025074, -0.023141, -0.020916
#*# 	  -0.005422, -0.009518, -0.013028, -0.020312, -0.025664, -0.026632, -0.025986, -0.027077, -0.030283, -0.034917, -0.036644, -0.027706, -0.015467, -0.014493, -0.028847, -0.031765, -0.032310, -0.026776, -0.018066, -0.016704, -0.019498, -0.020297, -0.020066, -0.020405, -0.017510
#*# 	  -0.003641, -0.013032, -0.008725, -0.008622, -0.010579, -0.011335, -0.008324, -0.007832, -0.010051, -0.023928, -0.022074, -0.013256, -0.009610, -0.016241, -0.027616, -0.025127, -0.023965, -0.024087, -0.015792, -0.020610, -0.023147, -0.019521, -0.027516, -0.021666, -0.014778
#*# 	  -0.005724, -0.007254, 0.003908, 0.000686, -0.006120, -0.008839, -0.009921, -0.000346, 0.006324, -0.009000, -0.012827, -0.009581, -0.010127, -0.015937, -0.019538, -0.024358, -0.028853, -0.021050, -0.012308, -0.018909, -0.022379, -0.019928, -0.017164, -0.017185, -0.016833
#*# 	  0.013448, 0.010231, 0.007077, -0.002389, -0.011316, -0.014346, -0.015592, -0.004634, 0.000394, -0.005286, -0.011640, -0.012373, -0.015421, -0.022643, -0.021467, -0.023567, -0.027811, -0.023679, -0.014321, -0.019245, -0.020646, -0.018045, -0.016329, -0.014766, -0.015782
#*# 	  0.013502, 0.010742, 0.005501, -0.007570, -0.010728, -0.001166, -0.004010, -0.003771, -0.003977, -0.001084, -0.005993, -0.007256, -0.021424, -0.031384, -0.022760, -0.024205, -0.024268, -0.022924, -0.016283, -0.016955, -0.015333, -0.014862, -0.017121, -0.015844, -0.014823
#*# 	  0.011871, 0.006273, 0.000179, -0.010573, -0.003453, 0.004134, -0.005909, 0.002595, 0.003933, -0.003726, 0.000706, 0.005257, -0.014410, -0.031367, -0.020543, -0.019118, -0.018376, -0.014792, -0.011291, -0.014288, -0.011624, -0.009098, -0.009810, -0.009311, -0.000835
#*# 	  0.006215, -0.003457, -0.009774, -0.006668, 0.012074, -0.003055, -0.015865, 0.002495, 0.009022, -0.007371, -0.009636, 0.007628, 0.003740, -0.011746, -0.019094, -0.017964, -0.014788, -0.008167, -0.001861, -0.002603, -0.005522, -0.008415, -0.009230, -0.003002, 0.001457
#*# 	  0.004406, 0.006726, 0.007789, 0.010736, 0.020892, 0.004251, 0.006091, 0.014292, 0.012337, 0.004338, -0.009105, 0.001300, 0.007786, 0.001113, -0.009067, -0.004876, -0.003286, -0.001854, -0.003497, -0.000177, -0.001277, -0.006218, -0.007744, -0.001759, 0.000742
#*# 	  0.023902, 0.028199, 0.031219, 0.028844, 0.025059, 0.017015, 0.024116, 0.021562, 0.015385, 0.012484, 0.000912, -0.000381, 0.003009, 0.003698, 0.000390, 0.000936, -0.004337, -0.005369, 0.002423, 0.000904, -0.008423, -0.001829, -0.002934, -0.001247, 0.002481
#*# 	  0.033649, 0.032129, 0.027773, 0.021799, 0.020686, 0.025269, 0.027608, 0.021758, 0.015130, 0.007965, 0.001463, -0.001562, 0.001944, 0.006900, 0.000611, -0.010431, -0.017182, -0.010559, 0.002754, -0.003283, -0.007071, -0.002701, -0.005201, -0.001360, -0.000343
#*# 	  0.023813, 0.027081, 0.011160, 0.004442, 0.018854, 0.025729, 0.019019, 0.008914, -0.006302, -0.007879, -0.009655, -0.020532, -0.010197, -0.001948, -0.014017, -0.022471, -0.016407, -0.007756, -0.006155, -0.010511, -0.010628, -0.011397, -0.008678, -0.003071, -0.003877
#*# 	  0.008472, 0.017421, -0.000144, -0.002815, 0.019975, 0.026458, 0.014861, -0.001580, -0.024467, -0.014366, -0.011850, -0.027623, -0.017550, -0.004643, -0.013714, -0.019033, -0.015071, -0.013003, -0.015160, -0.013775, -0.015456, -0.016422, -0.011271, -0.005994, -0.005710
#*# 	  0.018665, 0.017189, 0.010821, 0.008806, 0.015228, 0.024806, 0.019629, 0.008622, -0.002543, 0.000799, -0.002179, -0.011834, -0.010199, -0.002743, -0.013732, -0.019220, -0.016958, -0.016658, -0.017964, -0.014547, -0.012103, -0.014307, -0.011993, -0.006655, -0.005936
#*# 	  0.019671, 0.022730, 0.019440, 0.013409, 0.011120, 0.023151, 0.024922, 0.019025, 0.009954, 0.005289, 0.005359, 0.000361, -0.000591, -0.005848, -0.022457, -0.018179, -0.013854, -0.016495, -0.020001, -0.014120, -0.009752, -0.012460, -0.010004, -0.004421, -0.000907
#*# 	  0.007242, 0.013743, 0.009549, 0.004290, 0.018249, 0.028328, 0.015002, -0.002606, -0.005830, -0.000671, -0.007052, -0.015315, -0.013956, -0.012888, -0.013870, -0.007990, -0.011206, -0.021613, -0.020871, -0.009785, -0.008148, -0.013050, -0.006412, -0.001008, 0.003197
#*# 	  0.014868, 0.014588, 0.013666, 0.006103, 0.017832, 0.029427, 0.014658, -0.004745, -0.004613, 0.002050, -0.013735, -0.022562, -0.021228, -0.013368, -0.004590, -0.000323, -0.008199, -0.016251, -0.010985, -0.003809, -0.004850, -0.009380, -0.004535, 0.000476, 0.007403
#*# 	  0.004250, 0.008722, 0.007810, -0.002315, -0.000445, 0.022372, 0.020365, 0.013816, 0.010288, 0.001924, -0.006021, -0.012257, -0.016012, -0.012797, -0.005438, -0.001280, -0.006391, -0.005661, -0.001448, -0.002497, -0.002598, 0.000057, 0.002778, 0.006845, 0.014564
#*# 	  0.003110, 0.004077, 0.003722, 0.007197, 0.012143, 0.021910, 0.021741, 0.018231, 0.013410, 0.001616, -0.001383, -0.005379, -0.008476, -0.008027, -0.003506, -0.002049, -0.004070, -0.002336, -0.004844, -0.000961, 0.006348, 0.008919, 0.008861, 0.008867, 0.009095
#*# 	  0.000856, -0.001373, 0.010074, 0.016361, 0.016151, 0.016187, 0.016378, 0.013754, 0.009377, 0.002226, -0.003326, -0.008070, -0.010942, -0.011878, -0.009581, -0.006299, -0.004286, -0.006302, -0.003396, 0.002786, 0.003903, 0.000807, -0.000480, -0.000052, -0.012841
#*# 	  0.009094, 0.012084, 0.017728, 0.015808, 0.011055, 0.008049, 0.004648, 0.001133, -0.001862, -0.006076, -0.010523, -0.015262, -0.019397, -0.020453, -0.017334, -0.009072, -0.008038, -0.013528, -0.011969, -0.012682, -0.020137, -0.021150, -0.014594, -0.008414, -0.007751
#*# 	  0.007371, 0.010235, 0.009604, 0.002236, -0.001745, -0.006474, -0.008541, -0.010695, -0.015693, -0.018935, -0.021239, -0.026207, -0.031320, -0.029070, -0.022493, -0.011394, -0.014315, -0.024408, -0.017782, -0.015145, -0.019933, -0.015433, -0.017353, -0.018985, -0.011085
#*# 	  -0.000775, -0.008295, -0.010204, -0.014721, -0.016835, -0.019627, -0.020554, -0.020443, -0.022468, -0.023874, -0.025452, -0.026474, -0.029040, -0.031734, -0.026204, -0.018038, -0.021170, -0.023767, -0.014937, -0.016648, -0.021121, -0.016826, -0.019195, -0.016913, -0.008837
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.30000
