# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

[temperature_sensor enclosure]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.090865, -0.086615, -0.084114, -0.093388, -0.099570, -0.100559, -0.102136, -0.106365, -0.107733, -0.103249, -0.101481, -0.099990, -0.098245, -0.098409, -0.102947, -0.107546, -0.105364, -0.101455, -0.096765, -0.090693, -0.093568, -0.090379, -0.080778, -0.086673, -0.089076
#*# 	  -0.079123, -0.083864, -0.084107, -0.081821, -0.086748, -0.090700, -0.099052, -0.110938, -0.112116, -0.100903, -0.096013, -0.098019, -0.098336, -0.094595, -0.094686, -0.097464, -0.095716, -0.094304, -0.089052, -0.090178, -0.093328, -0.088630, -0.089361, -0.093593, -0.094097
#*# 	  -0.070978, -0.077375, -0.083387, -0.080643, -0.085555, -0.089494, -0.095326, -0.099350, -0.103399, -0.100611, -0.100752, -0.101950, -0.095166, -0.083664, -0.090357, -0.097573, -0.102858, -0.099222, -0.093947, -0.092605, -0.090221, -0.090637, -0.087769, -0.085766, -0.083824
#*# 	  -0.074648, -0.077184, -0.079106, -0.080795, -0.086827, -0.089892, -0.087752, -0.088736, -0.091500, -0.098076, -0.100443, -0.090828, -0.078327, -0.077203, -0.091720, -0.094273, -0.094398, -0.090712, -0.083231, -0.079722, -0.082356, -0.082156, -0.083096, -0.082994, -0.079302
#*# 	  -0.074717, -0.080880, -0.072576, -0.066976, -0.068149, -0.070994, -0.070707, -0.069022, -0.069002, -0.083399, -0.085659, -0.077312, -0.073342, -0.079066, -0.090324, -0.089555, -0.089315, -0.088658, -0.082021, -0.082166, -0.085828, -0.081149, -0.088584, -0.084790, -0.077387
#*# 	  -0.071126, -0.069987, -0.054590, -0.057686, -0.067269, -0.073099, -0.076335, -0.067295, -0.057617, -0.070263, -0.078288, -0.073457, -0.073746, -0.079163, -0.083960, -0.087083, -0.092058, -0.086303, -0.077644, -0.081006, -0.083907, -0.080800, -0.078978, -0.077907, -0.076842
#*# 	  -0.051810, -0.051090, -0.052793, -0.062391, -0.073457, -0.077259, -0.078779, -0.070361, -0.064112, -0.066908, -0.074750, -0.075649, -0.078682, -0.087544, -0.085661, -0.087430, -0.090600, -0.087755, -0.078632, -0.080283, -0.081669, -0.079912, -0.077371, -0.075058, -0.076982
#*# 	  -0.049115, -0.052659, -0.057718, -0.069294, -0.073721, -0.061328, -0.067300, -0.067752, -0.066694, -0.065889, -0.067612, -0.068882, -0.082144, -0.095761, -0.086856, -0.086513, -0.086737, -0.086045, -0.079121, -0.079323, -0.075704, -0.074171, -0.077289, -0.076477, -0.074297
#*# 	  -0.053579, -0.058070, -0.064048, -0.073544, -0.065650, -0.058825, -0.070872, -0.063636, -0.056773, -0.068111, -0.064258, -0.058231, -0.074091, -0.093088, -0.084114, -0.083443, -0.083047, -0.078278, -0.072988, -0.073263, -0.070178, -0.068999, -0.069117, -0.069594, -0.059979
#*# 	  -0.058488, -0.068265, -0.074777, -0.073751, -0.052102, -0.061857, -0.077505, -0.062742, -0.052905, -0.067831, -0.074244, -0.058520, -0.055791, -0.071449, -0.080995, -0.080397, -0.076083, -0.070001, -0.063604, -0.061495, -0.063467, -0.067358, -0.067998, -0.062177, -0.059028
#*# 	  -0.060639, -0.056418, -0.051408, -0.048997, -0.039510, -0.052539, -0.053917, -0.047043, -0.048720, -0.053841, -0.069786, -0.062480, -0.056603, -0.060513, -0.069918, -0.065336, -0.064260, -0.063077, -0.063572, -0.059072, -0.059874, -0.063579, -0.066280, -0.060917, -0.060333
#*# 	  -0.038006, -0.032395, -0.029883, -0.031164, -0.034799, -0.040075, -0.035414, -0.037435, -0.043987, -0.048034, -0.057574, -0.060691, -0.059510, -0.056817, -0.058931, -0.060100, -0.065574, -0.066850, -0.056382, -0.057034, -0.065535, -0.058385, -0.060486, -0.060819, -0.056774
#*# 	  -0.027572, -0.028202, -0.031928, -0.038256, -0.037588, -0.032058, -0.031141, -0.037181, -0.044674, -0.050437, -0.057348, -0.061621, -0.057800, -0.050798, -0.056668, -0.069818, -0.077305, -0.069873, -0.056117, -0.058521, -0.061164, -0.058555, -0.060960, -0.058250, -0.057124
#*# 	  -0.039355, -0.035771, -0.052525, -0.059074, -0.041568, -0.031743, -0.039036, -0.050159, -0.068664, -0.067452, -0.067476, -0.080991, -0.069617, -0.057424, -0.068773, -0.081598, -0.075824, -0.065299, -0.061808, -0.064804, -0.064138, -0.067232, -0.063826, -0.059952, -0.059934
#*# 	  -0.055849, -0.043978, -0.058388, -0.060910, -0.039097, -0.031911, -0.042262, -0.059544, -0.083339, -0.073498, -0.066723, -0.084541, -0.076740, -0.060882, -0.067169, -0.075743, -0.072242, -0.069372, -0.069900, -0.066979, -0.067761, -0.071538, -0.066772, -0.061834, -0.062092
#*# 	  -0.043354, -0.042623, -0.046696, -0.049728, -0.045709, -0.037518, -0.040262, -0.049788, -0.060111, -0.057410, -0.058815, -0.067070, -0.066810, -0.057510, -0.068917, -0.076242, -0.073993, -0.072216, -0.073058, -0.068842, -0.065337, -0.068961, -0.066809, -0.063341, -0.062173
#*# 	  -0.047144, -0.038777, -0.040076, -0.044989, -0.045634, -0.035921, -0.035777, -0.043450, -0.051285, -0.055126, -0.053377, -0.057838, -0.058146, -0.061727, -0.077475, -0.073453, -0.069446, -0.072288, -0.075124, -0.068821, -0.063454, -0.066327, -0.064739, -0.060484, -0.055489
#*# 	  -0.055730, -0.049435, -0.050974, -0.057467, -0.042728, -0.033815, -0.049176, -0.069370, -0.074443, -0.064951, -0.070844, -0.079512, -0.075398, -0.071677, -0.071332, -0.064306, -0.068644, -0.077684, -0.075155, -0.064998, -0.061968, -0.067295, -0.061511, -0.056906, -0.052107
#*# 	  -0.052552, -0.050057, -0.047827, -0.055479, -0.047131, -0.036017, -0.051650, -0.071416, -0.072384, -0.064718, -0.076268, -0.083968, -0.082666, -0.073339, -0.063695, -0.058333, -0.065642, -0.071165, -0.065372, -0.058069, -0.058540, -0.063283, -0.059699, -0.056006, -0.048018
#*# 	  -0.061649, -0.054731, -0.054449, -0.063992, -0.060549, -0.043038, -0.044508, -0.054091, -0.058628, -0.065886, -0.070598, -0.072274, -0.075772, -0.071568, -0.065617, -0.059692, -0.063406, -0.060722, -0.056561, -0.056893, -0.054899, -0.052225, -0.050558, -0.047651, -0.040660
#*# 	  -0.061295, -0.059466, -0.057270, -0.052075, -0.046430, -0.040064, -0.042617, -0.048878, -0.053727, -0.063102, -0.065511, -0.066769, -0.068450, -0.066737, -0.061883, -0.059085, -0.059202, -0.057678, -0.057995, -0.053481, -0.045180, -0.042660, -0.043720, -0.045725, -0.049126
#*# 	  -0.063801, -0.063281, -0.050640, -0.045088, -0.045909, -0.046750, -0.049548, -0.054148, -0.056091, -0.063842, -0.068526, -0.071113, -0.072399, -0.071433, -0.069318, -0.064043, -0.059077, -0.060929, -0.058860, -0.052453, -0.050450, -0.055241, -0.056577, -0.055629, -0.069341
#*# 	  -0.055923, -0.051375, -0.046628, -0.047985, -0.052203, -0.056891, -0.060108, -0.065076, -0.067153, -0.071340, -0.074871, -0.077168, -0.080680, -0.080193, -0.075708, -0.064241, -0.062574, -0.069957, -0.067923, -0.068649, -0.074525, -0.076391, -0.070022, -0.064909, -0.065286
#*# 	  -0.058554, -0.058482, -0.056894, -0.063264, -0.067461, -0.071693, -0.073242, -0.076436, -0.080691, -0.083681, -0.084313, -0.088185, -0.092149, -0.088591, -0.082229, -0.068081, -0.069823, -0.079561, -0.073572, -0.070052, -0.075081, -0.071955, -0.074156, -0.077470, -0.070899
#*# 	  -0.069420, -0.077051, -0.077237, -0.080278, -0.082094, -0.083826, -0.084707, -0.084088, -0.085251, -0.085435, -0.084817, -0.085467, -0.087511, -0.089602, -0.085014, -0.074895, -0.076173, -0.079793, -0.069989, -0.071819, -0.077144, -0.074362, -0.076407, -0.075406, -0.069724
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.13500
