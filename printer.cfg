# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.500
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.02

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.37
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

#[temperature_sensor enclosure]
#sensor_type: ATC Semitec 104NT-4-R025H42G
#sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.018936, -0.012992, -0.013474, -0.022435, -0.035728, -0.035674, -0.035200, -0.033284, -0.031575, -0.029702, -0.034410, -0.039787, -0.038989, -0.034600, -0.039310, -0.044763, -0.044848, -0.040032, -0.037894, -0.033383, -0.029744, -0.034062, -0.022241, -0.015585, -0.021229
#*# 	  -0.010643, -0.010608, -0.010993, -0.012519, -0.018701, -0.022885, -0.029952, -0.037031, -0.038941, -0.034702, -0.030288, -0.030402, -0.031173, -0.030669, -0.029889, -0.034639, -0.031715, -0.029494, -0.026453, -0.022123, -0.026109, -0.025637, -0.020474, -0.024148, -0.027334
#*# 	  0.002812, -0.002436, -0.013806, -0.010679, -0.012024, -0.014859, -0.022528, -0.030730, -0.036023, -0.034304, -0.031567, -0.034696, -0.033197, -0.025319, -0.021935, -0.030150, -0.031776, -0.032429, -0.028482, -0.028105, -0.028511, -0.028071, -0.026306, -0.026449, -0.021489
#*# 	  -0.000522, 0.001243, -0.004143, -0.009232, -0.014517, -0.016375, -0.019237, -0.023208, -0.025326, -0.026991, -0.033094, -0.033130, -0.022594, -0.011326, -0.017780, -0.028981, -0.032641, -0.030519, -0.024272, -0.018582, -0.016900, -0.020667, -0.017424, -0.012652, -0.012635
#*# 	  0.003806, -0.005222, -0.007051, -0.004792, -0.005823, -0.007547, -0.008539, -0.008716, -0.011199, -0.020638, -0.026881, -0.018633, -0.009108, -0.009097, -0.023322, -0.027963, -0.022520, -0.023079, -0.018923, -0.012462, -0.019959, -0.016726, -0.020767, -0.024054, -0.011136
#*# 	  0.003701, -0.005346, 0.002492, 0.008739, 0.006807, 0.004117, -0.000594, 0.001103, 0.008275, 0.002234, -0.011654, -0.009388, -0.005545, -0.007758, -0.017078, -0.020886, -0.024026, -0.023265, -0.014343, -0.007698, -0.019006, -0.016881, -0.014587, -0.013261, -0.009200
#*# 	  0.015576, 0.013465, 0.013998, 0.012073, 0.004616, -0.002283, -0.008508, -0.005578, 0.007720, 0.004813, -0.008077, -0.009422, -0.008323, -0.013162, -0.018674, -0.018148, -0.021367, -0.021518, -0.012340, -0.008393, -0.018803, -0.013958, -0.011416, -0.008184, -0.005162
#*# 	  0.018973, 0.019742, 0.017609, 0.012232, 0.002800, 0.005148, 0.003726, 0.003037, 0.004107, 0.004671, 0.002278, -0.005728, -0.007304, -0.021341, -0.024748, -0.021244, -0.022364, -0.021757, -0.013326, -0.006431, -0.010296, -0.008838, -0.007766, -0.007537, -0.006323
#*# 	  0.021823, 0.017357, 0.014613, 0.006250, -0.000898, 0.013696, 0.007523, 0.003599, 0.011447, 0.005300, 0.004892, 0.007399, 0.002264, -0.025505, -0.021962, -0.016104, -0.013095, -0.013399, -0.007917, -0.008946, -0.009603, -0.004060, -0.003322, -0.005824, 0.002424
#*# 	  0.018156, 0.010275, 0.004071, 0.000294, 0.013504, 0.020680, -0.001782, -0.002703, 0.017632, 0.008337, -0.002182, 0.006897, 0.013333, -0.006419, -0.015535, -0.015014, -0.011745, -0.009288, 0.000454, 0.003809, 0.001938, 0.000742, 0.000702, 0.005172, 0.011883
#*# 	  0.012541, 0.009380, 0.010313, 0.007504, 0.021895, 0.021213, 0.003618, 0.010526, 0.019210, 0.014746, -0.002555, -0.000156, 0.014111, 0.010537, -0.005268, -0.009709, -0.002731, 0.000157, 0.001530, 0.005354, 0.007073, 0.000516, -0.005051, 0.003107, 0.010574
#*# 	  0.024354, 0.030181, 0.032950, 0.034048, 0.035161, 0.029434, 0.022851, 0.027543, 0.022684, 0.020821, 0.007524, 0.001624, 0.004235, 0.008699, 0.001004, 0.002199, 0.004686, 0.003413, 0.005136, 0.009796, 0.006333, 0.002319, 0.004764, 0.006027, 0.012752
#*# 	  0.037550, 0.041098, 0.039184, 0.036170, 0.032661, 0.031238, 0.031584, 0.030440, 0.024277, 0.019037, 0.007630, 0.001991, 0.001283, 0.008830, 0.005771, -0.000606, -0.005557, -0.008315, 0.003516, 0.014302, 0.001206, 0.000604, 0.005101, 0.003570, 0.012236
#*# 	  0.037493, 0.038679, 0.035681, 0.025796, 0.025801, 0.033158, 0.031727, 0.023513, 0.013940, 0.004165, 0.002376, -0.009890, -0.010222, -0.001482, -0.003790, -0.013783, -0.013042, -0.003802, 0.006176, 0.003977, -0.000133, -0.000203, 0.000633, 0.007060, 0.012404
#*# 	  0.020207, 0.033061, 0.031775, 0.009840, 0.020758, 0.038086, 0.031087, 0.015742, -0.004543, -0.017846, -0.004719, -0.021665, -0.023415, -0.008970, -0.006776, -0.015652, -0.011656, -0.004184, -0.002986, -0.004944, -0.004654, -0.008461, -0.004728, 0.003352, 0.008325
#*# 	  0.028633, 0.035325, 0.032946, 0.026854, 0.029366, 0.037934, 0.034084, 0.020769, 0.005437, -0.002714, 0.003302, -0.008619, -0.014132, -0.006823, -0.004125, -0.010517, -0.011247, -0.007648, -0.009280, -0.008234, -0.004809, -0.005392, -0.004858, 0.002701, 0.008112
#*# 	  0.035732, 0.040914, 0.042055, 0.035378, 0.027374, 0.027627, 0.034974, 0.028339, 0.023439, 0.010914, 0.009390, 0.004077, 0.001483, 0.003861, -0.007674, -0.016157, -0.009844, -0.007194, -0.009842, -0.011471, -0.004253, -0.002730, -0.001605, 0.003998, 0.011125
#*# 	  0.021309, 0.024982, 0.031010, 0.023059, 0.023631, 0.035211, 0.033315, 0.018249, 0.006155, 0.001542, 0.002558, -0.004904, -0.006255, -0.004975, -0.012598, -0.011702, -0.003683, -0.008638, -0.016262, -0.012872, -0.002028, -0.002840, -0.001231, 0.006549, 0.013705
#*# 	  0.026104, 0.027153, 0.025977, 0.021606, 0.021738, 0.037688, 0.029325, 0.008609, -0.005950, 0.000234, -0.003794, -0.018879, -0.018201, -0.011352, -0.005506, 0.001754, 0.005378, -0.007222, -0.013064, -0.005354, 0.002216, -0.002394, -0.000977, 0.006498, 0.015236
#*# 	  0.015694, 0.016432, 0.018218, 0.014674, 0.003990, 0.018869, 0.028818, 0.018426, 0.012596, 0.009266, 0.000007, -0.009780, -0.014209, -0.012234, -0.005215, 0.004709, 0.006583, -0.000754, 0.001480, 0.004675, 0.005094, 0.003235, 0.005733, 0.012429, 0.019074
#*# 	  0.009990, 0.012842, 0.011313, 0.008986, 0.012187, 0.017809, 0.026804, 0.019405, 0.018400, 0.007571, -0.000364, -0.002494, -0.005446, -0.005151, -0.002756, 0.005540, 0.006420, 0.006922, 0.007997, 0.004157, 0.006867, 0.012319, 0.013513, 0.015290, 0.021412
#*# 	  0.019075, 0.010617, 0.011637, 0.020199, 0.023805, 0.024082, 0.024402, 0.020083, 0.018918, 0.013146, 0.006027, -0.000612, -0.002296, -0.001057, 0.002648, 0.008127, 0.012848, 0.015414, 0.013946, 0.015342, 0.019950, 0.019675, 0.017107, 0.016454, 0.011508
#*# 	  0.025961, 0.021869, 0.024096, 0.026951, 0.023913, 0.019442, 0.015145, 0.011904, 0.009093, 0.006796, 0.000663, -0.004101, -0.005677, -0.005131, -0.001765, 0.007299, 0.019450, 0.021005, 0.018816, 0.019600, 0.013259, 0.004507, -0.000840, 0.005031, 0.005734
#*# 	  0.024784, 0.026254, 0.024981, 0.020881, 0.014023, 0.008891, 0.004610, 0.001381, -0.000990, -0.005507, -0.009548, -0.013305, -0.016029, -0.014352, -0.006858, 0.007173, 0.023663, 0.019877, 0.016936, 0.019260, 0.011064, 0.003650, 0.004626, 0.001535, 0.002692
#*# 	  0.018123, 0.014775, 0.007578, 0.002403, -0.004863, -0.006980, -0.011698, -0.012075, -0.012885, -0.014795, -0.017450, -0.018390, -0.017924, -0.016180, -0.008518, 0.008323, 0.023141, 0.023809, 0.023309, 0.026941, 0.016123, 0.010466, 0.007043, -0.005291, -0.000773
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.42500
