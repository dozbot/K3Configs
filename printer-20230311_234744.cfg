# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

[temperature_sensor enclosure]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.094004, -0.089609, -0.087020, -0.096674, -0.101591, -0.103339, -0.104713, -0.108322, -0.110426, -0.104187, -0.101073, -0.100266, -0.099017, -0.100057, -0.105205, -0.110543, -0.108452, -0.105431, -0.101155, -0.095081, -0.099279, -0.097944, -0.088913, -0.096243, -0.098388
#*# 	  -0.081804, -0.087882, -0.086656, -0.085620, -0.090034, -0.094830, -0.102602, -0.113615, -0.114748, -0.102674, -0.098263, -0.099785, -0.101543, -0.097727, -0.099087, -0.102017, -0.099452, -0.100052, -0.094937, -0.095407, -0.100560, -0.096902, -0.098441, -0.104372, -0.104018
#*# 	  -0.074111, -0.080546, -0.087427, -0.084395, -0.088587, -0.093456, -0.099167, -0.102323, -0.106476, -0.103563, -0.104159, -0.105300, -0.098927, -0.087247, -0.094598, -0.102626, -0.107727, -0.104699, -0.100303, -0.099339, -0.097987, -0.099138, -0.097558, -0.096831, -0.094581
#*# 	  -0.078486, -0.080988, -0.084510, -0.085791, -0.092115, -0.094867, -0.092491, -0.092195, -0.094974, -0.101528, -0.104412, -0.094459, -0.082185, -0.080654, -0.096122, -0.100391, -0.100698, -0.097896, -0.091092, -0.086049, -0.090370, -0.091594, -0.093774, -0.094169, -0.090091
#*# 	  -0.079239, -0.085308, -0.078434, -0.071210, -0.072424, -0.075896, -0.074727, -0.073053, -0.073348, -0.086670, -0.089357, -0.081350, -0.076986, -0.083342, -0.093948, -0.093968, -0.093758, -0.093256, -0.088098, -0.089887, -0.095041, -0.090624, -0.099432, -0.096102, -0.087748
#*# 	  -0.075143, -0.075290, -0.060622, -0.062970, -0.072649, -0.077227, -0.080444, -0.072865, -0.061469, -0.073192, -0.081321, -0.078774, -0.079103, -0.083417, -0.089285, -0.092079, -0.098508, -0.093624, -0.084488, -0.088612, -0.093615, -0.090894, -0.088822, -0.089032, -0.088366
#*# 	  -0.053180, -0.053331, -0.056409, -0.065636, -0.076387, -0.079243, -0.081851, -0.073491, -0.067023, -0.070031, -0.077171, -0.078559, -0.081781, -0.090182, -0.090174, -0.092369, -0.095776, -0.093266, -0.084861, -0.087741, -0.089506, -0.089815, -0.088256, -0.085782, -0.087709
#*# 	  -0.052032, -0.056078, -0.061548, -0.073934, -0.077989, -0.066183, -0.071517, -0.070268, -0.070117, -0.068125, -0.072313, -0.071662, -0.085559, -0.101444, -0.092674, -0.091007, -0.090832, -0.090194, -0.085772, -0.086928, -0.084850, -0.084397, -0.088164, -0.087674, -0.083744
#*# 	  -0.055675, -0.061374, -0.067292, -0.077727, -0.067784, -0.061005, -0.073960, -0.066044, -0.058964, -0.069379, -0.066099, -0.060526, -0.074975, -0.096031, -0.087867, -0.086438, -0.087248, -0.082882, -0.079094, -0.081276, -0.078730, -0.078430, -0.079248, -0.080279, -0.070804
#*# 	  -0.060894, -0.070831, -0.078447, -0.076153, -0.052856, -0.064412, -0.080476, -0.064837, -0.054438, -0.069336, -0.077343, -0.060791, -0.057314, -0.073152, -0.084612, -0.084086, -0.079440, -0.074239, -0.070178, -0.069820, -0.072384, -0.077622, -0.080077, -0.074823, -0.069902
#*# 	  -0.062779, -0.057134, -0.053455, -0.051746, -0.041575, -0.056261, -0.055173, -0.048513, -0.049045, -0.055491, -0.069997, -0.064698, -0.059028, -0.062973, -0.073962, -0.069863, -0.067867, -0.069097, -0.072259, -0.068864, -0.067941, -0.073424, -0.076315, -0.071975, -0.069775
#*# 	  -0.039435, -0.034131, -0.030584, -0.033315, -0.038549, -0.045943, -0.038134, -0.041090, -0.046465, -0.049930, -0.060997, -0.063112, -0.062218, -0.059775, -0.063121, -0.064318, -0.069978, -0.074031, -0.064542, -0.065716, -0.075384, -0.070241, -0.071121, -0.070084, -0.068239
#*# 	  -0.028841, -0.030689, -0.035504, -0.041667, -0.040982, -0.035953, -0.034601, -0.039713, -0.047022, -0.052448, -0.060588, -0.065158, -0.060981, -0.054524, -0.061533, -0.076274, -0.083580, -0.077369, -0.064388, -0.068624, -0.071036, -0.069300, -0.070905, -0.068717, -0.067739
#*# 	  -0.043617, -0.037602, -0.054339, -0.064814, -0.045403, -0.038053, -0.043698, -0.054525, -0.073037, -0.072509, -0.071251, -0.085647, -0.074159, -0.062990, -0.074693, -0.088333, -0.082124, -0.074423, -0.071874, -0.075328, -0.074749, -0.077374, -0.076034, -0.070961, -0.071721
#*# 	  -0.059147, -0.047562, -0.060915, -0.065449, -0.042452, -0.035508, -0.045877, -0.062805, -0.087819, -0.079601, -0.071154, -0.088644, -0.081085, -0.066937, -0.074012, -0.083004, -0.081208, -0.078665, -0.081422, -0.078498, -0.078858, -0.082075, -0.079577, -0.074325, -0.073828
#*# 	  -0.046968, -0.046189, -0.050546, -0.053753, -0.051354, -0.042958, -0.043520, -0.054452, -0.064907, -0.062751, -0.064229, -0.071592, -0.071340, -0.063755, -0.075988, -0.083430, -0.081184, -0.082024, -0.082441, -0.078964, -0.075298, -0.078356, -0.077790, -0.074015, -0.073140
#*# 	  -0.049492, -0.042845, -0.044223, -0.050102, -0.050577, -0.041747, -0.039913, -0.048946, -0.056744, -0.060304, -0.059188, -0.063933, -0.063938, -0.069890, -0.084932, -0.082315, -0.078089, -0.082565, -0.086333, -0.080210, -0.075352, -0.077891, -0.075856, -0.071350, -0.068672
#*# 	  -0.060327, -0.055092, -0.056281, -0.062691, -0.048749, -0.039956, -0.054009, -0.077734, -0.079607, -0.070795, -0.077309, -0.086048, -0.080523, -0.078510, -0.078099, -0.073090, -0.076422, -0.087750, -0.086029, -0.075375, -0.072506, -0.077377, -0.072159, -0.067658, -0.063839
#*# 	  -0.055877, -0.053970, -0.052646, -0.061555, -0.052695, -0.041924, -0.057099, -0.077330, -0.078152, -0.070411, -0.082258, -0.091987, -0.089763, -0.081429, -0.072692, -0.067170, -0.073519, -0.081063, -0.076377, -0.068561, -0.069574, -0.073420, -0.070558, -0.066751, -0.060456
#*# 	  -0.068075, -0.060168, -0.060728, -0.068910, -0.068177, -0.048915, -0.051051, -0.060046, -0.065525, -0.073524, -0.077604, -0.080408, -0.082213, -0.079002, -0.074303, -0.068833, -0.073149, -0.072030, -0.067608, -0.067818, -0.066477, -0.063805, -0.062046, -0.060449, -0.052463
#*# 	  -0.066293, -0.065202, -0.063411, -0.058321, -0.053408, -0.046677, -0.049711, -0.056660, -0.060587, -0.071683, -0.073539, -0.075771, -0.076342, -0.075277, -0.071389, -0.069792, -0.069429, -0.069563, -0.070536, -0.066017, -0.056806, -0.053100, -0.054834, -0.057099, -0.060974
#*# 	  -0.069088, -0.071569, -0.057805, -0.052313, -0.053390, -0.055773, -0.058348, -0.062206, -0.066114, -0.072540, -0.077853, -0.081020, -0.080963, -0.080955, -0.078700, -0.072842, -0.070209, -0.072577, -0.070981, -0.064876, -0.062976, -0.066389, -0.068952, -0.067141, -0.082378
#*# 	  -0.063751, -0.059759, -0.054934, -0.057150, -0.060624, -0.066196, -0.070089, -0.073697, -0.077152, -0.080859, -0.084721, -0.088117, -0.090529, -0.090952, -0.086161, -0.074391, -0.071991, -0.082633, -0.080716, -0.080712, -0.086755, -0.088507, -0.083238, -0.077310, -0.078319
#*# 	  -0.067600, -0.064595, -0.064975, -0.072287, -0.076109, -0.080926, -0.084160, -0.085925, -0.089526, -0.093473, -0.094752, -0.099040, -0.103370, -0.100799, -0.093540, -0.079852, -0.080299, -0.091787, -0.086522, -0.082843, -0.086840, -0.084116, -0.087221, -0.090564, -0.084652
#*# 	  -0.077114, -0.084634, -0.086657, -0.089213, -0.090293, -0.093031, -0.094232, -0.093342, -0.094403, -0.095658, -0.096903, -0.097606, -0.099437, -0.101372, -0.096956, -0.087292, -0.088363, -0.092321, -0.083520, -0.084734, -0.090531, -0.086525, -0.087714, -0.087737, -0.082952
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.17000
