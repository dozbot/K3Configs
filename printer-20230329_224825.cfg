# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

#[temperature_sensor enclosure]
#sensor_type: ATC Semitec 104NT-4-R025H42G
#sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.021218, -0.018204, -0.017541, -0.031403, -0.038306, -0.039505, -0.040089, -0.040984, -0.042231, -0.037135, -0.038286, -0.039119, -0.036295, -0.036262, -0.040715, -0.044213, -0.040832, -0.036334, -0.032825, -0.026134, -0.030595, -0.024752, -0.015026, -0.019017, -0.020009
#*# 	  -0.010439, -0.016265, -0.015886, -0.017243, -0.024300, -0.028536, -0.037492, -0.045756, -0.046666, -0.036354, -0.033014, -0.034140, -0.034429, -0.031474, -0.032524, -0.033109, -0.031164, -0.029485, -0.024065, -0.024831, -0.029521, -0.022833, -0.023419, -0.028418, -0.027751
#*# 	  -0.000078, -0.011112, -0.016182, -0.014636, -0.019347, -0.023756, -0.030379, -0.035877, -0.040644, -0.036535, -0.036543, -0.036745, -0.032184, -0.021142, -0.027844, -0.033183, -0.037872, -0.033185, -0.030905, -0.030746, -0.029454, -0.028111, -0.024125, -0.021618, -0.018400
#*# 	  -0.006967, -0.009667, -0.015130, -0.019214, -0.025662, -0.028087, -0.026974, -0.027857, -0.029899, -0.034587, -0.035446, -0.027922, -0.015186, -0.014181, -0.028427, -0.031316, -0.032232, -0.026108, -0.019727, -0.018321, -0.020431, -0.019743, -0.017368, -0.017247, -0.013718
#*# 	  -0.003520, -0.011582, -0.007910, -0.006216, -0.008549, -0.010021, -0.007070, -0.006229, -0.009460, -0.023609, -0.022208, -0.013455, -0.008202, -0.015074, -0.027011, -0.024212, -0.022974, -0.023538, -0.015997, -0.020243, -0.022522, -0.019382, -0.026234, -0.019774, -0.010512
#*# 	  -0.005567, -0.008118, 0.002697, 0.003349, -0.005411, -0.008561, -0.008528, 0.000050, 0.005307, -0.009800, -0.012777, -0.009563, -0.010195, -0.015566, -0.019606, -0.023815, -0.028680, -0.021667, -0.012572, -0.019400, -0.022716, -0.018569, -0.016396, -0.015484, -0.013839
#*# 	  0.012301, 0.009826, 0.007224, -0.000672, -0.010739, -0.014198, -0.014895, -0.004877, 0.000980, -0.006169, -0.011919, -0.012147, -0.016092, -0.022526, -0.021407, -0.023453, -0.026448, -0.022830, -0.014421, -0.017134, -0.019723, -0.016606, -0.013008, -0.011480, -0.013086
#*# 	  0.012701, 0.008728, 0.006531, -0.005889, -0.010052, 0.000610, -0.004007, -0.001587, -0.003445, -0.000663, -0.005577, -0.007207, -0.020396, -0.030566, -0.022288, -0.022789, -0.023047, -0.021454, -0.015166, -0.015392, -0.014175, -0.012466, -0.014356, -0.012316, -0.012205
#*# 	  0.012857, 0.007257, 0.001957, -0.008561, -0.002178, 0.005500, -0.004896, 0.002754, 0.004909, -0.002861, 0.002254, 0.005653, -0.015035, -0.031010, -0.019069, -0.017885, -0.017047, -0.013054, -0.009448, -0.011699, -0.008571, -0.006067, -0.007472, -0.006342, 0.000962
#*# 	  0.006307, -0.001618, -0.007637, -0.003908, 0.014096, -0.000059, -0.012473, 0.002935, 0.009875, -0.006102, -0.007381, 0.008143, 0.004551, -0.011506, -0.017745, -0.015933, -0.013195, -0.007611, -0.000681, 0.000222, -0.002372, -0.004553, -0.004750, 0.001538, 0.005987
#*# 	  0.007033, 0.007614, 0.009677, 0.011961, 0.022642, 0.007430, 0.007440, 0.014788, 0.013952, 0.006346, -0.006878, 0.003662, 0.008790, 0.000665, -0.008334, -0.003928, -0.001529, 0.000337, -0.000247, 0.002095, 0.003204, -0.002515, -0.002763, 0.003465, 0.005232
#*# 	  0.025592, 0.032572, 0.033093, 0.031098, 0.026142, 0.020361, 0.026080, 0.023402, 0.017142, 0.012623, 0.002259, 0.001271, 0.003480, 0.003655, 0.001157, 0.001668, -0.002415, -0.003044, 0.004666, 0.003085, -0.004584, 0.001511, 0.001542, 0.004586, 0.006466
#*# 	  0.034873, 0.032851, 0.030312, 0.025559, 0.022831, 0.027397, 0.028860, 0.022450, 0.015035, 0.009940, 0.002404, -0.000581, 0.003744, 0.008445, 0.000757, -0.008333, -0.016097, -0.009257, 0.005369, 0.001110, -0.002297, 0.001894, 0.001970, 0.003895, 0.004833
#*# 	  0.028080, 0.028282, 0.014207, 0.008733, 0.020270, 0.027936, 0.021317, 0.011654, -0.003829, -0.003774, -0.007498, -0.018019, -0.007261, -0.000809, -0.012419, -0.020961, -0.014656, -0.006206, -0.003325, -0.006388, -0.005895, -0.006416, -0.003627, 0.003217, 0.001176
#*# 	  0.010747, 0.020724, 0.003216, -0.000034, 0.022430, 0.027769, 0.016717, 0.000075, -0.022441, -0.012209, -0.010293, -0.026991, -0.016412, -0.003905, -0.012574, -0.018507, -0.013887, -0.011344, -0.012557, -0.010552, -0.011291, -0.012269, -0.005766, 0.000235, 0.000175
#*# 	  0.021270, 0.019595, 0.014009, 0.012225, 0.017473, 0.026246, 0.021667, 0.010305, -0.001276, 0.002692, -0.000161, -0.010527, -0.009060, -0.001445, -0.012595, -0.017322, -0.015382, -0.014291, -0.015310, -0.010435, -0.007717, -0.008633, -0.006166, -0.000911, -0.001130
#*# 	  0.020996, 0.025208, 0.022515, 0.015894, 0.015173, 0.026305, 0.026505, 0.020834, 0.012150, 0.007574, 0.007153, 0.002013, 0.000895, -0.004610, -0.019799, -0.016757, -0.013202, -0.014644, -0.017155, -0.011724, -0.005543, -0.006628, -0.003564, 0.001227, 0.003858
#*# 	  0.011734, 0.015756, 0.012113, 0.007570, 0.023389, 0.030137, 0.017130, 0.001517, -0.002883, 0.001772, -0.004272, -0.012746, -0.011325, -0.011090, -0.012747, -0.005621, -0.009365, -0.018770, -0.017360, -0.006956, -0.003553, -0.006282, -0.000612, 0.005519, 0.007954
#*# 	  0.018098, 0.017728, 0.016703, 0.009874, 0.023517, 0.032189, 0.016999, -0.001332, -0.000940, 0.003902, -0.011073, -0.020125, -0.018502, -0.010392, -0.002259, 0.002437, -0.006136, -0.012782, -0.006495, 0.000174, 0.000417, -0.002983, 0.002130, 0.006658, 0.012049
#*# 	  0.007386, 0.012075, 0.010384, 0.001097, 0.003813, 0.025033, 0.023122, 0.016821, 0.013877, 0.005530, -0.003207, -0.009023, -0.013017, -0.009526, -0.002643, 0.001239, -0.003531, -0.002264, 0.002423, 0.002717, 0.003257, 0.005792, 0.008535, 0.012749, 0.019280
#*# 	  0.006887, 0.007351, 0.006996, 0.011406, 0.015498, 0.026162, 0.025578, 0.021423, 0.016914, 0.004781, 0.001605, -0.002982, -0.005711, -0.005756, -0.001236, -0.000036, -0.001264, 0.000734, -0.000716, 0.002889, 0.011332, 0.015146, 0.014822, 0.014921, 0.014900
#*# 	  0.005108, 0.003225, 0.012882, 0.020177, 0.020240, 0.020258, 0.020692, 0.017933, 0.013813, 0.006431, 0.000226, -0.003970, -0.006645, -0.007435, -0.005355, -0.001670, 0.000046, -0.001051, 0.001606, 0.007817, 0.010997, 0.008694, 0.007760, 0.007371, -0.005627
#*# 	  0.013056, 0.015595, 0.020773, 0.018482, 0.015388, 0.012239, 0.009139, 0.005967, 0.003814, -0.001499, -0.005122, -0.011136, -0.014776, -0.016195, -0.012651, -0.004589, -0.003636, -0.010055, -0.007163, -0.006283, -0.012432, -0.013537, -0.008422, -0.000597, -0.002142
#*# 	  0.013083, 0.013430, 0.013466, 0.006713, 0.002769, -0.002193, -0.004381, -0.006446, -0.010802, -0.014647, -0.016792, -0.021943, -0.026796, -0.024433, -0.018287, -0.007223, -0.010052, -0.018500, -0.012356, -0.009837, -0.013576, -0.008644, -0.010391, -0.011974, -0.004855
#*# 	  0.004202, -0.004248, -0.005109, -0.010104, -0.012367, -0.014177, -0.015949, -0.015272, -0.017229, -0.018494, -0.020339, -0.021535, -0.024437, -0.026790, -0.021307, -0.012950, -0.016076, -0.018513, -0.008890, -0.010653, -0.014398, -0.009796, -0.012016, -0.010796, -0.002421
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.32000
