# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

[temperature_sensor enclosure]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.037122, -0.031320, -0.028675, -0.039209, -0.043871, -0.044376, -0.045626, -0.049075, -0.051276, -0.043869, -0.041315, -0.041111, -0.039460, -0.040346, -0.046457, -0.050818, -0.048535, -0.044157, -0.038726, -0.033451, -0.037840, -0.033957, -0.026087, -0.033084, -0.036112
#*# 	  -0.024138, -0.030372, -0.028243, -0.026953, -0.031822, -0.035132, -0.043291, -0.055558, -0.056141, -0.043211, -0.038054, -0.040109, -0.041319, -0.037749, -0.039413, -0.041858, -0.039905, -0.038241, -0.031976, -0.033073, -0.038061, -0.032378, -0.035070, -0.041403, -0.042267
#*# 	  -0.015836, -0.023462, -0.028344, -0.026288, -0.030887, -0.033894, -0.040091, -0.043557, -0.048117, -0.044151, -0.044505, -0.045819, -0.039231, -0.027302, -0.034136, -0.042810, -0.047424, -0.043579, -0.037703, -0.036375, -0.035182, -0.035662, -0.034055, -0.033046, -0.031868
#*# 	  -0.019923, -0.024283, -0.025798, -0.027770, -0.033169, -0.035717, -0.032546, -0.033054, -0.036758, -0.042949, -0.044367, -0.036237, -0.022249, -0.022151, -0.036937, -0.038902, -0.039223, -0.034945, -0.026120, -0.024081, -0.027698, -0.027767, -0.030214, -0.031585, -0.027323
#*# 	  -0.020845, -0.026809, -0.019557, -0.013457, -0.014473, -0.016128, -0.015937, -0.013572, -0.014278, -0.028414, -0.029975, -0.022256, -0.017694, -0.022203, -0.034573, -0.033802, -0.033297, -0.032345, -0.025117, -0.028269, -0.031891, -0.027524, -0.036288, -0.033430, -0.026079
#*# 	  -0.018391, -0.017102, -0.001948, -0.003958, -0.013082, -0.017764, -0.020672, -0.011736, -0.001827, -0.015611, -0.021517, -0.017398, -0.018067, -0.022938, -0.027770, -0.031124, -0.036686, -0.029561, -0.020817, -0.026036, -0.030837, -0.027850, -0.026196, -0.025660, -0.025323
#*# 	  0.004513, 0.003698, 0.001875, -0.007912, -0.018669, -0.021476, -0.023337, -0.013963, -0.008557, -0.011188, -0.017046, -0.018522, -0.022524, -0.030916, -0.029204, -0.031891, -0.034356, -0.030933, -0.021433, -0.024200, -0.026431, -0.025901, -0.023606, -0.022785, -0.024543
#*# 	  0.004007, 0.000586, -0.004617, -0.016175, -0.020066, -0.007634, -0.012578, -0.012303, -0.011820, -0.009688, -0.011874, -0.012636, -0.027153, -0.039905, -0.030830, -0.030532, -0.029667, -0.029076, -0.022750, -0.024233, -0.022569, -0.020350, -0.025346, -0.025522, -0.021521
#*# 	  0.000727, -0.005256, -0.012539, -0.020582, -0.010536, -0.003836, -0.016358, -0.008864, -0.004065, -0.012594, -0.007949, -0.002813, -0.019054, -0.037771, -0.028105, -0.027059, -0.026479, -0.020658, -0.016173, -0.018257, -0.016878, -0.014912, -0.016798, -0.017232, -0.008068
#*# 	  -0.006333, -0.015627, -0.023198, -0.020754, 0.003983, -0.008032, -0.023801, -0.008097, 0.001579, -0.012276, -0.018977, -0.003245, -0.001137, -0.016012, -0.025384, -0.025482, -0.020259, -0.012743, -0.007883, -0.007163, -0.009934, -0.014640, -0.017878, -0.011017, -0.006700
#*# 	  -0.005296, -0.001124, 0.003761, 0.005053, 0.015421, 0.002336, 0.001736, 0.009428, 0.005685, 0.002533, -0.013486, -0.006102, -0.000036, -0.004523, -0.013379, -0.008083, -0.006241, -0.005789, -0.007153, -0.004838, -0.005777, -0.010273, -0.013615, -0.008908, -0.007146
#*# 	  0.016512, 0.022638, 0.025953, 0.023110, 0.018792, 0.013240, 0.018811, 0.016475, 0.009758, 0.006935, -0.004090, -0.006466, -0.004595, -0.001682, -0.004180, -0.004786, -0.009072, -0.010548, -0.001140, -0.003518, -0.013362, -0.006211, -0.008862, -0.008287, -0.004550
#*# 	  0.026010, 0.025555, 0.020515, 0.013825, 0.013776, 0.021130, 0.021887, 0.015715, 0.008963, 0.002248, -0.003627, -0.008347, -0.004467, 0.003521, -0.002494, -0.017196, -0.022707, -0.014534, -0.001182, -0.005341, -0.009362, -0.005806, -0.008889, -0.007361, -0.006177
#*# 	  0.013155, 0.017672, 0.000018, -0.008574, 0.012251, 0.020317, 0.013279, 0.001769, -0.016524, -0.015465, -0.014368, -0.028008, -0.016334, -0.004092, -0.017173, -0.027771, -0.021655, -0.011317, -0.009083, -0.012467, -0.011782, -0.014344, -0.013421, -0.010141, -0.009569
#*# 	  -0.002828, 0.009322, -0.005913, -0.009590, 0.013804, 0.022425, 0.011207, -0.008204, -0.031745, -0.018709, -0.014287, -0.030876, -0.024100, -0.006061, -0.013337, -0.022207, -0.019402, -0.016083, -0.016958, -0.014801, -0.016375, -0.018898, -0.016194, -0.012527, -0.012669
#*# 	  0.010222, 0.010161, 0.006015, 0.003397, 0.007304, 0.016917, 0.015169, 0.003617, -0.008203, -0.004694, -0.005317, -0.013100, -0.012770, -0.003058, -0.015285, -0.021767, -0.020213, -0.018506, -0.019679, -0.016027, -0.014551, -0.016851, -0.016617, -0.012713, -0.013293
#*# 	  0.008247, 0.015698, 0.014084, 0.007371, 0.006979, 0.017111, 0.018890, 0.010204, 0.003018, -0.001259, -0.000105, -0.003049, -0.003869, -0.007535, -0.023451, -0.020416, -0.015841, -0.019595, -0.021864, -0.017099, -0.011998, -0.014897, -0.013013, -0.009765, -0.005018
#*# 	  -0.000779, 0.005167, 0.004617, -0.002250, 0.011451, 0.020665, 0.005490, -0.016158, -0.020406, -0.010486, -0.014894, -0.023379, -0.019081, -0.016217, -0.016101, -0.009370, -0.014342, -0.024520, -0.022771, -0.012516, -0.011428, -0.016211, -0.012016, -0.007254, -0.002694
#*# 	  0.004524, 0.006700, 0.007606, -0.000829, 0.008215, 0.020007, 0.003877, -0.016379, -0.018247, -0.009187, -0.020469, -0.029241, -0.027254, -0.018996, -0.008798, -0.003546, -0.010985, -0.018646, -0.013618, -0.006830, -0.008152, -0.012979, -0.009328, -0.006805, 0.001106
#*# 	  -0.006793, 0.000513, 0.000883, -0.008414, -0.007825, 0.011873, 0.010650, -0.000211, -0.004111, -0.012544, -0.015987, -0.018224, -0.020897, -0.017211, -0.010068, -0.005114, -0.010951, -0.008415, -0.004503, -0.006318, -0.005037, -0.003464, -0.000842, 0.001445, 0.007735
#*# 	  -0.006475, -0.004837, -0.002047, 0.001810, 0.007471, 0.014374, 0.013482, 0.006234, 0.000207, -0.010451, -0.009751, -0.012801, -0.013172, -0.011674, -0.007041, -0.004843, -0.006222, -0.004411, -0.006099, -0.002151, 0.004836, 0.007886, 0.005626, 0.002783, 0.000176
#*# 	  -0.008437, -0.010896, 0.002871, 0.009343, 0.008415, 0.007491, 0.004880, 0.000266, -0.004684, -0.010031, -0.013991, -0.016390, -0.017684, -0.016851, -0.014303, -0.009635, -0.006968, -0.008292, -0.006800, -0.002158, -0.001740, -0.006238, -0.008949, -0.008933, -0.023735
#*# 	  -0.001830, 0.002390, 0.007605, 0.006082, 0.001469, -0.002168, -0.005983, -0.010398, -0.013657, -0.018170, -0.020682, -0.023589, -0.026595, -0.026562, -0.021227, -0.010152, -0.009669, -0.018038, -0.017460, -0.017928, -0.026267, -0.027943, -0.024369, -0.019207, -0.019817
#*# 	  -0.005237, -0.002727, -0.002800, -0.009432, -0.013199, -0.016761, -0.019840, -0.022921, -0.026760, -0.028920, -0.029809, -0.033827, -0.037871, -0.035235, -0.027456, -0.014969, -0.017268, -0.026609, -0.022701, -0.020083, -0.026126, -0.023586, -0.027437, -0.032648, -0.025383
#*# 	  -0.014929, -0.021616, -0.022706, -0.025848, -0.027353, -0.029923, -0.030146, -0.029296, -0.030941, -0.031367, -0.031202, -0.032422, -0.034747, -0.036258, -0.031172, -0.022093, -0.024653, -0.026772, -0.017726, -0.020635, -0.028765, -0.026118, -0.030148, -0.029834, -0.024746
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.19500
