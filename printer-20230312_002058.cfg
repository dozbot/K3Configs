# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

[temperature_sensor enclosure]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.073742, -0.071334, -0.069541, -0.077781, -0.081899, -0.084134, -0.087253, -0.090814, -0.092942, -0.085882, -0.081858, -0.080269, -0.077808, -0.079399, -0.083045, -0.086615, -0.083437, -0.079973, -0.074212, -0.068404, -0.072854, -0.068958, -0.060471, -0.065640, -0.066272
#*# 	  -0.060790, -0.070749, -0.070680, -0.068011, -0.070840, -0.075797, -0.085504, -0.095135, -0.096786, -0.084735, -0.080028, -0.081377, -0.081210, -0.076256, -0.076942, -0.078505, -0.075897, -0.075589, -0.070140, -0.069789, -0.074014, -0.068917, -0.070953, -0.074108, -0.071091
#*# 	  -0.055208, -0.062199, -0.069210, -0.067465, -0.071821, -0.076372, -0.081712, -0.083937, -0.087102, -0.085113, -0.085501, -0.085200, -0.077568, -0.064733, -0.072076, -0.080080, -0.083193, -0.079549, -0.073261, -0.071510, -0.068687, -0.070068, -0.066835, -0.064241, -0.060352
#*# 	  -0.057340, -0.064411, -0.066387, -0.066088, -0.070718, -0.074195, -0.070735, -0.071382, -0.073738, -0.080263, -0.082282, -0.071535, -0.058708, -0.057599, -0.072411, -0.073960, -0.072438, -0.069531, -0.061658, -0.058062, -0.061354, -0.061103, -0.063327, -0.061797, -0.054181
#*# 	  -0.058186, -0.064821, -0.056364, -0.051135, -0.051657, -0.054909, -0.054706, -0.052219, -0.049333, -0.063378, -0.066029, -0.058892, -0.053647, -0.059599, -0.069247, -0.067816, -0.067588, -0.066641, -0.059817, -0.061343, -0.065619, -0.060363, -0.066682, -0.062406, -0.052369
#*# 	  -0.051519, -0.052379, -0.040581, -0.043309, -0.052282, -0.058346, -0.062405, -0.051604, -0.039436, -0.051771, -0.058224, -0.054387, -0.053971, -0.059204, -0.062716, -0.065265, -0.069348, -0.064394, -0.055671, -0.059049, -0.063144, -0.060367, -0.056900, -0.053188, -0.048828
#*# 	  -0.031027, -0.033025, -0.037832, -0.047704, -0.056252, -0.059336, -0.061094, -0.052104, -0.046346, -0.047099, -0.054162, -0.055433, -0.058975, -0.067392, -0.065261, -0.066642, -0.068491, -0.065587, -0.056807, -0.057602, -0.059046, -0.058025, -0.054105, -0.049734, -0.048352
#*# 	  -0.032784, -0.038387, -0.043818, -0.057123, -0.060622, -0.046395, -0.051655, -0.052022, -0.048902, -0.046941, -0.048525, -0.047995, -0.062502, -0.076547, -0.066534, -0.064641, -0.063048, -0.062455, -0.057412, -0.058076, -0.055228, -0.052397, -0.055462, -0.050087, -0.043239
#*# 	  -0.037201, -0.044044, -0.052078, -0.059894, -0.048841, -0.043324, -0.057308, -0.047172, -0.038820, -0.049588, -0.045989, -0.038902, -0.051852, -0.070953, -0.064029, -0.061105, -0.059966, -0.054661, -0.049941, -0.051409, -0.048606, -0.047079, -0.044892, -0.040650, -0.028121
#*# 	  -0.043316, -0.053716, -0.059574, -0.058808, -0.033629, -0.045460, -0.060747, -0.043749, -0.034715, -0.047473, -0.054683, -0.038562, -0.033545, -0.048334, -0.060227, -0.057886, -0.052602, -0.047908, -0.042079, -0.039139, -0.040732, -0.045241, -0.046119, -0.034677, -0.028072
#*# 	  -0.039159, -0.034489, -0.029953, -0.028518, -0.019914, -0.033613, -0.032629, -0.026119, -0.026989, -0.031283, -0.046285, -0.040981, -0.034154, -0.037313, -0.045999, -0.040279, -0.038915, -0.039323, -0.040733, -0.038075, -0.037386, -0.040900, -0.040822, -0.032652, -0.027333
#*# 	  -0.016972, -0.014819, -0.011504, -0.015039, -0.019629, -0.024017, -0.017489, -0.018998, -0.024565, -0.028093, -0.037723, -0.039475, -0.037891, -0.034384, -0.037301, -0.037432, -0.042967, -0.045044, -0.034825, -0.036773, -0.044974, -0.037568, -0.036687, -0.031633, -0.024554
#*# 	  -0.011374, -0.014400, -0.020705, -0.027349, -0.023866, -0.017715, -0.016756, -0.022514, -0.027618, -0.034489, -0.040711, -0.043985, -0.038512, -0.030409, -0.038760, -0.051019, -0.055685, -0.048319, -0.036599, -0.039970, -0.039673, -0.035628, -0.036669, -0.029971, -0.026414
#*# 	  -0.024918, -0.020467, -0.038641, -0.047479, -0.026008, -0.015838, -0.025674, -0.035723, -0.053110, -0.050472, -0.048382, -0.063018, -0.049710, -0.037555, -0.048548, -0.060413, -0.052580, -0.044473, -0.043686, -0.044761, -0.041962, -0.044461, -0.039521, -0.030288, -0.027553
#*# 	  -0.036381, -0.027949, -0.040520, -0.043545, -0.022362, -0.014175, -0.025981, -0.042098, -0.062984, -0.054116, -0.045480, -0.062431, -0.056455, -0.039593, -0.047449, -0.054008, -0.051466, -0.049038, -0.050179, -0.046878, -0.046718, -0.048199, -0.042687, -0.033574, -0.031781
#*# 	  -0.023752, -0.025043, -0.031239, -0.033122, -0.031429, -0.021207, -0.021859, -0.031718, -0.040594, -0.038022, -0.039324, -0.046381, -0.044162, -0.036589, -0.050541, -0.056127, -0.053064, -0.051790, -0.053276, -0.049700, -0.044171, -0.045012, -0.041783, -0.034060, -0.030096
#*# 	  -0.030841, -0.023364, -0.024462, -0.030796, -0.028368, -0.019008, -0.019036, -0.027351, -0.033943, -0.037490, -0.035516, -0.039635, -0.038844, -0.043702, -0.059023, -0.054283, -0.049652, -0.053483, -0.056558, -0.049671, -0.042939, -0.042916, -0.040865, -0.031725, -0.023604
#*# 	  -0.035083, -0.031000, -0.034155, -0.039789, -0.025295, -0.015848, -0.032695, -0.055033, -0.056977, -0.046077, -0.053224, -0.060863, -0.054740, -0.050601, -0.049649, -0.043726, -0.047266, -0.058104, -0.056300, -0.045778, -0.041487, -0.046945, -0.038126, -0.029621, -0.023179
#*# 	  -0.032636, -0.030763, -0.029658, -0.040459, -0.031033, -0.018284, -0.032719, -0.050209, -0.050929, -0.043735, -0.055743, -0.062933, -0.061806, -0.053262, -0.043276, -0.038768, -0.045134, -0.050789, -0.046945, -0.038142, -0.038886, -0.041463, -0.036382, -0.029448, -0.018110
#*# 	  -0.042573, -0.036187, -0.037947, -0.044718, -0.043110, -0.024457, -0.026701, -0.034970, -0.037644, -0.047042, -0.051456, -0.052125, -0.052614, -0.050243, -0.045100, -0.039651, -0.043865, -0.041145, -0.037453, -0.038467, -0.035011, -0.031130, -0.026833, -0.020814, -0.011476
#*# 	  -0.041889, -0.041743, -0.039088, -0.033445, -0.027724, -0.022097, -0.024700, -0.030549, -0.034032, -0.043651, -0.046243, -0.047219, -0.047174, -0.046944, -0.042269, -0.040366, -0.039543, -0.038803, -0.040491, -0.033737, -0.025028, -0.021601, -0.022484, -0.019682, -0.022372
#*# 	  -0.043235, -0.044896, -0.033245, -0.027647, -0.028678, -0.030935, -0.033915, -0.037259, -0.039625, -0.046421, -0.049396, -0.052754, -0.052431, -0.051925, -0.049066, -0.043810, -0.039774, -0.042586, -0.040280, -0.034923, -0.033264, -0.037213, -0.036327, -0.032893, -0.043971
#*# 	  -0.036653, -0.032387, -0.029275, -0.032038, -0.034340, -0.039919, -0.044127, -0.047242, -0.049881, -0.052846, -0.056141, -0.060030, -0.061350, -0.061754, -0.056140, -0.044844, -0.044267, -0.052748, -0.051140, -0.051537, -0.056489, -0.056861, -0.050376, -0.042166, -0.038820
#*# 	  -0.040082, -0.040194, -0.041620, -0.047978, -0.052027, -0.055338, -0.057447, -0.059079, -0.062582, -0.065386, -0.066752, -0.069283, -0.072396, -0.069402, -0.062764, -0.049006, -0.049941, -0.060595, -0.055319, -0.051462, -0.056222, -0.052159, -0.055751, -0.056693, -0.046743
#*# 	  -0.051130, -0.060057, -0.061146, -0.062880, -0.063781, -0.066146, -0.067230, -0.065007, -0.065727, -0.067312, -0.067595, -0.066933, -0.067702, -0.070590, -0.065824, -0.056647, -0.059295, -0.061459, -0.052284, -0.054052, -0.059476, -0.056731, -0.057532, -0.053289, -0.046819
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.14000
