# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

[temperature_sensor enclosure]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.003417, 0.010593, 0.012892, 0.000355, -0.004727, -0.003725, -0.003643, -0.006418, -0.008804, -0.005649, -0.006618, -0.009177, -0.004431, -0.004305, -0.011725, -0.019215, -0.017404, -0.012512, -0.010486, -0.005106, -0.008301, -0.007164, 0.003587, -0.000297, -0.003551
#*# 	  0.013811, 0.012862, 0.014803, 0.013998, 0.010174, 0.005748, -0.002034, -0.012848, -0.015258, -0.004848, -0.000952, -0.003493, -0.003080, -0.000010, -0.002478, -0.005970, -0.003335, -0.003431, 0.000379, 0.001057, -0.004639, -0.000861, -0.000285, -0.008130, -0.010059
#*# 	  0.020845, 0.014468, 0.009485, 0.014359, 0.010548, 0.008252, 0.002054, -0.004725, -0.009527, -0.004646, -0.005170, -0.007980, -0.002030, 0.009435, 0.004299, -0.004828, -0.010269, -0.009220, -0.005473, -0.006683, -0.005606, -0.005477, -0.004415, -0.004705, -0.003042
#*# 	  0.015173, 0.014823, 0.011802, 0.009474, 0.005296, 0.001832, 0.003585, 0.003521, 0.000462, -0.002345, -0.007478, -0.000706, 0.015092, 0.020369, 0.004077, -0.003641, -0.006400, -0.002351, 0.003733, 0.005941, 0.003622, 0.001248, 0.001573, 0.000821, 0.001284
#*# 	  0.011593, 0.008017, 0.012064, 0.017844, 0.018462, 0.017282, 0.019507, 0.021140, 0.019447, 0.005830, 0.005329, 0.015749, 0.024276, 0.020576, 0.004076, 0.002070, 0.002362, 0.000466, 0.004493, 0.002148, -0.000928, 0.002381, -0.006212, -0.004144, 0.004109
#*# 	  0.009162, 0.011643, 0.026039, 0.028317, 0.021177, 0.016897, 0.015462, 0.023735, 0.035272, 0.022666, 0.017505, 0.023576, 0.025999, 0.022345, 0.014430, 0.005353, -0.002564, 0.001855, 0.007926, 0.003719, -0.001735, 0.002802, 0.004408, 0.004206, 0.003324
#*# 	  0.026728, 0.030465, 0.029079, 0.021532, 0.010403, 0.007722, 0.006139, 0.018033, 0.027692, 0.024568, 0.018492, 0.020929, 0.020758, 0.014098, 0.011377, 0.005620, -0.002880, -0.002061, 0.004282, -0.000037, -0.000196, 0.003712, 0.007209, 0.008254, 0.006103
#*# 	  0.026319, 0.025489, 0.021462, 0.009763, 0.006389, 0.018305, 0.015664, 0.017139, 0.021399, 0.025426, 0.021556, 0.023385, 0.014488, 0.001742, 0.006302, 0.001280, -0.002263, -0.003817, 0.000052, 0.000584, 0.003451, 0.007454, 0.006395, 0.008650, 0.008269
#*# 	  0.018331, 0.016120, 0.012338, 0.001597, 0.008851, 0.020954, 0.012078, 0.019251, 0.025712, 0.021469, 0.024121, 0.030133, 0.013986, -0.004684, 0.004227, 0.001880, -0.001544, 0.000699, 0.001237, 0.000007, 0.005398, 0.010896, 0.011459, 0.011592, 0.020134
#*# 	  0.008692, 0.002561, -0.003963, -0.002012, 0.023344, 0.014877, -0.001394, 0.015636, 0.027736, 0.013373, 0.009318, 0.024114, 0.028023, 0.009258, 0.000108, -0.004236, -0.000007, 0.003540, 0.008616, 0.009112, 0.008936, 0.008587, 0.008122, 0.014112, 0.019118
#*# 	  0.000136, 0.004427, 0.008943, 0.012642, 0.028877, 0.016767, 0.015136, 0.025407, 0.026550, 0.020192, 0.004734, 0.014237, 0.022966, 0.016118, 0.003761, 0.006586, 0.007958, 0.008143, 0.004512, 0.007020, 0.008003, 0.003597, 0.001619, 0.008018, 0.009857
#*# 	  0.015422, 0.024241, 0.031972, 0.032662, 0.030681, 0.023979, 0.029837, 0.030435, 0.025499, 0.022456, 0.010383, 0.007676, 0.010711, 0.011839, 0.008667, 0.008948, 0.004666, 0.001867, 0.005565, 0.001993, -0.004541, 0.000612, -0.000533, -0.000323, 0.002322
#*# 	  0.023174, 0.025370, 0.025341, 0.020919, 0.021761, 0.027798, 0.031642, 0.025732, 0.019734, 0.015093, 0.004902, 0.001643, 0.006106, 0.013061, 0.006112, -0.007248, -0.014005, -0.009791, 0.001523, -0.004151, -0.008941, -0.005813, -0.009070, -0.007979, -0.007995
#*# 	  0.008468, 0.012710, 0.001501, -0.004483, 0.014376, 0.024781, 0.019404, 0.009106, -0.004825, -0.007393, -0.009941, -0.022561, -0.011172, 0.001467, -0.010658, -0.026453, -0.020191, -0.010741, -0.009722, -0.014823, -0.015692, -0.018248, -0.018120, -0.015265, -0.017763
#*# 	  -0.015093, 0.000434, -0.015372, -0.015518, 0.011874, 0.022977, 0.011212, -0.006003, -0.029567, -0.023309, -0.017505, -0.034779, -0.024956, -0.007631, -0.015733, -0.025976, -0.021995, -0.019972, -0.022971, -0.022680, -0.025740, -0.030304, -0.027257, -0.023441, -0.024964
#*# 	  -0.009833, -0.003238, -0.006320, -0.004239, 0.006724, 0.018877, 0.014316, 0.002506, -0.010139, -0.004374, -0.007586, -0.021236, -0.019241, -0.008479, -0.020622, -0.028906, -0.027195, -0.027026, -0.029967, -0.028622, -0.026687, -0.031073, -0.030988, -0.028889, -0.031093
#*# 	  -0.011886, -0.001006, 0.002929, 0.002336, 0.003785, 0.018055, 0.020435, 0.014424, 0.006841, 0.002021, -0.001394, -0.006355, -0.007165, -0.012786, -0.031874, -0.033645, -0.029476, -0.032462, -0.036133, -0.032924, -0.029335, -0.032883, -0.032825, -0.031366, -0.029564
#*# 	  -0.026274, -0.011353, -0.009032, -0.007441, 0.009689, 0.025728, 0.015542, -0.002215, -0.006287, -0.002390, -0.009641, -0.023315, -0.023756, -0.029239, -0.034477, -0.031203, -0.032581, -0.042751, -0.043063, -0.035252, -0.030635, -0.036220, -0.032714, -0.030720, -0.028587
#*# 	  -0.018879, -0.010566, -0.002043, 0.000759, 0.019295, 0.035465, 0.022471, 0.002349, 0.001292, 0.009575, -0.010737, -0.028670, -0.032753, -0.029338, -0.027080, -0.025703, -0.033810, -0.042996, -0.039331, -0.031833, -0.031808, -0.036416, -0.033349, -0.032864, -0.030063
#*# 	  -0.029367, -0.013421, -0.004170, -0.002152, 0.010434, 0.039749, 0.042073, 0.036075, 0.032075, 0.022011, 0.005073, -0.011873, -0.024784, -0.031752, -0.031845, -0.032541, -0.038606, -0.037883, -0.033007, -0.034003, -0.032818, -0.031854, -0.030145, -0.030724, -0.027331
#*# 	  -0.030337, -0.016244, -0.003049, 0.012766, 0.031656, 0.052969, 0.061060, 0.060920, 0.055477, 0.035902, 0.020082, 0.002361, -0.013811, -0.026834, -0.031033, -0.035812, -0.039428, -0.037249, -0.040122, -0.039062, -0.030606, -0.028238, -0.030236, -0.033355, -0.037452
#*# 	  -0.033911, -0.021737, 0.004698, 0.026329, 0.042494, 0.057074, 0.068916, 0.072070, 0.069501, 0.051838, 0.028562, 0.006388, -0.014159, -0.028749, -0.037675, -0.041638, -0.042593, -0.046017, -0.045006, -0.040574, -0.036353, -0.038817, -0.042238, -0.047712, -0.065468
#*# 	  -0.031436, -0.014189, 0.006711, 0.023648, 0.037543, 0.048883, 0.058633, 0.063219, 0.059113, 0.046002, 0.025119, 0.000643, -0.022833, -0.039018, -0.048540, -0.047262, -0.049480, -0.058201, -0.059464, -0.061248, -0.069070, -0.071895, -0.068560, -0.065513, -0.071187
#*# 	  -0.040416, -0.023000, -0.008253, 0.003116, 0.016153, 0.027098, 0.036897, 0.039964, 0.035343, 0.023142, 0.005719, -0.018706, -0.041539, -0.053431, -0.058971, -0.054235, -0.060395, -0.074081, -0.071604, -0.071799, -0.078509, -0.076165, -0.080866, -0.085252, -0.080852
#*# 	  -0.058041, -0.051588, -0.039638, -0.028244, -0.014407, -0.004389, 0.004925, 0.008509, 0.006612, -0.003017, -0.014835, -0.031474, -0.051108, -0.062841, -0.067278, -0.063918, -0.070271, -0.076504, -0.071743, -0.075844, -0.082901, -0.081229, -0.089258, -0.092193, -0.087194
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = 0.15000
