# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.500
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.02

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.37
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

#[temperature_sensor enclosure]
#sensor_type: ATC Semitec 104NT-4-R025H42G
#sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.008283, -0.006802, -0.006932, -0.018826, -0.025682, -0.028012, -0.029396, -0.029873, -0.029171, -0.026086, -0.027583, -0.028173, -0.025784, -0.023840, -0.027649, -0.029166, -0.024731, -0.020437, -0.015213, -0.009194, -0.013692, -0.007189, 0.001337, -0.004657, -0.004484
#*# 	  -0.000980, -0.007407, -0.006345, -0.009073, -0.014744, -0.020110, -0.028584, -0.034017, -0.034882, -0.027994, -0.024896, -0.025073, -0.025210, -0.018671, -0.018729, -0.019747, -0.017081, -0.014738, -0.008837, -0.009265, -0.013148, -0.007141, -0.008162, -0.013407, -0.013125
#*# 	  0.007440, -0.002482, -0.007265, -0.007991, -0.012630, -0.014983, -0.022314, -0.026029, -0.030660, -0.029859, -0.029939, -0.029236, -0.020647, -0.008283, -0.015436, -0.021361, -0.025095, -0.020267, -0.016330, -0.013249, -0.011154, -0.011027, -0.006800, -0.005219, -0.002960
#*# 	  0.000736, -0.003113, -0.004630, -0.010806, -0.015632, -0.016768, -0.017719, -0.021276, -0.022220, -0.026671, -0.028341, -0.017531, -0.004280, -0.004220, -0.019323, -0.020964, -0.019515, -0.012740, -0.004041, -0.002329, -0.003921, -0.005082, -0.003405, -0.003967, -0.000149
#*# 	  0.001697, -0.005162, -0.001760, -0.001344, -0.002349, -0.003883, -0.003008, -0.002602, -0.006225, -0.018391, -0.014931, -0.005792, -0.001103, -0.007978, -0.019902, -0.015985, -0.015232, -0.014356, -0.001963, -0.007332, -0.009664, -0.006629, -0.013028, -0.008361, 0.000392
#*# 	  0.001557, 0.000379, 0.009927, 0.007264, 0.001351, -0.002722, -0.004251, 0.004459, 0.010116, -0.005209, -0.009232, -0.003323, -0.002965, -0.008719, -0.013655, -0.015792, -0.020103, -0.012430, 0.002173, -0.006243, -0.010687, -0.006244, -0.002253, -0.003086, -0.001335
#*# 	  0.018885, 0.016009, 0.012911, 0.006021, -0.001294, -0.005552, -0.006936, 0.002795, 0.006233, 0.000643, -0.005826, -0.005388, -0.008192, -0.016061, -0.016555, -0.016271, -0.018319, -0.012777, -0.000080, -0.004656, -0.006473, -0.003104, -0.000809, 0.000882, -0.000029
#*# 	  0.016930, 0.013722, 0.011393, 0.000573, -0.001179, 0.007008, 0.002409, 0.003258, 0.002275, 0.003181, 0.000537, -0.000805, -0.012995, -0.025142, -0.019725, -0.016741, -0.016200, -0.011761, -0.001810, -0.004099, -0.001496, 0.000720, -0.001823, -0.001691, 0.000313
#*# 	  0.015081, 0.010221, 0.005731, -0.000944, 0.007414, 0.010536, -0.000235, 0.007899, 0.009164, 0.002029, 0.006022, 0.010315, -0.006763, -0.025752, -0.016112, -0.012106, -0.010118, -0.004685, 0.001395, -0.001233, 0.001128, 0.004157, 0.005699, 0.005507, 0.014095
#*# 	  0.008794, 0.002144, -0.001345, 0.000745, 0.019781, 0.002841, -0.010096, 0.007785, 0.013747, -0.003770, -0.004015, 0.012954, 0.009572, -0.006705, -0.013981, -0.010868, -0.006221, 0.000588, 0.008115, 0.009842, 0.005733, 0.002825, 0.004639, 0.012548, 0.017173
#*# 	  0.009115, 0.012767, 0.014753, 0.014482, 0.024548, 0.009629, 0.010655, 0.017139, 0.015836, 0.007776, -0.004112, 0.005623, 0.012751, 0.005958, -0.004398, 0.001058, 0.003744, 0.005551, 0.006050, 0.012218, 0.009099, 0.003724, 0.004889, 0.012259, 0.015233
#*# 	  0.028986, 0.031384, 0.033914, 0.031433, 0.026856, 0.021345, 0.027355, 0.024013, 0.018407, 0.014310, 0.003674, 0.001566, 0.005871, 0.007432, 0.002228, 0.003740, 0.001576, 0.003033, 0.013505, 0.011769, 0.002577, 0.006033, 0.007933, 0.010249, 0.015683
#*# 	  0.037629, 0.035766, 0.032675, 0.029347, 0.026595, 0.028818, 0.030198, 0.023891, 0.017896, 0.013248, 0.003274, 0.000047, 0.003512, 0.007763, 0.001115, -0.005532, -0.009445, 0.000038, 0.013956, 0.008345, 0.002388, 0.006931, 0.007655, 0.011331, 0.012871
#*# 	  0.031955, 0.035299, 0.023233, 0.014187, 0.026709, 0.030927, 0.022584, 0.012537, -0.002665, -0.002935, -0.007536, -0.016702, -0.007303, -0.002273, -0.011759, -0.014080, -0.007229, 0.002384, 0.004061, -0.000380, -0.001505, -0.000775, 0.003645, 0.010063, 0.010844
#*# 	  0.021382, 0.032747, 0.016964, 0.011719, 0.029593, 0.034879, 0.021384, 0.005346, -0.017442, -0.008740, -0.006555, -0.022533, -0.015121, -0.004497, -0.008346, -0.010835, -0.006093, -0.003129, -0.006402, -0.004523, -0.004950, -0.005571, 0.000490, 0.006556, 0.008618
#*# 	  0.034503, 0.034708, 0.029795, 0.025405, 0.026643, 0.033492, 0.028257, 0.014731, 0.002882, 0.004306, 0.003057, -0.006888, -0.005132, 0.000653, -0.007934, -0.011614, -0.008067, -0.007559, -0.007958, -0.005009, -0.001432, -0.003060, -0.000054, 0.005384, 0.007199
#*# 	  0.031520, 0.039021, 0.036841, 0.028167, 0.023981, 0.031199, 0.030849, 0.021941, 0.011168, 0.005540, 0.007341, 0.003855, 0.003251, 0.000728, -0.013423, -0.009388, -0.004097, -0.007035, -0.010518, -0.005185, -0.001007, -0.001728, 0.001919, 0.007744, 0.013835
#*# 	  0.018267, 0.026796, 0.022124, 0.015156, 0.029356, 0.034905, 0.020586, 0.000031, -0.004820, -0.000613, -0.006679, -0.011530, -0.005910, -0.004098, -0.004008, 0.002758, -0.000506, -0.011365, -0.010189, -0.000455, 0.000151, -0.001656, 0.005704, 0.011294, 0.017132
#*# 	  0.024423, 0.024601, 0.024241, 0.016240, 0.025824, 0.034672, 0.019699, 0.001290, 0.000388, 0.001885, -0.010598, -0.014744, -0.012358, -0.002808, 0.006904, 0.011004, 0.003044, -0.004502, -0.000963, 0.006095, 0.004639, 0.002491, 0.008621, 0.014022, 0.020740
#*# 	  0.011029, 0.016390, 0.013747, 0.004299, 0.006411, 0.026868, 0.025791, 0.017793, 0.012831, 0.003967, -0.000947, -0.004238, -0.006524, -0.002310, 0.005970, 0.010206, 0.004977, 0.005434, 0.008337, 0.008097, 0.009266, 0.012267, 0.016858, 0.020908, 0.029162
#*# 	  0.014177, 0.012825, 0.012792, 0.016920, 0.020345, 0.027768, 0.027236, 0.022463, 0.016347, 0.007521, 0.005840, 0.001967, 0.001082, 0.001775, 0.007805, 0.008241, 0.005853, 0.006562, 0.005114, 0.010512, 0.017722, 0.021064, 0.021430, 0.022102, 0.023919
#*# 	  0.015965, 0.013034, 0.023567, 0.026046, 0.025429, 0.024307, 0.023867, 0.020155, 0.017514, 0.011843, 0.006600, 0.002356, 0.000299, 0.000323, 0.001122, 0.002454, 0.003530, 0.003144, 0.006252, 0.013699, 0.015381, 0.013824, 0.013092, 0.013912, 0.003447
#*# 	  0.030008, 0.030470, 0.031990, 0.027207, 0.023081, 0.018295, 0.016568, 0.012800, 0.011000, 0.006098, 0.003127, -0.002474, -0.005766, -0.006913, -0.005754, 0.000295, -0.000349, -0.004105, -0.001288, 0.000115, -0.004308, -0.003706, 0.002706, 0.009586, 0.010930
#*# 	  0.030772, 0.028615, 0.025463, 0.015392, 0.011501, 0.006949, 0.005123, 0.001335, -0.001607, -0.005042, -0.007589, -0.011312, -0.017296, -0.016470, -0.011431, -0.003577, -0.005351, -0.010560, -0.005650, -0.003170, -0.005226, -0.000289, -0.001852, -0.001585, 0.008518
#*# 	  0.021288, 0.009892, 0.006631, 0.000813, -0.001407, -0.004244, -0.004162, -0.004747, -0.006199, -0.007639, -0.008568, -0.010173, -0.012206, -0.014554, -0.011291, -0.005004, -0.006511, -0.007073, -0.001239, -0.002406, -0.004759, -0.000433, -0.001294, 0.002938, 0.011858
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.36500
