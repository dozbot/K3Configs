# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

[temperature_sensor enclosure]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.047667, -0.041143, -0.040071, -0.052275, -0.056273, -0.055996, -0.057234, -0.059162, -0.062378, -0.058048, -0.059333, -0.059874, -0.056072, -0.054234, -0.060464, -0.067019, -0.064209, -0.059747, -0.057991, -0.052285, -0.055823, -0.051945, -0.040773, -0.046345, -0.048091
#*# 	  -0.035756, -0.038954, -0.037021, -0.038159, -0.040616, -0.044314, -0.052814, -0.063791, -0.064932, -0.054601, -0.051116, -0.052554, -0.051844, -0.048246, -0.049248, -0.052913, -0.050145, -0.048154, -0.044223, -0.044265, -0.049067, -0.044742, -0.043164, -0.050196, -0.052394
#*# 	  -0.026777, -0.035039, -0.038840, -0.035956, -0.039566, -0.042450, -0.048045, -0.053402, -0.057323, -0.053230, -0.054596, -0.055813, -0.049045, -0.036266, -0.043918, -0.051053, -0.055030, -0.051709, -0.049030, -0.049223, -0.047920, -0.047166, -0.045000, -0.044035, -0.041806
#*# 	  -0.031617, -0.033353, -0.036918, -0.038964, -0.042886, -0.045393, -0.043211, -0.043713, -0.046041, -0.050864, -0.053885, -0.044063, -0.031022, -0.026419, -0.043081, -0.047035, -0.048582, -0.044260, -0.038160, -0.035830, -0.037429, -0.038166, -0.036909, -0.037305, -0.036403
#*# 	  -0.034092, -0.038334, -0.033069, -0.027232, -0.027518, -0.029421, -0.027523, -0.025437, -0.025347, -0.038611, -0.040160, -0.029137, -0.021372, -0.026524, -0.039125, -0.040803, -0.040678, -0.041416, -0.036326, -0.037826, -0.040901, -0.036663, -0.042776, -0.040208, -0.031350
#*# 	  -0.033649, -0.029940, -0.015540, -0.016917, -0.024549, -0.029454, -0.030970, -0.019869, -0.009985, -0.022162, -0.026852, -0.020023, -0.018181, -0.022152, -0.028387, -0.037224, -0.043459, -0.039230, -0.031646, -0.036731, -0.039296, -0.034161, -0.032000, -0.031451, -0.030626
#*# 	  -0.012981, -0.010873, -0.013077, -0.022810, -0.032134, -0.035234, -0.036592, -0.023148, -0.015033, -0.018887, -0.022963, -0.021778, -0.021649, -0.028541, -0.028986, -0.036688, -0.041648, -0.040007, -0.033721, -0.036059, -0.035989, -0.031554, -0.027428, -0.025074, -0.026648
#*# 	  -0.013994, -0.015018, -0.020097, -0.033251, -0.035752, -0.023300, -0.026988, -0.022622, -0.020690, -0.015754, -0.018817, -0.016994, -0.027973, -0.038890, -0.033631, -0.037661, -0.041453, -0.041942, -0.036757, -0.035702, -0.030863, -0.026887, -0.026989, -0.023248, -0.023940
#*# 	  -0.018965, -0.023085, -0.028241, -0.038062, -0.029559, -0.020014, -0.029147, -0.018840, -0.013578, -0.018609, -0.014574, -0.009301, -0.025902, -0.042448, -0.034757, -0.036657, -0.037220, -0.035944, -0.034895, -0.035842, -0.030083, -0.022820, -0.022351, -0.019231, -0.010570
#*# 	  -0.028200, -0.034993, -0.042972, -0.039069, -0.015317, -0.026370, -0.040709, -0.021369, -0.012710, -0.024996, -0.029091, -0.013337, -0.013632, -0.028603, -0.036866, -0.039627, -0.036001, -0.031276, -0.026262, -0.024336, -0.024141, -0.024187, -0.022154, -0.015304, -0.011160
#*# 	  -0.032208, -0.027461, -0.024123, -0.021008, -0.007541, -0.018544, -0.019488, -0.010624, -0.010273, -0.016716, -0.031555, -0.023045, -0.014545, -0.020337, -0.031432, -0.029366, -0.026685, -0.026398, -0.028916, -0.024662, -0.024866, -0.027613, -0.027527, -0.020773, -0.017909
#*# 	  -0.015146, -0.008218, -0.000917, -0.002507, -0.004544, -0.010333, -0.003469, -0.003362, -0.009934, -0.014852, -0.025321, -0.026559, -0.024042, -0.022168, -0.024259, -0.024191, -0.028296, -0.030569, -0.025631, -0.027149, -0.033360, -0.026300, -0.026843, -0.024439, -0.022956
#*# 	  -0.008117, -0.006482, -0.008434, -0.014277, -0.011658, -0.005859, -0.003058, -0.007613, -0.014455, -0.020207, -0.029758, -0.032820, -0.027500, -0.019544, -0.026089, -0.038504, -0.045509, -0.040500, -0.027828, -0.032285, -0.036047, -0.032039, -0.033781, -0.031759, -0.031976
#*# 	  -0.022695, -0.017368, -0.031042, -0.036801, -0.018924, -0.009769, -0.014871, -0.025283, -0.041347, -0.040130, -0.044487, -0.055366, -0.043926, -0.030317, -0.042313, -0.055665, -0.048920, -0.040663, -0.038051, -0.041787, -0.041262, -0.042703, -0.041680, -0.037527, -0.039687
#*# 	  -0.041471, -0.030326, -0.045312, -0.045432, -0.018455, -0.010156, -0.018305, -0.038657, -0.063245, -0.051813, -0.049883, -0.065906, -0.054832, -0.037730, -0.046099, -0.054762, -0.049803, -0.046724, -0.049115, -0.047372, -0.049205, -0.051908, -0.048419, -0.044259, -0.044217
#*# 	  -0.035448, -0.031816, -0.035408, -0.033347, -0.026822, -0.016540, -0.019640, -0.032555, -0.044334, -0.038857, -0.041379, -0.052515, -0.049219, -0.037334, -0.049232, -0.055447, -0.053242, -0.053667, -0.054780, -0.051404, -0.049850, -0.052349, -0.050971, -0.047624, -0.048700
#*# 	  -0.038665, -0.028848, -0.028772, -0.032402, -0.029737, -0.017551, -0.016756, -0.023458, -0.029509, -0.033502, -0.035719, -0.040261, -0.040013, -0.043008, -0.060225, -0.058386, -0.054264, -0.057782, -0.060009, -0.055603, -0.050522, -0.053157, -0.052111, -0.048103, -0.045358
#*# 	  -0.053233, -0.041754, -0.040470, -0.043087, -0.025403, -0.014586, -0.025807, -0.044713, -0.047474, -0.041058, -0.048431, -0.059007, -0.055870, -0.056541, -0.058320, -0.053390, -0.055355, -0.064361, -0.064060, -0.054292, -0.051278, -0.054736, -0.050207, -0.047055, -0.044281
#*# 	  -0.047636, -0.040422, -0.037477, -0.038884, -0.023270, -0.010130, -0.022935, -0.042199, -0.042219, -0.036066, -0.052879, -0.063837, -0.064914, -0.058652, -0.051929, -0.049439, -0.055950, -0.064239, -0.059107, -0.051283, -0.050776, -0.054291, -0.051616, -0.048336, -0.043689
#*# 	  -0.057906, -0.044585, -0.039581, -0.042707, -0.033577, -0.008209, -0.006491, -0.013234, -0.016750, -0.025310, -0.038502, -0.049550, -0.057988, -0.058644, -0.054859, -0.053194, -0.057469, -0.056804, -0.051784, -0.051311, -0.050008, -0.047662, -0.045478, -0.043953, -0.040213
#*# 	  -0.058006, -0.047183, -0.038794, -0.026957, -0.012750, 0.005204, 0.008748, 0.007076, 0.002361, -0.013734, -0.026123, -0.039337, -0.049334, -0.054382, -0.054705, -0.056093, -0.057747, -0.056280, -0.057503, -0.053799, -0.045811, -0.041567, -0.043751, -0.046014, -0.048206
#*# 	  -0.059165, -0.052885, -0.030607, -0.013871, -0.002713, 0.006979, 0.015254, 0.016543, 0.012100, -0.001947, -0.019824, -0.035752, -0.049653, -0.057750, -0.060608, -0.060733, -0.058787, -0.061825, -0.060393, -0.053725, -0.050884, -0.053101, -0.055167, -0.059274, -0.074986
#*# 	  -0.053344, -0.039043, -0.023647, -0.013237, -0.005571, 0.001142, 0.007622, 0.008324, 0.005209, -0.007119, -0.025010, -0.043938, -0.059892, -0.067858, -0.070010, -0.064380, -0.064186, -0.074026, -0.072236, -0.073191, -0.080464, -0.081794, -0.077777, -0.073693, -0.078172
#*# 	  -0.059372, -0.046758, -0.035478, -0.030028, -0.021683, -0.016880, -0.010869, -0.010466, -0.015594, -0.026431, -0.040972, -0.059092, -0.073889, -0.080284, -0.078609, -0.069745, -0.074127, -0.086281, -0.081945, -0.079858, -0.086441, -0.082952, -0.087338, -0.090144, -0.085901
#*# 	  -0.074938, -0.071991, -0.063238, -0.056399, -0.047212, -0.041672, -0.036859, -0.034814, -0.039006, -0.047531, -0.057264, -0.068550, -0.080125, -0.087706, -0.086119, -0.078488, -0.082500, -0.087248, -0.080789, -0.084273, -0.090825, -0.088936, -0.095432, -0.096316, -0.090896
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = 0.13000
