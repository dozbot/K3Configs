# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.500
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.02

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.37
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.75
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

#[temperature_sensor enclosure]
#sensor_type: ATC Semitec 104NT-4-R025H42G
#sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.014105, -0.012115, -0.013093, -0.026008, -0.031398, -0.033571, -0.035013, -0.034996, -0.034707, -0.030242, -0.032243, -0.033561, -0.030702, -0.030105, -0.032993, -0.034348, -0.030293, -0.027114, -0.022334, -0.016429, -0.019356, -0.013832, -0.005751, -0.011079, -0.010789
#*# 	  -0.005992, -0.013344, -0.011542, -0.013527, -0.020061, -0.024706, -0.033514, -0.039159, -0.039900, -0.031184, -0.029047, -0.030376, -0.028966, -0.023012, -0.023635, -0.023975, -0.022390, -0.020077, -0.014938, -0.015362, -0.018542, -0.013210, -0.014762, -0.019250, -0.018254
#*# 	  0.003330, -0.007284, -0.012583, -0.013316, -0.016833, -0.019032, -0.026234, -0.030202, -0.034380, -0.032989, -0.033829, -0.032640, -0.023330, -0.012337, -0.019217, -0.024750, -0.029562, -0.024640, -0.021340, -0.019126, -0.016048, -0.016103, -0.013825, -0.011243, -0.009019
#*# 	  -0.003128, -0.007022, -0.010019, -0.016071, -0.020751, -0.021166, -0.022128, -0.025554, -0.026790, -0.030862, -0.032763, -0.021377, -0.008398, -0.008954, -0.022986, -0.025084, -0.024386, -0.017592, -0.009201, -0.008470, -0.008942, -0.010101, -0.008626, -0.008743, -0.004827
#*# 	  -0.002917, -0.010361, -0.005842, -0.006236, -0.007218, -0.007396, -0.007017, -0.007889, -0.010080, -0.022018, -0.017777, -0.009212, -0.004993, -0.012167, -0.022214, -0.018097, -0.018645, -0.017876, -0.005830, -0.012650, -0.013308, -0.010971, -0.017769, -0.012797, -0.003988
#*# 	  -0.002231, -0.004623, 0.004685, 0.002498, -0.002471, -0.005398, -0.006518, 0.000103, 0.006537, -0.007515, -0.011099, -0.006564, -0.005828, -0.012370, -0.016327, -0.018443, -0.023597, -0.014036, -0.002847, -0.011408, -0.013830, -0.010367, -0.007614, -0.007722, -0.005047
#*# 	  0.015347, 0.011063, 0.007719, 0.000692, -0.005841, -0.010341, -0.010560, -0.000722, 0.002245, -0.002790, -0.010025, -0.010959, -0.011965, -0.018124, -0.019248, -0.019930, -0.022214, -0.016527, -0.004060, -0.009744, -0.010730, -0.008001, -0.006353, -0.005825, -0.006150
#*# 	  0.012831, 0.010726, 0.007088, -0.004846, -0.004992, 0.003295, -0.000298, -0.000700, -0.000815, -0.000070, -0.004198, -0.005438, -0.018718, -0.028833, -0.022116, -0.019966, -0.020314, -0.014399, -0.004830, -0.008260, -0.005834, -0.004369, -0.007606, -0.006748, -0.006510
#*# 	  0.012410, 0.007162, 0.001981, -0.005406, 0.003273, 0.006819, -0.003214, 0.005705, 0.006339, -0.000405, 0.003526, 0.006830, -0.013066, -0.028011, -0.018039, -0.014086, -0.013608, -0.008629, -0.002108, -0.005787, -0.003104, -0.000125, 0.000188, 0.000431, 0.008945
#*# 	  0.005325, -0.001185, -0.006666, -0.001604, 0.016334, -0.001972, -0.012684, 0.005907, 0.010517, -0.006478, -0.005362, 0.011140, 0.005415, -0.009968, -0.015808, -0.012785, -0.009340, -0.002204, 0.004672, 0.005964, 0.001720, -0.001720, 0.000800, 0.008410, 0.011992
#*# 	  0.006478, 0.010633, 0.010740, 0.013340, 0.021912, 0.007418, 0.008552, 0.014556, 0.013061, 0.005516, -0.006903, 0.003752, 0.009539, 0.001954, -0.006669, -0.001677, 0.000997, 0.002267, 0.003427, 0.008635, 0.004962, -0.000610, 0.000192, 0.007131, 0.009554
#*# 	  0.026179, 0.029393, 0.031108, 0.028883, 0.025111, 0.019628, 0.025118, 0.021386, 0.017026, 0.013067, 0.001244, -0.000152, 0.003439, 0.005082, 0.001361, 0.002835, -0.000141, 0.001054, 0.010297, 0.008324, -0.000748, 0.003087, 0.003911, 0.006464, 0.011393
#*# 	  0.036981, 0.035539, 0.032537, 0.026709, 0.026248, 0.029275, 0.029748, 0.022109, 0.016521, 0.012797, 0.001738, -0.001200, 0.003593, 0.006900, 0.000228, -0.006649, -0.010252, -0.001280, 0.011971, 0.005274, 0.000648, 0.003645, 0.004158, 0.008539, 0.008583
#*# 	  0.031195, 0.033798, 0.019675, 0.012323, 0.024467, 0.029405, 0.021332, 0.011538, -0.004021, -0.001934, -0.011471, -0.018613, -0.007552, -0.003909, -0.013794, -0.015198, -0.007966, 0.000805, 0.001109, -0.003260, -0.004831, -0.003537, 0.001949, 0.005807, 0.006067
#*# 	  0.021145, 0.030553, 0.013688, 0.009524, 0.029305, 0.033140, 0.019519, 0.000314, -0.020278, -0.008554, -0.011330, -0.025152, -0.015917, -0.007019, -0.011768, -0.013034, -0.007910, -0.005623, -0.009203, -0.008291, -0.008144, -0.008317, -0.001899, 0.003192, 0.003982
#*# 	  0.033321, 0.034391, 0.027529, 0.022151, 0.025264, 0.031881, 0.023831, 0.011269, 0.001090, 0.003624, 0.001126, -0.009334, -0.007146, -0.001801, -0.010304, -0.012869, -0.010120, -0.009924, -0.011598, -0.007517, -0.005263, -0.006215, -0.002578, 0.002230, 0.002361
#*# 	  0.030460, 0.038401, 0.033096, 0.024868, 0.022651, 0.030375, 0.027854, 0.020366, 0.009298, 0.004356, 0.004923, 0.000961, 0.001432, -0.003428, -0.015430, -0.011038, -0.006418, -0.009825, -0.013585, -0.008126, -0.004593, -0.004656, 0.000214, 0.004377, 0.008947
#*# 	  0.017593, 0.025605, 0.018533, 0.012540, 0.028503, 0.031893, 0.015772, -0.003571, -0.006938, -0.004018, -0.010716, -0.014045, -0.008525, -0.007363, -0.006398, 0.000295, -0.004039, -0.015088, -0.013833, -0.004958, -0.003134, -0.004776, 0.002606, 0.007186, 0.011378
#*# 	  0.020785, 0.020323, 0.019038, 0.010980, 0.022661, 0.030750, 0.014871, -0.003832, -0.003347, -0.002343, -0.016764, -0.018834, -0.016544, -0.006785, 0.003695, 0.008018, -0.000833, -0.008870, -0.004096, 0.001485, -0.000085, -0.001914, 0.004497, 0.008983, 0.013994
#*# 	  0.008709, 0.012091, 0.009783, 0.000552, 0.005118, 0.024168, 0.019406, 0.013102, 0.008971, 0.000093, -0.005041, -0.009917, -0.010730, -0.004507, 0.001938, 0.006256, 0.001436, 0.001318, 0.004475, 0.002854, 0.005342, 0.008224, 0.012757, 0.016057, 0.023851
#*# 	  0.009596, 0.009026, 0.008824, 0.012093, 0.016893, 0.024641, 0.021281, 0.017907, 0.010808, 0.003428, 0.001308, -0.002277, -0.003833, -0.001933, 0.004331, 0.004285, 0.002230, 0.002241, -0.000028, 0.005212, 0.013314, 0.016328, 0.016753, 0.017671, 0.018124
#*# 	  0.010971, 0.009586, 0.020373, 0.021538, 0.020736, 0.018698, 0.017802, 0.015084, 0.012441, 0.007029, 0.001224, -0.001984, -0.004447, -0.003964, -0.002291, -0.000982, -0.000085, -0.001295, 0.001894, 0.008970, 0.011893, 0.009717, 0.010213, 0.007966, -0.001352
#*# 	  0.024798, 0.025373, 0.027115, 0.021358, 0.016784, 0.013120, 0.010601, 0.007547, 0.005458, 0.001825, -0.003258, -0.006843, -0.010611, -0.011979, -0.009723, -0.003908, -0.004906, -0.008404, -0.004926, -0.004630, -0.008629, -0.008061, -0.001698, 0.004104, 0.004687
#*# 	  0.025544, 0.024100, 0.019701, 0.010513, 0.005791, 0.001006, -0.000862, -0.003794, -0.006016, -0.008736, -0.012967, -0.017443, -0.022198, -0.020805, -0.015360, -0.006182, -0.009381, -0.014269, -0.009845, -0.008212, -0.009282, -0.004123, -0.006702, -0.004225, 0.003891
#*# 	  0.013893, 0.003911, 0.000182, -0.006152, -0.007934, -0.010861, -0.012209, -0.012337, -0.012702, -0.014334, -0.015377, -0.017181, -0.019912, -0.021870, -0.017152, -0.010738, -0.013000, -0.012331, -0.006778, -0.010779, -0.010327, -0.005682, -0.007776, -0.003211, 0.005375
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.38500
