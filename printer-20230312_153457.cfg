# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

[temperature_sensor enclosure]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.061354, -0.057107, -0.055758, -0.064870, -0.069059, -0.071581, -0.073868, -0.078317, -0.080762, -0.074932, -0.072139, -0.070647, -0.069127, -0.068145, -0.071645, -0.075396, -0.070130, -0.065913, -0.061296, -0.054746, -0.057815, -0.054442, -0.045450, -0.050366, -0.050749
#*# 	  -0.049837, -0.057320, -0.057528, -0.055402, -0.059306, -0.062890, -0.071499, -0.082249, -0.083988, -0.073162, -0.069726, -0.071249, -0.071434, -0.065974, -0.065725, -0.067184, -0.064341, -0.062162, -0.056012, -0.056138, -0.059030, -0.054955, -0.055426, -0.058178, -0.055006
#*# 	  -0.044148, -0.049518, -0.056059, -0.054409, -0.059347, -0.063417, -0.067886, -0.071182, -0.075673, -0.073604, -0.074702, -0.074805, -0.066942, -0.054865, -0.060805, -0.067298, -0.070635, -0.065956, -0.059884, -0.057365, -0.054951, -0.055869, -0.052029, -0.049331, -0.044053
#*# 	  -0.048028, -0.052514, -0.054407, -0.055762, -0.060023, -0.062868, -0.060569, -0.061060, -0.064426, -0.071753, -0.073666, -0.064050, -0.050581, -0.050714, -0.063405, -0.063573, -0.061993, -0.058525, -0.048839, -0.047133, -0.048857, -0.048408, -0.049844, -0.046793, -0.038868
#*# 	  -0.049385, -0.053994, -0.046615, -0.039865, -0.042711, -0.045647, -0.044836, -0.043826, -0.042356, -0.055458, -0.059266, -0.051328, -0.046645, -0.051099, -0.060224, -0.058322, -0.057135, -0.056265, -0.048078, -0.048955, -0.052803, -0.048826, -0.054146, -0.048443, -0.037514
#*# 	  -0.042907, -0.042220, -0.030594, -0.033039, -0.043240, -0.047495, -0.051682, -0.041924, -0.032165, -0.044815, -0.050671, -0.046991, -0.045767, -0.051299, -0.052873, -0.054460, -0.059045, -0.052773, -0.044248, -0.046855, -0.050407, -0.047006, -0.043436, -0.039145, -0.034124
#*# 	  -0.024499, -0.023425, -0.027028, -0.036531, -0.047447, -0.049458, -0.051446, -0.044455, -0.039326, -0.040539, -0.046753, -0.048083, -0.050488, -0.058677, -0.055081, -0.055183, -0.057621, -0.054737, -0.044570, -0.044743, -0.047580, -0.044539, -0.040581, -0.034968, -0.033603
#*# 	  -0.024798, -0.027743, -0.032087, -0.045829, -0.049256, -0.036000, -0.042069, -0.042214, -0.041295, -0.040201, -0.041403, -0.040838, -0.054679, -0.066976, -0.055869, -0.053027, -0.051865, -0.050799, -0.044231, -0.044514, -0.041668, -0.038881, -0.040084, -0.036214, -0.028294
#*# 	  -0.028524, -0.033363, -0.039677, -0.047638, -0.037814, -0.032826, -0.046781, -0.037946, -0.032340, -0.042402, -0.038108, -0.031080, -0.044532, -0.062922, -0.052970, -0.050770, -0.048954, -0.043796, -0.037451, -0.037252, -0.033245, -0.030561, -0.027316, -0.025707, -0.013946
#*# 	  -0.033987, -0.042000, -0.048047, -0.046980, -0.024523, -0.036643, -0.050343, -0.036216, -0.027691, -0.040725, -0.047825, -0.031808, -0.028136, -0.041856, -0.049577, -0.046346, -0.041167, -0.034962, -0.028797, -0.026441, -0.026572, -0.028833, -0.031039, -0.019046, -0.013127
#*# 	  -0.033250, -0.026065, -0.022740, -0.020796, -0.012830, -0.025845, -0.025066, -0.019799, -0.022463, -0.026939, -0.040293, -0.035039, -0.029385, -0.032797, -0.037927, -0.033069, -0.030928, -0.028973, -0.029051, -0.026372, -0.023986, -0.025517, -0.025407, -0.017857, -0.012179
#*# 	  -0.011339, -0.005832, -0.002667, -0.006428, -0.010545, -0.015477, -0.010837, -0.012661, -0.018797, -0.022828, -0.031669, -0.032885, -0.030999, -0.027783, -0.029403, -0.028187, -0.032230, -0.033486, -0.021829, -0.022746, -0.030666, -0.023607, -0.022592, -0.017573, -0.010038
#*# 	  -0.004594, -0.003963, -0.009944, -0.015641, -0.013821, -0.008387, -0.007600, -0.013677, -0.020950, -0.026745, -0.030511, -0.034976, -0.029443, -0.022677, -0.027898, -0.039005, -0.043543, -0.035270, -0.021768, -0.023315, -0.024554, -0.020521, -0.018500, -0.014383, -0.010471
#*# 	  -0.016810, -0.012777, -0.029407, -0.036658, -0.017404, -0.008567, -0.017086, -0.027818, -0.046345, -0.044501, -0.041303, -0.055111, -0.043481, -0.030740, -0.039476, -0.049518, -0.041149, -0.032371, -0.029264, -0.030773, -0.028518, -0.028069, -0.024089, -0.014150, -0.012375
#*# 	  -0.031400, -0.018740, -0.030301, -0.033993, -0.014924, -0.007654, -0.017638, -0.033002, -0.055828, -0.046622, -0.040033, -0.055953, -0.048349, -0.032854, -0.037591, -0.043074, -0.039816, -0.036395, -0.036146, -0.031988, -0.030687, -0.032772, -0.026034, -0.017230, -0.014303
#*# 	  -0.016775, -0.016207, -0.021079, -0.024078, -0.022287, -0.013011, -0.013977, -0.023023, -0.033786, -0.030875, -0.030918, -0.037558, -0.036803, -0.029035, -0.039124, -0.043793, -0.040505, -0.038803, -0.039469, -0.034143, -0.026401, -0.028944, -0.025502, -0.017526, -0.013320
#*# 	  -0.022072, -0.013741, -0.014692, -0.019786, -0.020094, -0.010502, -0.010300, -0.019055, -0.026970, -0.029222, -0.026013, -0.030809, -0.029812, -0.034843, -0.047693, -0.042358, -0.037441, -0.039998, -0.041089, -0.032117, -0.024988, -0.026753, -0.022475, -0.013731, -0.007102
#*# 	  -0.026079, -0.021390, -0.023469, -0.028562, -0.016284, -0.006689, -0.021254, -0.043320, -0.047148, -0.036561, -0.041411, -0.050054, -0.045556, -0.041409, -0.039246, -0.030977, -0.034868, -0.044283, -0.040001, -0.028740, -0.025837, -0.029346, -0.021621, -0.012473, -0.004310
#*# 	  -0.023833, -0.019568, -0.018868, -0.027159, -0.021780, -0.008730, -0.021505, -0.039220, -0.040343, -0.034710, -0.045254, -0.052879, -0.050936, -0.042624, -0.034101, -0.027469, -0.034219, -0.038567, -0.032735, -0.024770, -0.024619, -0.025934, -0.019453, -0.010278, -0.001315
#*# 	  -0.033526, -0.026131, -0.026718, -0.033182, -0.033027, -0.014427, -0.016084, -0.024100, -0.028994, -0.036888, -0.038632, -0.040335, -0.042373, -0.039946, -0.033113, -0.028070, -0.030264, -0.027972, -0.022438, -0.021927, -0.018853, -0.014859, -0.009718, -0.002357, 0.006077
#*# 	  -0.031543, -0.030687, -0.027795, -0.021781, -0.016946, -0.012220, -0.011981, -0.018519, -0.024299, -0.031976, -0.033907, -0.036522, -0.037383, -0.035474, -0.030850, -0.028436, -0.026798, -0.026581, -0.024884, -0.017115, -0.007604, -0.004783, -0.003792, -0.002524, -0.001286
#*# 	  -0.032868, -0.033947, -0.022006, -0.016731, -0.017021, -0.018738, -0.020551, -0.025016, -0.027874, -0.034200, -0.037472, -0.039234, -0.040254, -0.040155, -0.037116, -0.030435, -0.026804, -0.027711, -0.023968, -0.017778, -0.016335, -0.018635, -0.018933, -0.015325, -0.023739
#*# 	  -0.025017, -0.020366, -0.017138, -0.019374, -0.022729, -0.026977, -0.028712, -0.033185, -0.036902, -0.039719, -0.041574, -0.044078, -0.048966, -0.048257, -0.043276, -0.031640, -0.031211, -0.039419, -0.035028, -0.034765, -0.038227, -0.037441, -0.031531, -0.023300, -0.019540
#*# 	  -0.028931, -0.026983, -0.026967, -0.033415, -0.037742, -0.040683, -0.042257, -0.044027, -0.047842, -0.050071, -0.051416, -0.054162, -0.058758, -0.055516, -0.047681, -0.034987, -0.035709, -0.044985, -0.038990, -0.034757, -0.037815, -0.034837, -0.036823, -0.036513, -0.027299
#*# 	  -0.037231, -0.043542, -0.043741, -0.046476, -0.048221, -0.049373, -0.050323, -0.049037, -0.049880, -0.050922, -0.050910, -0.050461, -0.052781, -0.054973, -0.050774, -0.041422, -0.043131, -0.044805, -0.035519, -0.037690, -0.041687, -0.038108, -0.038140, -0.032638, -0.027274
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.12500
