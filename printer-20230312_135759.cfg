# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

[temperature_sensor enclosure]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.025459, -0.020085, -0.019324, -0.030999, -0.034814, -0.035410, -0.038647, -0.043519, -0.045190, -0.038116, -0.036914, -0.036423, -0.034751, -0.035270, -0.041580, -0.044458, -0.041137, -0.037383, -0.032154, -0.026509, -0.030497, -0.024629, -0.015301, -0.022095, -0.022092
#*# 	  -0.012602, -0.019724, -0.019667, -0.019845, -0.023392, -0.026579, -0.036914, -0.049167, -0.049308, -0.036426, -0.032946, -0.035485, -0.035147, -0.031640, -0.032475, -0.034736, -0.032861, -0.030242, -0.025402, -0.027294, -0.030249, -0.023392, -0.024137, -0.028555, -0.028796
#*# 	  -0.005452, -0.013127, -0.019713, -0.018225, -0.022305, -0.026128, -0.032274, -0.037085, -0.041585, -0.037636, -0.038581, -0.039020, -0.032031, -0.021086, -0.028015, -0.036374, -0.040797, -0.035631, -0.030678, -0.030083, -0.027449, -0.027016, -0.021795, -0.019182, -0.017416
#*# 	  -0.009455, -0.014106, -0.016845, -0.019203, -0.024050, -0.026784, -0.023994, -0.025135, -0.029102, -0.035329, -0.037472, -0.028548, -0.015128, -0.015439, -0.030202, -0.032172, -0.031599, -0.027259, -0.018483, -0.017783, -0.020077, -0.018157, -0.018892, -0.018208, -0.014283
#*# 	  -0.009506, -0.015636, -0.008141, -0.004155, -0.005634, -0.008147, -0.007213, -0.005989, -0.006561, -0.021062, -0.022345, -0.014911, -0.010969, -0.017073, -0.028671, -0.026986, -0.026681, -0.025308, -0.017650, -0.020869, -0.022831, -0.017630, -0.023134, -0.020341, -0.013036
#*# 	  -0.006221, -0.005632, 0.007562, 0.005234, -0.005656, -0.011056, -0.014155, -0.004375, 0.004276, -0.009023, -0.014587, -0.011759, -0.012744, -0.018130, -0.021783, -0.026131, -0.029356, -0.023358, -0.014334, -0.019543, -0.021862, -0.018257, -0.014564, -0.014198, -0.013392
#*# 	  0.015567, 0.014053, 0.011619, -0.000159, -0.010351, -0.014213, -0.015905, -0.006458, -0.001232, -0.004534, -0.010796, -0.013214, -0.016282, -0.025771, -0.023444, -0.026528, -0.027858, -0.024788, -0.014350, -0.017542, -0.017889, -0.015281, -0.011753, -0.010716, -0.012747
#*# 	  0.014800, 0.011164, 0.005942, -0.010235, -0.010915, 0.000528, -0.005448, -0.005141, -0.005156, -0.003489, -0.006148, -0.006621, -0.023175, -0.033752, -0.025094, -0.025131, -0.024256, -0.022481, -0.016080, -0.017647, -0.013396, -0.010657, -0.014002, -0.013049, -0.010076
#*# 	  0.011828, 0.006499, -0.000916, -0.011308, -0.000761, 0.004353, -0.009234, -0.000809, 0.003755, -0.004880, -0.001058, 0.004122, -0.012991, -0.030805, -0.021038, -0.020945, -0.019987, -0.013923, -0.008847, -0.009928, -0.006168, -0.003646, -0.004085, -0.004024, 0.004275
#*# 	  0.005021, -0.003931, -0.010774, -0.008696, 0.014199, 0.000326, -0.014787, 0.001532, 0.008329, -0.005623, -0.012785, 0.003745, 0.005205, -0.009327, -0.019257, -0.018224, -0.013639, -0.006701, 0.000302, 0.002230, 0.000484, -0.003360, -0.004961, -0.000058, 0.005350
#*# 	  0.005830, 0.011002, 0.013587, 0.015430, 0.024719, 0.009699, 0.010064, 0.016434, 0.013698, 0.008064, -0.007615, -0.000323, 0.005105, 0.000463, -0.006823, -0.002714, -0.000654, 0.002113, 0.001039, 0.004177, 0.004227, 0.001335, -0.000055, 0.004049, 0.005216
#*# 	  0.027230, 0.034418, 0.037632, 0.032991, 0.027876, 0.023569, 0.028849, 0.025514, 0.018866, 0.015396, 0.004790, 0.000692, 0.002926, 0.005583, 0.002976, 0.002347, -0.002675, -0.003319, 0.007823, 0.004599, -0.002427, 0.005342, 0.003044, 0.004356, 0.007001
#*# 	  0.038759, 0.036689, 0.031289, 0.023823, 0.025320, 0.030525, 0.031832, 0.024454, 0.017734, 0.010054, 0.002816, -0.001630, 0.003696, 0.011425, 0.003310, -0.008577, -0.013447, -0.004440, 0.009407, 0.005727, 0.001954, 0.005727, 0.005571, 0.006246, 0.007028
#*# 	  0.026920, 0.029177, 0.011270, 0.004799, 0.024712, 0.031979, 0.022681, 0.010493, -0.008899, -0.006042, -0.005932, -0.020763, -0.008064, 0.003025, -0.007851, -0.020329, -0.012621, -0.001861, 0.001643, -0.001136, -0.000441, -0.001851, 0.000399, 0.004280, 0.002624
#*# 	  0.011114, 0.021460, 0.006066, 0.003107, 0.024563, 0.031454, 0.020048, 0.002644, -0.020741, -0.010432, -0.005993, -0.022084, -0.014574, 0.000727, -0.007426, -0.014354, -0.010271, -0.006515, -0.005121, -0.003243, -0.002526, -0.006316, -0.000660, 0.002741, 0.002582
#*# 	  0.023042, 0.022858, 0.017711, 0.015983, 0.019485, 0.028428, 0.023266, 0.012371, 0.001600, 0.004247, 0.003471, -0.005862, -0.003971, 0.003159, -0.008295, -0.013566, -0.011035, -0.008762, -0.008349, -0.005258, -0.002351, -0.003507, -0.002620, 0.000760, 0.000942
#*# 	  0.019051, 0.026086, 0.022825, 0.016221, 0.017400, 0.027655, 0.026370, 0.018452, 0.010969, 0.007094, 0.008767, 0.004528, 0.002957, -0.002444, -0.016955, -0.010852, -0.007937, -0.008122, -0.009641, -0.004519, 0.002367, -0.000834, 0.000625, 0.003627, 0.007730
#*# 	  0.009967, 0.016088, 0.012408, 0.007078, 0.021310, 0.030461, 0.013668, -0.009929, -0.012054, -0.002364, -0.008813, -0.017836, -0.012331, -0.009202, -0.008368, -0.000689, -0.005697, -0.013006, -0.010625, -0.000064, 0.002228, -0.001924, 0.003394, 0.006320, 0.010986
#*# 	  0.013130, 0.015916, 0.016469, 0.006885, 0.017861, 0.027236, 0.010970, -0.008682, -0.008980, -0.001799, -0.013841, -0.022182, -0.020428, -0.011479, -0.001130, 0.003582, -0.004371, -0.007422, -0.000780, 0.005724, 0.004375, 0.001405, 0.005877, 0.008860, 0.015145
#*# 	  0.003304, 0.012397, 0.009691, 0.001207, 0.003180, 0.019734, 0.018343, 0.008869, 0.004581, -0.002854, -0.006565, -0.010215, -0.011350, -0.007874, -0.000683, 0.003395, -0.000321, 0.004063, 0.008002, 0.007278, 0.009316, 0.012610, 0.014403, 0.015514, 0.022111
#*# 	  0.003924, 0.005277, 0.007481, 0.012022, 0.017507, 0.023662, 0.020698, 0.014290, 0.008379, -0.000257, -0.001399, -0.003780, -0.004723, -0.002429, 0.002143, 0.004129, 0.004715, 0.007148, 0.007756, 0.011188, 0.019531, 0.022762, 0.021159, 0.018221, 0.013935
#*# 	  0.002758, 0.001956, 0.013669, 0.019101, 0.018579, 0.017386, 0.014618, 0.010056, 0.005780, -0.000161, -0.004729, -0.007215, -0.008086, -0.006814, -0.003252, 0.001956, 0.005878, 0.004410, 0.007772, 0.013250, 0.013484, 0.011330, 0.008814, 0.008000, -0.006585
#*# 	  0.010267, 0.014870, 0.018867, 0.015997, 0.012920, 0.007955, 0.005434, -0.000732, -0.002891, -0.006704, -0.009835, -0.013012, -0.016460, -0.015228, -0.010018, 0.000927, 0.003338, -0.005036, -0.002359, -0.002506, -0.011520, -0.010661, -0.005049, -0.001092, -0.001583
#*# 	  0.006693, 0.009274, 0.009488, 0.001482, -0.002721, -0.007334, -0.008448, -0.011956, -0.015639, -0.018207, -0.019293, -0.022498, -0.026720, -0.022964, -0.015446, -0.001960, -0.003544, -0.013307, -0.006972, -0.003739, -0.009098, -0.005424, -0.009796, -0.013417, -0.007558
#*# 	  -0.001695, -0.008643, -0.010502, -0.014621, -0.015556, -0.018284, -0.018111, -0.018411, -0.019558, -0.020189, -0.019958, -0.020884, -0.023170, -0.024691, -0.018038, -0.009575, -0.011126, -0.013467, -0.004475, -0.006434, -0.011887, -0.008672, -0.010431, -0.009736, -0.004595
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.12000
