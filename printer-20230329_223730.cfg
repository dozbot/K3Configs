# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

#[temperature_sensor enclosure]
#sensor_type: ATC Semitec 104NT-4-R025H42G
#sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.090305, -0.086745, -0.085912, -0.100469, -0.107936, -0.105434, -0.105259, -0.106341, -0.107400, -0.105208, -0.106821, -0.106571, -0.102888, -0.103303, -0.108743, -0.113408, -0.109912, -0.105058, -0.102495, -0.093447, -0.095331, -0.092150, -0.080730, -0.084477, -0.087338
#*# 	  -0.079466, -0.084833, -0.083318, -0.086344, -0.090293, -0.094709, -0.103810, -0.114849, -0.115733, -0.105010, -0.100121, -0.100877, -0.100924, -0.098820, -0.099921, -0.100729, -0.097329, -0.096071, -0.090748, -0.088476, -0.093293, -0.087291, -0.087091, -0.093966, -0.093394
#*# 	  -0.067620, -0.078678, -0.084462, -0.081468, -0.085859, -0.091580, -0.099033, -0.105951, -0.110732, -0.104896, -0.103848, -0.105922, -0.100815, -0.087999, -0.093177, -0.099985, -0.103128, -0.100309, -0.096840, -0.095742, -0.094196, -0.091620, -0.091482, -0.088855, -0.086302
#*# 	  -0.071585, -0.075826, -0.079274, -0.083152, -0.090659, -0.095319, -0.095286, -0.096948, -0.099186, -0.102368, -0.105592, -0.098048, -0.083024, -0.077936, -0.093024, -0.097024, -0.099448, -0.094615, -0.086851, -0.082016, -0.082812, -0.084976, -0.082691, -0.082670, -0.081425
#*# 	  -0.070879, -0.081650, -0.078902, -0.073891, -0.076267, -0.078933, -0.077946, -0.079294, -0.081290, -0.093337, -0.092337, -0.080619, -0.071494, -0.076360, -0.090575, -0.088752, -0.088064, -0.090597, -0.084056, -0.084586, -0.086804, -0.084062, -0.091994, -0.087809, -0.078454
#*# 	  -0.074435, -0.075350, -0.061605, -0.062168, -0.069246, -0.074440, -0.078598, -0.070706, -0.061206, -0.074083, -0.078046, -0.069953, -0.066641, -0.070559, -0.077532, -0.084109, -0.091296, -0.086418, -0.078128, -0.081771, -0.087240, -0.083465, -0.082748, -0.082862, -0.080611
#*# 	  -0.052964, -0.052808, -0.055777, -0.065966, -0.078113, -0.082939, -0.087140, -0.075368, -0.066460, -0.071489, -0.075256, -0.072194, -0.067874, -0.073310, -0.075334, -0.080314, -0.087276, -0.086514, -0.079587, -0.083362, -0.085121, -0.083270, -0.080938, -0.079329, -0.080324
#*# 	  -0.049606, -0.054604, -0.059913, -0.073341, -0.079335, -0.070648, -0.075102, -0.073339, -0.071627, -0.066427, -0.067881, -0.064570, -0.071396, -0.081919, -0.077165, -0.080448, -0.085977, -0.086217, -0.080176, -0.079853, -0.078972, -0.078474, -0.080860, -0.079879, -0.081231
#*# 	  -0.051520, -0.058439, -0.065827, -0.079203, -0.073653, -0.065479, -0.074603, -0.068161, -0.064133, -0.068384, -0.062481, -0.055064, -0.070198, -0.087207, -0.076368, -0.077319, -0.080001, -0.078821, -0.077077, -0.079631, -0.075780, -0.073250, -0.076155, -0.076434, -0.068557
#*# 	  -0.057863, -0.069236, -0.077903, -0.078299, -0.053911, -0.066762, -0.084716, -0.068952, -0.058075, -0.073983, -0.073443, -0.056111, -0.056263, -0.073157, -0.078907, -0.079945, -0.078582, -0.073020, -0.067759, -0.067000, -0.069300, -0.071420, -0.072922, -0.067638, -0.063754
#*# 	  -0.063819, -0.064275, -0.062913, -0.061372, -0.046511, -0.062332, -0.066568, -0.054040, -0.055118, -0.063065, -0.077339, -0.065212, -0.057002, -0.062769, -0.073773, -0.070123, -0.067573, -0.067044, -0.068201, -0.065885, -0.066231, -0.070968, -0.075646, -0.068480, -0.065973
#*# 	  -0.045291, -0.037135, -0.033966, -0.036508, -0.039971, -0.049547, -0.043171, -0.044410, -0.050910, -0.054833, -0.067309, -0.068823, -0.065674, -0.063716, -0.066030, -0.063974, -0.067120, -0.068065, -0.063464, -0.064954, -0.072213, -0.067511, -0.068234, -0.066947, -0.064599
#*# 	  -0.031020, -0.032012, -0.034969, -0.042327, -0.043694, -0.040582, -0.038761, -0.045019, -0.051001, -0.057223, -0.067464, -0.070089, -0.065960, -0.059070, -0.065902, -0.074786, -0.082178, -0.077058, -0.062708, -0.067619, -0.072650, -0.068072, -0.070913, -0.067922, -0.066294
#*# 	  -0.040845, -0.040618, -0.052743, -0.061283, -0.047914, -0.040500, -0.045443, -0.057011, -0.071672, -0.072002, -0.078292, -0.088594, -0.078029, -0.069082, -0.079378, -0.089671, -0.082176, -0.072950, -0.070526, -0.074091, -0.074575, -0.075625, -0.073802, -0.068427, -0.069616
#*# 	  -0.058767, -0.048446, -0.067819, -0.073334, -0.048109, -0.039780, -0.050567, -0.070070, -0.095707, -0.083499, -0.081892, -0.098052, -0.088227, -0.071721, -0.080277, -0.085711, -0.080573, -0.076444, -0.079100, -0.078449, -0.079754, -0.081868, -0.077586, -0.071009, -0.070462
#*# 	  -0.050239, -0.049683, -0.056394, -0.056949, -0.049307, -0.040494, -0.046651, -0.059820, -0.073771, -0.067040, -0.069725, -0.081869, -0.078773, -0.067814, -0.076486, -0.081978, -0.080143, -0.079821, -0.081804, -0.078030, -0.076552, -0.079011, -0.077337, -0.071839, -0.071341
#*# 	  -0.047069, -0.043540, -0.045478, -0.053534, -0.056455, -0.043759, -0.043637, -0.050108, -0.056834, -0.061299, -0.062393, -0.065898, -0.064829, -0.069267, -0.085550, -0.083278, -0.077606, -0.080784, -0.084189, -0.078647, -0.074551, -0.077044, -0.075352, -0.070195, -0.067205
#*# 	  -0.060171, -0.051468, -0.056098, -0.062625, -0.048696, -0.039692, -0.052431, -0.070173, -0.074156, -0.068667, -0.072872, -0.079830, -0.076779, -0.077951, -0.079566, -0.071936, -0.075807, -0.084758, -0.083527, -0.074588, -0.072295, -0.076139, -0.070714, -0.066216, -0.061696
#*# 	  -0.052440, -0.053122, -0.052679, -0.060876, -0.046140, -0.039417, -0.057733, -0.079371, -0.079184, -0.069645, -0.082985, -0.091037, -0.086035, -0.076646, -0.068796, -0.063608, -0.073541, -0.079919, -0.074417, -0.066588, -0.068069, -0.072986, -0.068923, -0.064724, -0.058228
#*# 	  -0.064122, -0.057081, -0.058923, -0.068224, -0.064617, -0.044709, -0.050860, -0.060955, -0.063434, -0.068230, -0.076287, -0.080698, -0.083706, -0.076799, -0.069268, -0.065039, -0.069524, -0.068777, -0.062718, -0.063585, -0.064262, -0.063457, -0.061185, -0.058018, -0.050362
#*# 	  -0.062854, -0.061291, -0.061867, -0.058391, -0.053351, -0.043214, -0.046730, -0.053398, -0.058993, -0.070209, -0.070396, -0.072920, -0.073341, -0.072402, -0.067284, -0.065266, -0.067165, -0.064302, -0.065512, -0.062424, -0.054773, -0.052320, -0.053881, -0.053130, -0.053591
#*# 	  -0.065226, -0.065980, -0.053748, -0.046258, -0.044742, -0.045090, -0.047640, -0.052868, -0.056832, -0.063801, -0.067954, -0.071677, -0.072769, -0.072494, -0.069643, -0.066193, -0.063514, -0.065576, -0.063017, -0.056099, -0.053006, -0.054542, -0.057028, -0.059337, -0.073455
#*# 	  -0.053327, -0.051095, -0.044035, -0.044883, -0.048438, -0.052476, -0.056489, -0.060691, -0.064338, -0.067878, -0.072418, -0.077071, -0.078863, -0.079871, -0.076431, -0.066195, -0.066283, -0.072088, -0.069750, -0.070573, -0.077393, -0.079889, -0.074449, -0.069261, -0.072129
#*# 	  -0.053785, -0.051188, -0.049687, -0.055283, -0.060401, -0.064172, -0.067332, -0.070462, -0.074655, -0.077155, -0.079854, -0.085531, -0.089646, -0.086514, -0.081128, -0.068340, -0.072239, -0.083172, -0.077297, -0.076043, -0.080490, -0.076821, -0.078138, -0.078597, -0.072308
#*# 	  -0.061679, -0.067065, -0.068067, -0.072916, -0.074880, -0.077894, -0.079616, -0.079371, -0.081303, -0.082522, -0.083627, -0.086055, -0.089139, -0.089949, -0.085100, -0.073944, -0.077782, -0.081849, -0.073595, -0.075307, -0.078951, -0.074796, -0.080306, -0.079295, -0.071670
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.18000
