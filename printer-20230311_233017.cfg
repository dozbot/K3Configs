# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

[temperature_sensor enclosure]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.028734, -0.021360, -0.019366, -0.031949, -0.039368, -0.037498, -0.036871, -0.036800, -0.038161, -0.035504, -0.035611, -0.037286, -0.033686, -0.033737, -0.039653, -0.046361, -0.046390, -0.040377, -0.037556, -0.032347, -0.034691, -0.034121, -0.022626, -0.027273, -0.033064
#*# 	  -0.018239, -0.020341, -0.016826, -0.017969, -0.022511, -0.025974, -0.032377, -0.045216, -0.046380, -0.035555, -0.029658, -0.032403, -0.032740, -0.030362, -0.032400, -0.035836, -0.033591, -0.031777, -0.026427, -0.026954, -0.032483, -0.028489, -0.027422, -0.034324, -0.038357
#*# 	  -0.004885, -0.013144, -0.019278, -0.014070, -0.017576, -0.021023, -0.028443, -0.035253, -0.040919, -0.035615, -0.034401, -0.036987, -0.033509, -0.022946, -0.027043, -0.033768, -0.037699, -0.035370, -0.031881, -0.032912, -0.033640, -0.032735, -0.033350, -0.033593, -0.032201
#*# 	  -0.008179, -0.009304, -0.013048, -0.015864, -0.021235, -0.024656, -0.023665, -0.024882, -0.028964, -0.031702, -0.035314, -0.030890, -0.018344, -0.012158, -0.025865, -0.031323, -0.033699, -0.028601, -0.022394, -0.019528, -0.021851, -0.024317, -0.023498, -0.024356, -0.024809
#*# 	  -0.006754, -0.013866, -0.010332, -0.004810, -0.006025, -0.008704, -0.006362, -0.006767, -0.009593, -0.022742, -0.024564, -0.015908, -0.009502, -0.014184, -0.026381, -0.025211, -0.022814, -0.023608, -0.017364, -0.018940, -0.023966, -0.021958, -0.031182, -0.028875, -0.021011
#*# 	  -0.008577, -0.008276, 0.007826, 0.009483, 0.000645, -0.003731, -0.006494, -0.000709, 0.009000, -0.004370, -0.011087, -0.008261, -0.008105, -0.012276, -0.018806, -0.022780, -0.027568, -0.021437, -0.013659, -0.017940, -0.024063, -0.021285, -0.022279, -0.023430, -0.022343
#*# 	  0.013290, 0.014403, 0.015017, 0.006400, -0.005689, -0.011022, -0.014065, -0.004676, 0.003087, -0.002285, -0.009772, -0.009757, -0.012644, -0.019328, -0.020372, -0.021519, -0.025127, -0.022279, -0.013774, -0.017546, -0.021115, -0.020697, -0.019261, -0.018992, -0.020631
#*# 	  0.018008, 0.015864, 0.011396, -0.000164, -0.006112, 0.002172, -0.001411, -0.001285, -0.001244, 0.000823, -0.003463, -0.006107, -0.016889, -0.028163, -0.021576, -0.023226, -0.023162, -0.022246, -0.014045, -0.015575, -0.015516, -0.014811, -0.018311, -0.018223, -0.020658
#*# 	  0.015725, 0.011526, 0.004994, -0.006920, -0.003064, 0.007575, -0.001289, 0.002271, 0.005972, -0.001250, 0.002606, 0.005478, -0.012612, -0.031202, -0.019778, -0.017135, -0.017598, -0.013988, -0.011749, -0.014170, -0.011739, -0.009855, -0.013267, -0.015044, -0.006634
#*# 	  0.010760, 0.000714, -0.007087, -0.007350, 0.014559, 0.006851, -0.010537, 0.001709, 0.012389, -0.002299, -0.004887, 0.007913, 0.004936, -0.012141, -0.016670, -0.016782, -0.014589, -0.007205, -0.000696, 0.000040, -0.003106, -0.006219, -0.008220, -0.005981, -0.002086
#*# 	  0.005593, 0.006854, 0.008510, 0.008462, 0.025652, 0.012718, 0.007752, 0.016659, 0.016508, 0.009576, -0.005524, 0.004239, 0.011067, 0.004086, -0.006292, -0.003048, -0.000468, 0.001573, 0.000702, 0.002547, 0.002161, -0.004745, -0.010068, -0.004841, -0.003143
#*# 	  0.024161, 0.032019, 0.037099, 0.035941, 0.033536, 0.024139, 0.029759, 0.028634, 0.021332, 0.018084, 0.005475, 0.003375, 0.003722, 0.006342, 0.004246, 0.006527, 0.002709, 0.000781, 0.005548, 0.003729, -0.004369, 0.000031, -0.002328, -0.002971, -0.001150
#*# 	  0.038856, 0.039215, 0.036486, 0.030706, 0.029811, 0.034593, 0.035734, 0.028953, 0.021741, 0.015357, 0.006587, 0.002702, 0.006359, 0.013277, 0.009045, -0.000884, -0.010492, -0.006690, 0.006465, 0.000812, -0.004591, 0.000628, -0.002699, -0.002449, -0.001063
#*# 	  0.029159, 0.031436, 0.020943, 0.011185, 0.025494, 0.033736, 0.029392, 0.018493, 0.002450, -0.000296, -0.001824, -0.014182, -0.005357, 0.006166, -0.004113, -0.016731, -0.014478, -0.004249, -0.000532, -0.005275, -0.005826, -0.006734, -0.006818, -0.003460, -0.004831
#*# 	  0.010953, 0.023165, 0.006167, 0.000225, 0.027558, 0.035149, 0.023773, 0.006124, -0.020149, -0.013549, -0.006316, -0.025318, -0.014425, 0.003427, -0.004332, -0.013976, -0.010304, -0.006575, -0.008991, -0.009899, -0.012214, -0.014982, -0.010870, -0.006782, -0.006503
#*# 	  0.019152, 0.021121, 0.016481, 0.015037, 0.022208, 0.032288, 0.027041, 0.012809, -0.003640, 0.000721, 0.002014, -0.009481, -0.009419, 0.004658, -0.003599, -0.011739, -0.012148, -0.011196, -0.013270, -0.011060, -0.010918, -0.013056, -0.011948, -0.008572, -0.009022
#*# 	  0.021782, 0.026676, 0.024623, 0.019651, 0.017205, 0.026384, 0.030726, 0.022614, 0.014197, 0.010086, 0.009870, 0.004894, 0.006262, 0.003002, -0.014643, -0.013524, -0.010038, -0.012531, -0.015081, -0.012460, -0.007919, -0.009997, -0.010045, -0.006610, -0.002617
#*# 	  0.008985, 0.017304, 0.015561, 0.010184, 0.021729, 0.032562, 0.021874, 0.002471, -0.003812, 0.000940, 0.000200, -0.008395, -0.006600, -0.007681, -0.010822, -0.004035, -0.007894, -0.016904, -0.017126, -0.009001, -0.007080, -0.011499, -0.008236, -0.004022, -0.000078
#*# 	  0.014813, 0.017148, 0.016679, 0.010133, 0.021523, 0.032028, 0.014069, -0.009607, -0.011210, -0.001714, -0.012716, -0.021926, -0.017125, -0.009335, -0.001264, 0.002066, -0.005507, -0.015110, -0.011184, -0.004447, -0.004307, -0.009459, -0.006181, -0.003947, 0.002346
#*# 	  0.004371, 0.009916, 0.011014, 0.000880, 0.001723, 0.022898, 0.019337, 0.007768, 0.003627, 0.000421, -0.007261, -0.011707, -0.014803, -0.010329, -0.002297, 0.002208, -0.004010, -0.004864, 0.000723, 0.000228, -0.000742, -0.001878, 0.000608, 0.001938, 0.007857
#*# 	  0.002670, 0.005752, 0.006148, 0.007849, 0.013109, 0.022942, 0.022147, 0.014202, 0.007088, -0.002422, -0.002876, -0.004132, -0.007251, -0.005450, -0.000376, -0.000018, -0.002092, 0.000544, -0.001469, -0.000284, 0.006384, 0.009380, 0.006981, 0.006190, 0.007224
#*# 	  0.000132, -0.002264, 0.009754, 0.016968, 0.017610, 0.018820, 0.017371, 0.012232, 0.006600, 0.001527, -0.002462, -0.006410, -0.008267, -0.008045, -0.005634, -0.003325, -0.001271, -0.002644, -0.001531, 0.003895, 0.006700, 0.005511, 0.001238, -0.002275, -0.017675
#*# 	  0.006514, 0.009889, 0.016516, 0.016190, 0.012039, 0.009592, 0.005872, 0.000827, -0.002277, -0.005782, -0.009483, -0.012994, -0.017292, -0.017648, -0.014275, -0.006751, -0.005046, -0.010868, -0.010431, -0.012142, -0.018348, -0.021666, -0.019135, -0.015237, -0.019638
#*# 	  0.006116, 0.008307, 0.009924, 0.003530, -0.000222, -0.004437, -0.006493, -0.010009, -0.014117, -0.016606, -0.019699, -0.023627, -0.028181, -0.026624, -0.020628, -0.008289, -0.011871, -0.023109, -0.019171, -0.018613, -0.023660, -0.021283, -0.023087, -0.024844, -0.021916
#*# 	  -0.001742, -0.006294, -0.008626, -0.014610, -0.016219, -0.017773, -0.018382, -0.019507, -0.022504, -0.023230, -0.023479, -0.026781, -0.030099, -0.030674, -0.024773, -0.015377, -0.017040, -0.022921, -0.016667, -0.017448, -0.023391, -0.020312, -0.026605, -0.030029, -0.022398
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.01500
