# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

[temperature_sensor enclosure]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.032947, -0.027937, -0.026774, -0.036420, -0.041389, -0.043465, -0.046989, -0.050038, -0.052240, -0.045492, -0.043618, -0.042051, -0.040402, -0.041088, -0.046136, -0.051228, -0.047325, -0.043720, -0.037917, -0.031783, -0.034771, -0.030875, -0.021218, -0.026849, -0.027107
#*# 	  -0.017689, -0.026752, -0.027293, -0.025615, -0.029256, -0.034779, -0.043317, -0.055039, -0.056537, -0.045626, -0.040791, -0.041459, -0.042388, -0.037493, -0.038209, -0.041025, -0.038141, -0.037291, -0.031257, -0.030926, -0.035673, -0.030029, -0.030788, -0.035311, -0.033263
#*# 	  -0.008390, -0.016088, -0.025444, -0.023532, -0.028637, -0.033083, -0.038817, -0.042147, -0.046994, -0.044367, -0.045218, -0.045146, -0.037521, -0.024973, -0.032417, -0.040042, -0.044304, -0.041071, -0.034689, -0.033124, -0.030927, -0.031348, -0.028405, -0.025039, -0.022556
#*# 	  -0.013324, -0.020098, -0.023290, -0.024979, -0.030356, -0.032438, -0.031024, -0.031624, -0.035006, -0.041837, -0.044149, -0.034350, -0.021548, -0.020042, -0.035023, -0.037443, -0.036185, -0.032905, -0.025926, -0.021804, -0.024333, -0.024058, -0.025773, -0.024346, -0.018990
#*# 	  -0.013230, -0.021507, -0.014788, -0.009657, -0.011103, -0.013917, -0.013734, -0.011893, -0.010210, -0.024398, -0.028724, -0.020169, -0.015073, -0.020261, -0.032208, -0.031309, -0.030788, -0.031011, -0.022544, -0.024528, -0.029003, -0.024437, -0.031584, -0.026268, -0.017910
#*# 	  -0.009669, -0.008541, 0.001642, -0.000048, -0.012563, -0.018025, -0.021400, -0.011297, -0.000405, -0.013776, -0.021066, -0.017005, -0.016986, -0.021992, -0.025772, -0.029923, -0.034522, -0.028246, -0.019221, -0.024014, -0.027936, -0.024976, -0.021120, -0.019634, -0.017257
#*# 	  0.012543, 0.011299, 0.004984, -0.005575, -0.015613, -0.018850, -0.021381, -0.012444, -0.004993, -0.008060, -0.015105, -0.017465, -0.020402, -0.029264, -0.027247, -0.029197, -0.031714, -0.029360, -0.019765, -0.021208, -0.023216, -0.020901, -0.019492, -0.016407, -0.017883
#*# 	  0.011973, 0.007078, 0.000482, -0.014315, -0.017594, -0.005224, -0.010826, -0.009891, -0.007882, -0.007283, -0.009897, -0.009239, -0.023320, -0.037814, -0.029139, -0.027108, -0.026413, -0.026029, -0.019662, -0.021150, -0.018287, -0.016517, -0.019990, -0.017780, -0.013926
#*# 	  0.010196, 0.002863, -0.005216, -0.015343, -0.003766, -0.000234, -0.012921, -0.003935, 0.003438, -0.008547, -0.004063, 0.001175, -0.012480, -0.032506, -0.024179, -0.023165, -0.021332, -0.017173, -0.012333, -0.014094, -0.011136, -0.009198, -0.010038, -0.008856, 0.000445
#*# 	  0.003297, -0.007419, -0.015906, -0.014854, 0.011149, -0.003193, -0.018746, -0.002596, 0.007437, -0.007983, -0.016615, 0.001660, 0.004211, -0.010201, -0.020984, -0.020390, -0.014454, -0.009242, -0.003736, -0.001426, -0.004077, -0.009079, -0.010596, -0.004191, 0.001258
#*# 	  0.003099, 0.007964, 0.011370, 0.011445, 0.022134, 0.007634, 0.007697, 0.014016, 0.011898, 0.007191, -0.010496, -0.003443, 0.002687, -0.000665, -0.009295, -0.004218, -0.001224, -0.001925, -0.003186, -0.000306, 0.000171, -0.004704, -0.006180, -0.000651, 0.001988
#*# 	  0.026542, 0.031020, 0.032591, 0.028823, 0.025144, 0.019675, 0.024891, 0.022693, 0.016443, 0.011468, 0.000399, -0.002081, -0.000202, 0.003470, 0.000726, 0.000414, -0.005475, -0.007217, 0.003846, 0.001139, -0.007339, -0.000350, -0.001460, 0.000407, 0.003814
#*# 	  0.035914, 0.032789, 0.026307, 0.020270, 0.022127, 0.027552, 0.027704, 0.021768, 0.013857, 0.006265, 0.000527, -0.004222, 0.000905, 0.008672, 0.001859, -0.011439, -0.017776, -0.010396, 0.003641, -0.000858, -0.002765, -0.000158, -0.001496, 0.000913, 0.002728
#*# 	  0.021639, 0.024717, 0.005953, -0.003374, 0.018799, 0.027008, 0.019278, 0.007376, -0.012388, -0.009978, -0.009494, -0.024828, -0.013226, 0.000798, -0.010955, -0.023034, -0.014426, -0.006518, -0.004596, -0.007122, -0.006486, -0.008867, -0.006337, 0.000537, -0.000094
#*# 	  0.005656, 0.016441, 0.001648, -0.001876, 0.020810, 0.027656, 0.015412, -0.001329, -0.025996, -0.015168, -0.009343, -0.026295, -0.019245, -0.001550, -0.008747, -0.017585, -0.013329, -0.011519, -0.012747, -0.010442, -0.009434, -0.012052, -0.008365, -0.002341, -0.001388
#*# 	  0.019176, 0.018642, 0.012032, 0.009026, 0.011733, 0.021701, 0.019587, 0.010063, -0.000171, 0.001174, -0.000127, -0.007591, -0.007859, 0.001681, -0.011269, -0.016979, -0.014899, -0.014697, -0.014947, -0.011724, -0.006936, -0.009632, -0.008121, -0.002276, -0.001072
#*# 	  0.013007, 0.020497, 0.018101, 0.012758, 0.012175, 0.022935, 0.022184, 0.014095, 0.006781, 0.003263, 0.003868, 0.000053, -0.000296, -0.005113, -0.019486, -0.014954, -0.010762, -0.014639, -0.018230, -0.011061, -0.004350, -0.007539, -0.005570, 0.000119, 0.004230
#*# 	  0.004683, 0.009041, 0.006419, 0.000221, 0.016663, 0.025027, 0.007304, -0.014296, -0.017242, -0.006472, -0.013334, -0.022758, -0.016605, -0.012775, -0.011446, -0.005309, -0.009444, -0.020310, -0.017684, -0.007461, -0.003449, -0.006991, -0.002203, 0.003996, 0.007618
#*# 	  0.008819, 0.009447, 0.009715, 0.000680, 0.011955, 0.023029, 0.009157, -0.010795, -0.011629, -0.004312, -0.017439, -0.025601, -0.023792, -0.014765, -0.005038, 0.000299, -0.005490, -0.013173, -0.007478, 0.000131, 0.000414, -0.003233, 0.001123, 0.004713, 0.013494
#*# 	  -0.003229, 0.002580, 0.001161, -0.005738, -0.003365, 0.015092, 0.013233, 0.004906, 0.000091, -0.008534, -0.011858, -0.014485, -0.015841, -0.012763, -0.006213, -0.000646, -0.005000, -0.002002, 0.002039, 0.001406, 0.004509, 0.008204, 0.010661, 0.013447, 0.020468
#*# 	  -0.001902, -0.002756, -0.000995, 0.005594, 0.012427, 0.018158, 0.016198, 0.010149, 0.006074, -0.005104, -0.006508, -0.008734, -0.009392, -0.008216, -0.003161, -0.000612, -0.000523, 0.000868, -0.000287, 0.006464, 0.015937, 0.018748, 0.016517, 0.015805, 0.011492
#*# 	  -0.004315, -0.005720, 0.005659, 0.012208, 0.011945, 0.010045, 0.007332, 0.002875, 0.001150, -0.005701, -0.009948, -0.013231, -0.013457, -0.012783, -0.009860, -0.004761, -0.000439, -0.001918, 0.001471, 0.006473, 0.008170, 0.005347, 0.003550, 0.004356, -0.009571
#*# 	  0.004026, 0.007441, 0.010841, 0.008595, 0.005864, 0.001096, -0.002961, -0.006318, -0.008841, -0.013016, -0.017163, -0.019799, -0.021948, -0.022136, -0.015793, -0.003854, -0.002819, -0.011362, -0.009168, -0.009568, -0.015201, -0.015699, -0.009024, -0.004258, -0.004855
#*# 	  -0.001531, -0.000401, -0.001324, -0.007613, -0.010773, -0.015424, -0.016916, -0.019408, -0.022507, -0.025549, -0.027057, -0.030180, -0.033359, -0.031160, -0.021302, -0.008718, -0.009808, -0.020024, -0.013885, -0.010413, -0.014401, -0.010544, -0.014810, -0.017894, -0.011053
#*# 	  -0.009807, -0.018866, -0.020383, -0.022971, -0.024311, -0.025596, -0.027652, -0.025843, -0.026012, -0.026382, -0.026646, -0.028086, -0.029453, -0.031075, -0.025558, -0.015651, -0.017267, -0.019134, -0.009788, -0.012200, -0.016399, -0.012318, -0.014537, -0.012150, -0.007917
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.11000
