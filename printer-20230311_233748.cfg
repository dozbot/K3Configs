# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.0175

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.35
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

[temperature_sensor enclosure]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.068126, -0.064531, -0.063379, -0.074737, -0.078840, -0.078634, -0.079602, -0.079840, -0.081678, -0.077758, -0.076416, -0.077319, -0.073281, -0.073371, -0.079206, -0.083959, -0.082987, -0.078764, -0.076139, -0.069990, -0.071639, -0.072265, -0.059267, -0.064035, -0.066603
#*# 	  -0.056874, -0.062675, -0.060980, -0.062295, -0.065429, -0.068877, -0.077356, -0.087654, -0.089164, -0.077138, -0.072100, -0.072901, -0.073092, -0.070399, -0.071936, -0.073602, -0.071496, -0.070626, -0.065440, -0.065678, -0.070553, -0.066735, -0.066676, -0.073047, -0.073716
#*# 	  -0.045718, -0.056029, -0.062085, -0.058300, -0.062429, -0.066094, -0.072751, -0.077125, -0.080800, -0.076850, -0.076431, -0.078003, -0.072485, -0.060813, -0.066110, -0.071790, -0.076163, -0.074084, -0.070605, -0.070951, -0.070840, -0.070949, -0.070667, -0.069533, -0.063587
#*# 	  -0.049354, -0.053321, -0.057114, -0.058909, -0.064199, -0.067405, -0.066738, -0.066070, -0.068901, -0.073936, -0.076392, -0.069519, -0.055398, -0.050908, -0.066195, -0.069629, -0.071337, -0.066676, -0.059703, -0.057161, -0.060536, -0.061476, -0.061117, -0.060567, -0.058206
#*# 	  -0.047704, -0.057224, -0.051650, -0.046471, -0.047248, -0.050071, -0.048518, -0.047333, -0.048045, -0.062421, -0.062709, -0.054512, -0.047538, -0.053855, -0.066382, -0.063674, -0.062267, -0.062996, -0.057146, -0.057686, -0.062890, -0.059922, -0.068921, -0.065392, -0.053560
#*# 	  -0.045879, -0.047568, -0.032751, -0.033294, -0.042386, -0.047228, -0.050547, -0.041385, -0.031471, -0.045648, -0.050765, -0.047423, -0.046276, -0.052101, -0.058302, -0.061143, -0.065927, -0.060085, -0.052620, -0.056632, -0.061527, -0.059503, -0.059085, -0.057203, -0.054056
#*# 	  -0.022736, -0.023957, -0.027049, -0.036928, -0.046704, -0.051759, -0.055307, -0.044499, -0.035980, -0.042129, -0.047461, -0.048042, -0.050150, -0.058332, -0.058296, -0.059877, -0.063040, -0.060343, -0.052251, -0.056852, -0.058441, -0.056617, -0.054530, -0.050920, -0.050024
#*# 	  -0.021141, -0.025933, -0.029948, -0.044703, -0.047643, -0.038166, -0.043195, -0.041974, -0.040989, -0.038310, -0.041883, -0.041895, -0.053752, -0.066707, -0.060349, -0.060480, -0.060205, -0.059074, -0.053192, -0.052606, -0.051477, -0.053044, -0.054042, -0.049565, -0.048846
#*# 	  -0.024569, -0.031061, -0.038458, -0.050333, -0.042006, -0.034268, -0.045021, -0.037120, -0.032803, -0.040017, -0.036653, -0.032955, -0.049623, -0.068437, -0.057566, -0.055831, -0.055063, -0.051295, -0.049691, -0.051329, -0.047970, -0.045982, -0.047696, -0.045582, -0.034480
#*# 	  -0.029844, -0.041623, -0.049685, -0.048147, -0.023591, -0.035547, -0.053054, -0.035787, -0.026151, -0.042421, -0.045486, -0.030753, -0.030544, -0.048412, -0.054855, -0.054634, -0.050499, -0.044812, -0.038907, -0.037405, -0.040287, -0.042460, -0.043148, -0.035606, -0.028852
#*# 	  -0.031855, -0.030004, -0.027807, -0.025866, -0.012773, -0.028029, -0.029912, -0.020502, -0.020655, -0.028065, -0.043441, -0.033834, -0.026115, -0.033876, -0.043342, -0.038814, -0.036193, -0.036256, -0.037354, -0.034722, -0.035041, -0.041516, -0.043986, -0.034599, -0.030654
#*# 	  -0.011752, -0.006120, -0.001659, -0.005138, -0.008202, -0.015197, -0.009652, -0.011461, -0.016447, -0.021613, -0.033169, -0.034737, -0.032815, -0.031609, -0.033488, -0.031763, -0.036625, -0.037677, -0.033685, -0.034884, -0.042290, -0.036440, -0.037261, -0.032650, -0.027819
#*# 	  -0.001354, -0.002571, -0.006205, -0.012321, -0.011553, -0.008123, -0.006380, -0.012792, -0.017604, -0.024877, -0.033940, -0.036148, -0.031273, -0.025392, -0.031521, -0.043393, -0.050588, -0.045792, -0.033642, -0.038559, -0.042528, -0.036940, -0.038316, -0.032983, -0.028660
#*# 	  -0.011555, -0.008898, -0.025064, -0.032685, -0.014843, -0.006643, -0.013584, -0.024212, -0.039055, -0.040601, -0.042433, -0.054398, -0.042172, -0.032236, -0.043976, -0.056140, -0.051009, -0.041851, -0.039837, -0.043271, -0.043466, -0.044143, -0.040554, -0.032846, -0.032681
#*# 	  -0.027947, -0.016544, -0.034489, -0.036029, -0.011855, -0.004615, -0.014674, -0.034330, -0.058711, -0.047843, -0.044741, -0.062099, -0.050849, -0.034305, -0.043681, -0.051808, -0.047216, -0.045591, -0.047956, -0.047434, -0.048938, -0.050322, -0.045477, -0.036007, -0.033233
#*# 	  -0.017656, -0.017061, -0.022297, -0.023655, -0.016449, -0.007402, -0.011478, -0.024781, -0.037893, -0.034534, -0.035731, -0.047136, -0.044302, -0.033677, -0.044649, -0.051035, -0.050063, -0.050834, -0.052047, -0.048669, -0.046510, -0.048405, -0.045089, -0.036314, -0.034343
#*# 	  -0.017845, -0.011695, -0.014997, -0.020398, -0.020914, -0.010281, -0.009998, -0.017090, -0.024355, -0.029436, -0.029247, -0.034057, -0.031795, -0.035992, -0.053000, -0.051033, -0.047545, -0.051152, -0.054311, -0.050108, -0.044702, -0.046556, -0.043369, -0.035101, -0.028267
#*# 	  -0.030973, -0.024614, -0.028244, -0.032213, -0.015556, -0.008773, -0.021123, -0.041578, -0.044426, -0.039053, -0.043519, -0.049438, -0.046701, -0.046956, -0.049137, -0.042602, -0.045582, -0.056414, -0.054954, -0.044926, -0.043554, -0.047692, -0.042207, -0.032250, -0.026949
#*# 	  -0.025392, -0.023765, -0.023773, -0.031899, -0.017799, -0.009995, -0.027668, -0.049429, -0.048196, -0.039697, -0.053790, -0.061704, -0.056936, -0.048070, -0.039854, -0.035774, -0.043472, -0.052543, -0.048479, -0.039672, -0.041125, -0.045189, -0.039818, -0.033428, -0.025592
#*# 	  -0.036353, -0.030336, -0.031250, -0.041568, -0.036675, -0.018359, -0.022372, -0.031093, -0.034257, -0.040335, -0.045937, -0.050815, -0.051966, -0.048164, -0.041263, -0.037040, -0.041828, -0.041778, -0.037153, -0.037303, -0.036610, -0.036239, -0.033201, -0.025292, -0.018517
#*# 	  -0.036993, -0.036086, -0.034796, -0.030686, -0.024976, -0.017466, -0.020719, -0.025145, -0.030964, -0.041400, -0.041928, -0.044417, -0.045252, -0.044650, -0.039978, -0.038556, -0.039581, -0.037828, -0.040327, -0.036157, -0.028736, -0.026027, -0.027072, -0.024568, -0.021581
#*# 	  -0.039174, -0.040447, -0.028899, -0.023174, -0.020910, -0.021966, -0.024573, -0.028206, -0.032013, -0.038776, -0.042884, -0.045456, -0.047504, -0.046621, -0.045415, -0.040973, -0.038764, -0.041021, -0.039594, -0.032783, -0.029766, -0.031502, -0.033826, -0.033409, -0.046346
#*# 	  -0.031089, -0.028161, -0.023559, -0.025608, -0.028437, -0.033846, -0.037880, -0.040314, -0.042524, -0.046320, -0.049986, -0.053676, -0.055838, -0.056825, -0.053327, -0.042595, -0.042876, -0.049808, -0.049173, -0.049382, -0.055893, -0.058684, -0.052333, -0.044948, -0.044981
#*# 	  -0.033699, -0.032542, -0.032693, -0.039520, -0.042936, -0.046716, -0.049335, -0.051713, -0.055335, -0.057491, -0.060136, -0.065241, -0.068064, -0.065950, -0.060096, -0.046713, -0.051113, -0.061473, -0.056716, -0.054759, -0.058852, -0.055810, -0.057516, -0.056656, -0.049615
#*# 	  -0.045055, -0.052406, -0.053824, -0.058339, -0.059968, -0.061584, -0.063378, -0.062055, -0.063582, -0.065322, -0.065251, -0.067202, -0.069468, -0.070781, -0.065847, -0.055091, -0.059248, -0.063374, -0.055176, -0.057133, -0.060350, -0.057338, -0.062651, -0.061149, -0.051923
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.06500
