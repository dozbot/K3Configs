# STM32F446 with a "32KiB bootloader" and a "12MHz crystal" clock reference.
# Printer may explode.

[include steppers.cfg]
[include fans.cfg]
[include macros.cfg]
#[include probe.cfg]
[include mainsail.cfg]
[include lights.cfg]
[include pidtune.cfg]
[include config_backup.cfg]
[include beacon.cfg]

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_48002F000F51383438343939-if00

[mcu rpi]
serial: /tmp/klipper_host_mcu

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_51B040CA515137474C202020FF0C1C20-if00
x_offset: -26.5 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2
speed: 8.
#   Z probing dive speed.
lift_speed: 8.
#   Z probing lift speed.
#backlash_comp: 0.5
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.

[adxl345]
cs_pin: rpi:None

[exclude_object]

[resonance_tester]
accel_chip: adxl345
probe_points:
    90, 90, 20
accel_per_hz: 100
hz_per_sec: 0.5

[input_shaper]
#shaper_freq_x: 91.0
#shaper_type_x: mzv
#shaper_freq_y: 113.8
#shaper_type_y: mzv
shaper_freq_x: 95
shaper_freq_y: 90
damping_ratio_x: 0.05
damping_ratio_y: 0.05
shaper_type: mzv

[printer]
kinematics: cartesian
square_corner_velocity: 15.0
max_velocity: 650
max_accel: 15000
max_accel_to_decel: 15000
max_z_velocity: 20
max_z_accel: 400

## Safe acceleration settings
## Use these for your first moves and sanity checks.
#max_velocity: 250
#max_accel: 2000
#max_z_velocity: 10
#max_z_accel: 100

[virtual_sdcard]
path: /home/pi/gcode_files/

[force_move]
enable_force_move: true

[display_status]

[pause_resume]

[extruder]
step_pin: PE6
dir_pin: PA14
enable_pin: !PE0
rotation_distance = 1.131116 #double folded ascender (20:1)
microsteps: 4
full_steps_per_rotation: 200
nozzle_diameter: 0.500
filament_diameter: 1.75
pwm_cycle_time: 0.02
heater_pin: PA2

sensor_type: PT1000
sensor_pin: PF4
#spi_software_sclk_pin: PA5
#spi_software_mosi_pin: PA7
#spi_software_miso_pin: PA6

#rtd_nominal_r: 1000
#rtd_num_of_wires: 2
#rtd_reference_r: 4300
pullup_resistor: 4700
#rtd_use_50Hz_filter: True

min_temp: 5
max_temp: 300
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 150
max_extrude_cross_section: 20000

#pressure_advance: 0.019
#pressure_advance_smooth_time: 0.028

pressure_advance: 0.0175
pressure_advance_smooth_time: 0.02

[tmc2209 extruder]
uart_pin: PD3
interpolate: false
run_current: 0.37
#run_current: 0.336 # results in CS 10
driver_TBL: 1
driver_TOFF: 3 # 41.7Khz max chopper frequency
driver_HSTRT: 0
driver_HEND: 3
sense_resistor: 0.110
stealthchop_threshold: 0

[heater_bed]
heater_pin: PA1
sensor_pin: PF3
#sensor_type: Generic 3950
sensor_type: NTC 100K MGB18-104F39050L32
max_power: 0.6
min_temp: 0
max_temp: 122
#pwm_cycle_time: 0.02
#control: watermark
#max_delta: 0.5

# Chamber Lighting
#[output_pin chamber_lighting]
#pin: PB10
#value: 1
#shutdown_value: 1

#[temperature_sensor enclosure]
#sensor_type: ATC Semitec 104NT-4-R025H42G
#sensor_pin: PF5

# Mesh Bed Settings
[bed_mesh]
speed: 250
horizontal_move_z: 1
#mesh_min: 20,25
#mesh_max: 150, 155
mesh_min: 25,20
mesh_max: 150, 160
probe_count: 25,25
fade_start: 1.0
fade_end: 10
split_delta_z: 0.01
move_check_distance: 3.0
mesh_pps: 0,0
algorithm: bicubic
bicubic_tension: 0.2
#relative_reference_index: 312  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions: 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right

points:
    41.5, 20          # Front Left
    97.5, 160        # Rear
    171.5, 20         # Front Right
 
speed: 500
horizontal_move_z: 5.0
retries: 8
#retry_tolerance: 0.02
retry_tolerance: 0.005

[safe_z_home]
home_xy_position: 111.5, 90 # update for your machine
z_hop: 3

#[probe]
#z_offset = 1.0

# Motor and Heater Idle Timeout
[idle_timeout]
timeout: 10800
gcode: M84

[temperature_sensor pi]
sensor_type: temperature_host

[temperature_sensor octopus]
sensor_type: temperature_mcu

# #*# [probe]
# #*# z_offset = 10.03
# #*#

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# pid_kp = 21.259
#*# pid_ki = 1.968
#*# pid_kd = 57.400
#*# control = pid
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 26.878
#*# pid_ki = 1.948
#*# pid_kd = 92.729
#*#
#*# [bed_mesh default 1]
#*# version = 1
#*# points =
#*# 	-0.035000, -0.035000, -0.016250, -0.018750, -0.017500, -0.021250, -0.027500
#*# 	-0.030000, -0.016250, -0.012500, -0.012500, -0.016250, -0.025000, -0.053750
#*# 	-0.026250, -0.013750, 0.016250, -0.008750, -0.013750, -0.016250, -0.055000
#*# 	-0.021250, 0.001250, 0.013750, 0.000000, -0.008750, -0.013750, -0.048750
#*# 	-0.023750, -0.010000, -0.002500, -0.008750, -0.015000, -0.028750, -0.061250
#*# 	-0.022500, 0.002500, 0.012500, -0.006250, -0.010000, -0.023750, -0.063750
#*# 	-0.016250, -0.001250, 0.012500, -0.005000, -0.011250, -0.026250, -0.053750
#*# tension = 0.1
#*# mesh_x_pps = 2
#*# algo = bicubic
#*# min_x = 10.0
#*# min_y = 10.0
#*# y_count = 7
#*# mesh_y_pps = 2
#*# x_count = 7
#*# max_x = 154.0
#*# max_y = 164.98
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.018818, -0.015499, -0.015825, -0.028749, -0.034526, -0.037361, -0.040345, -0.042364, -0.041568, -0.037886, -0.039262, -0.040162, -0.039636, -0.037235, -0.040660, -0.042641, -0.038769, -0.035541, -0.029536, -0.023638, -0.026355, -0.020016, -0.012836, -0.017601, -0.016909
#*# 	  -0.007556, -0.016842, -0.015782, -0.017794, -0.024064, -0.029007, -0.038087, -0.045514, -0.046406, -0.039121, -0.037271, -0.039017, -0.038431, -0.031696, -0.032247, -0.033598, -0.032031, -0.030807, -0.026190, -0.024607, -0.026916, -0.021131, -0.022729, -0.025978, -0.025031
#*# 	  -0.000777, -0.007867, -0.014948, -0.017576, -0.021844, -0.024058, -0.031198, -0.034675, -0.039521, -0.038983, -0.040993, -0.041106, -0.032410, -0.021079, -0.028157, -0.035216, -0.039789, -0.035751, -0.030132, -0.027676, -0.024723, -0.024006, -0.019325, -0.016891, -0.014398
#*# 	  -0.005803, -0.009315, -0.011565, -0.017904, -0.023580, -0.025346, -0.023607, -0.028221, -0.030299, -0.035263, -0.036245, -0.025929, -0.014727, -0.017948, -0.030574, -0.032802, -0.031305, -0.026377, -0.017770, -0.015772, -0.017386, -0.016765, -0.014661, -0.015430, -0.010124
#*# 	  -0.005095, -0.010817, -0.006422, -0.006624, -0.008374, -0.009094, -0.008878, -0.009186, -0.012122, -0.024750, -0.022055, -0.015353, -0.012472, -0.019766, -0.029300, -0.026648, -0.027547, -0.027663, -0.014574, -0.021013, -0.021597, -0.018006, -0.023968, -0.017819, -0.008842
#*# 	  -0.002731, -0.007250, 0.001457, -0.001121, -0.006722, -0.011230, -0.012636, -0.003080, 0.001522, -0.012803, -0.016822, -0.013158, -0.014355, -0.020206, -0.023359, -0.027171, -0.031741, -0.024124, -0.011421, -0.018595, -0.022157, -0.018023, -0.013372, -0.013650, -0.009514
#*# 	  0.013729, 0.011791, 0.006543, -0.001564, -0.008279, -0.011280, -0.011293, -0.004051, -0.001683, -0.005319, -0.013144, -0.015761, -0.018831, -0.026933, -0.026688, -0.027196, -0.028828, -0.023896, -0.011242, -0.016324, -0.016904, -0.014906, -0.012180, -0.010107, -0.009842
#*# 	  0.008832, 0.009235, 0.004945, -0.005998, -0.007642, 0.001886, -0.001375, -0.000866, -0.002213, -0.001594, -0.006230, -0.007771, -0.023717, -0.034302, -0.026785, -0.025163, -0.024641, -0.020334, -0.011789, -0.013406, -0.010983, -0.008906, -0.012740, -0.011969, -0.009266
#*# 	  0.010752, 0.005515, -0.000573, -0.005587, 0.005071, 0.004278, -0.006409, 0.003235, 0.003695, -0.003970, -0.000835, 0.003725, -0.016432, -0.032530, -0.022000, -0.019116, -0.018238, -0.011508, -0.005442, -0.008958, -0.006688, -0.003891, -0.003028, -0.002510, 0.006148
#*# 	  0.002729, -0.002759, -0.007189, -0.003642, 0.014175, -0.005353, -0.012224, 0.004262, 0.008414, -0.008997, -0.009018, 0.007529, 0.002409, -0.012329, -0.019512, -0.016775, -0.011879, -0.004992, 0.002118, 0.003591, -0.001252, -0.004803, -0.003339, 0.003758, 0.009783
#*# 	  0.007851, 0.013577, 0.013449, 0.015516, 0.020965, 0.007385, 0.010854, 0.013483, 0.012383, 0.004176, -0.008220, 0.000343, 0.006142, -0.000712, -0.007548, -0.003809, -0.001088, 0.001251, 0.002442, 0.007844, 0.003237, -0.002237, -0.000601, 0.005280, 0.009152
#*# 	  0.026976, 0.029515, 0.032887, 0.028727, 0.023000, 0.019149, 0.024342, 0.019712, 0.014666, 0.010227, -0.001502, -0.003302, 0.000741, 0.002294, -0.000926, -0.000584, -0.003199, -0.000939, 0.009962, 0.006121, -0.002675, 0.001384, 0.001809, 0.005705, 0.008938
#*# 	  0.034191, 0.033311, 0.029509, 0.023398, 0.024125, 0.026589, 0.025621, 0.019587, 0.012901, 0.007670, -0.000753, -0.005118, -0.000887, 0.003091, -0.003352, -0.009439, -0.013023, -0.002171, 0.010094, 0.001814, -0.000845, 0.002102, 0.002807, 0.006548, 0.007658
#*# 	  0.028256, 0.031240, 0.015662, 0.008055, 0.023495, 0.027752, 0.018451, 0.006655, -0.009258, -0.006424, -0.012340, -0.022019, -0.010066, -0.005353, -0.015804, -0.015583, -0.009367, 0.000059, 0.000147, -0.004397, -0.005381, -0.004116, -0.000956, 0.006143, 0.004722
#*# 	  0.022440, 0.030538, 0.015912, 0.011165, 0.029213, 0.031776, 0.018450, 0.000839, -0.021093, -0.009346, -0.010520, -0.024478, -0.015396, -0.006390, -0.011109, -0.011615, -0.008307, -0.006493, -0.008752, -0.008074, -0.007950, -0.008959, -0.003713, 0.002575, 0.003160
#*# 	  0.033122, 0.031920, 0.026283, 0.020455, 0.020409, 0.029676, 0.021135, 0.010761, 0.000808, 0.000586, -0.000736, -0.009255, -0.006973, -0.002704, -0.011635, -0.014267, -0.010145, -0.010355, -0.012696, -0.008762, -0.006300, -0.007671, -0.003910, 0.000576, 0.000951
#*# 	  0.026078, 0.033890, 0.030650, 0.021762, 0.021021, 0.029433, 0.025266, 0.016192, 0.006134, 0.002241, 0.004339, -0.000428, 0.000344, -0.004250, -0.015795, -0.010748, -0.006834, -0.011572, -0.013447, -0.008819, -0.004927, -0.005577, -0.001553, 0.002722, 0.007894
#*# 	  0.017510, 0.022056, 0.016001, 0.010720, 0.026835, 0.028786, 0.011943, -0.008349, -0.010687, -0.004537, -0.014174, -0.016338, -0.008681, -0.007178, -0.005288, 0.001705, -0.006117, -0.014608, -0.013067, -0.004687, -0.003627, -0.005605, 0.001428, 0.006458, 0.009136
#*# 	  0.018340, 0.018914, 0.017453, 0.008698, 0.019495, 0.028161, 0.012990, -0.002012, -0.002334, -0.000850, -0.014923, -0.018968, -0.015247, -0.005487, 0.004452, 0.008411, -0.001269, -0.008820, -0.003933, 0.001490, -0.000704, -0.002382, 0.002592, 0.008709, 0.012276
#*# 	  0.006838, 0.010814, 0.006829, -0.001560, 0.003497, 0.022168, 0.016396, 0.012010, 0.006088, -0.002372, -0.006551, -0.009770, -0.009886, -0.005409, 0.002424, 0.006197, 0.000699, 0.000971, 0.003163, 0.002073, 0.004900, 0.006667, 0.011179, 0.015421, 0.020941
#*# 	  0.009417, 0.007901, 0.009321, 0.012371, 0.015956, 0.022674, 0.019716, 0.016088, 0.011617, 0.003307, 0.000449, -0.003427, -0.004355, -0.002903, 0.003743, 0.003290, 0.001191, 0.000581, -0.000069, 0.005586, 0.012375, 0.016052, 0.014728, 0.014963, 0.015049
#*# 	  0.011759, 0.009969, 0.019611, 0.019436, 0.017972, 0.015694, 0.013996, 0.011730, 0.009577, 0.003956, -0.000886, -0.003748, -0.005607, -0.005752, -0.004999, -0.002096, -0.001865, -0.003373, 0.001306, 0.006513, 0.008008, 0.005046, 0.005598, 0.005381, -0.005585
#*# 	  0.024475, 0.025005, 0.023737, 0.017488, 0.012832, 0.009057, 0.006656, 0.003429, 0.001228, -0.002332, -0.007008, -0.009439, -0.014848, -0.014900, -0.012780, -0.006557, -0.007397, -0.013474, -0.008500, -0.008311, -0.012568, -0.011738, -0.005965, -0.000055, 0.000846
#*# 	  0.022717, 0.018613, 0.014366, 0.004226, -0.000413, -0.004521, -0.007569, -0.009738, -0.012049, -0.013898, -0.017713, -0.022006, -0.026305, -0.025542, -0.018280, -0.010687, -0.013415, -0.018724, -0.013839, -0.013139, -0.014493, -0.009419, -0.012798, -0.010377, -0.002320
#*# 	  0.009854, -0.001483, -0.005036, -0.009361, -0.012158, -0.014465, -0.015568, -0.015586, -0.015874, -0.017195, -0.018112, -0.019682, -0.022381, -0.024917, -0.019963, -0.015317, -0.016563, -0.017415, -0.010852, -0.014661, -0.015128, -0.011969, -0.014052, -0.008882, -0.001020
#*# tension = 0.2
#*# min_x = 25.0
#*# algo = direct
#*# y_count = 25
#*# mesh_y_pps = 0
#*# min_y = 20.0
#*# x_count = 25
#*# max_y = 160.0
#*# mesh_x_pps = 0
#*# max_x = 150.0
#*#
#*# [beacon model default]
#*# model_coef = 1.5084609920882985,
#*# 	  1.8304920853848226,
#*# 	  0.7676780990654823,
#*# 	  0.47375701546892535,
#*# 	  0.31273175416242,
#*# 	  -0.10837707547755139,
#*# 	  -0.1908238235838701,
#*# 	  0.2425613770183005,
#*# 	  0.2026542982577076,
#*# 	  -0.036418684373293174
#*# model_domain = 3.21414813850683e-07,3.3359392188637445e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 22.805963
#*# model_offset = -0.38000
